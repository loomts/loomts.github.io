<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-CN"><title type="text">loomt</title><subtitle type="html">è®°å½•ç”Ÿæ´»ä¸coding</subtitle><updated>2023-05-06T16:40:12+00:00</updated><id>https://loomt.top/</id><link rel="alternate" type="text/html" href="https://loomt.top/"/><link rel="self" type="application/atom+xml" href="https://loomt.top/atom.xml"/><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><generator uri="https://gohugo.io/" version="0.92.2">Hugo</generator><entry><title type="text">6.824 Lab4</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/6.824-lab4/"/><id>https://loomt.top/posts/6.824-lab4/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2023-03-09T02:02:35+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">ç»·ä¸ä½äº†ï¼Œåœ¨å†™ lab4B çš„æ—¶å€™ï¼Œæˆ‘ commit äº† shardKVï¼ˆ4Bï¼‰çš„æ–‡ä»¶ï¼Œä½†å†™å¥½çš„ shardctrlerï¼ˆ4Aï¼‰æ²¡æœ‰ commitï¼Œç„¶åæˆ‘ reset-hard äº†æ•´ä¸ªé¡¹ç›®ï¼Œå†™å®Œçš„ shardctrler å°±ä¸è§äº†ï¼Œ-2hâ€¦</summary><content type="html">&lt;blockquote>
&lt;p>ç»·ä¸ä½äº†ï¼Œåœ¨å†™ lab4B çš„æ—¶å€™ï¼Œæˆ‘ commit äº† shardKVï¼ˆ4Bï¼‰çš„æ–‡ä»¶ï¼Œä½†å†™å¥½çš„ shardctrlerï¼ˆ4Aï¼‰æ²¡æœ‰ commitï¼Œç„¶åæˆ‘ reset-hard äº†æ•´ä¸ªé¡¹ç›®ï¼Œå†™å®Œçš„ shardctrler å°±ä¸è§äº†ï¼Œ-2hğŸ˜­&lt;/p>
&lt;/blockquote>
&lt;h1 id="task">Task&lt;/h1>
&lt;p>å®Œæˆ Multi-Raft&lt;/p>
&lt;ul>
&lt;li>
&lt;p>lab4Aï¼šå®Œæˆ Multi-Raft æ§åˆ¶ä¸­å¿ƒï¼ˆå’Œ lab3 å†…å®¹å·®ä¸å¤šï¼Œä¸€å¥è¯å°±æ˜¯ shardctrler æ˜¯ä¸€ä¸ªå°† Config ä½œä¸ºæ—¥å¿—è¿›è¡Œç»´æŠ¤çš„å• Raft é›†ç¾¤ï¼Œå¹¶ä¸”ä¸éœ€è¦å®ç°å¿«ç…§å’ŒæŒä¹…åŒ–ï¼‰
éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ Join å’Œ Leave æ“ä½œ shards åº”è¯¥æ€ä¹ˆå¹³å‡ä¸”æœ‰åºåœ°åˆ†é…ç»™ gidsï¼ˆæ³¨æ„åœ¨ Leave æ“ä½œä¸­ï¼ŒGroup é‡Œé¢å¯èƒ½æœ‰å¤šä½™çš„ gidï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„å°†å…¶ç®—åœ¨ gids é‡Œé¢ï¼‰ï¼Œä¸»è¦é€»è¾‘å’Œ lab3 å·®ä¸å¤šï¼Œæ¯”è¾ƒç®€å•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>lab4Bï¼šå®ç°ä¸€ä¸ªæ‹¥æœ‰åˆ†ç‰‡åŠŸèƒ½ï¼Œèƒ½å¤Ÿéšæ—¶åŠ å…¥é€€å‡ºæˆå‘˜ï¼Œå¯ä»¥æ ¹æ®é…ç½®åŒæ­¥è¿ç§»æ•°æ®ï¼Œæ”¯æŒæ–­çº¿é‡è¿æ—¥å¿—å¿«é€Ÿè¿½èµ¶å’Œå¿«ç…§åŠŸèƒ½å¹¶ä¸”èƒ½å¤Ÿä¿è¯çº¿æ€§ä¸€è‡´æ€§çš„ kv æ•°æ®åº“ã€‚
è™½ç„¶å äº†å¾ˆå¤š buffï¼Œä½†å¾ˆå¤šåœ°æ–¹æˆ‘ä»¬ä¹‹å‰å·²ç»å®ç°äº†ï¼Œæ¯”å¦‚åŠ å…¥é€€å‡ºæˆå‘˜å’Œæ—¥å¿—åŒæ­¥åœ¨ lab4Aï¼›æ–­çº¿é‡è¿å’Œæ—¥å¿—å¿«é€Ÿè¿½èµ¶åœ¨ lab2ï¼›çº¿æ€§ä¸€è‡´æ€§çš„ kv æ•°æ®åº“åœ¨ lab3ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ‰€ä»¥æˆ‘ä»¬åœ¨ lab4B çš„ä¸»è¦ä»»åŠ¡æ˜¯æ ¹æ®æœ€æ–°é…ç½®æ¥å®ç°åˆ†ç‰‡çš„å¤„ç†ï¼Œè¿›è¡Œåˆ†ç‰‡å¤„ç†å’Œå›å¤å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½éœ€è¦é€šè¿‡ Raft å±‚å®ç°ä¸€è‡´æ€§ï¼Œæ‰€ä»¥éƒ½è¦è°ƒç”¨&lt;code>kv.rf.Start()&lt;/code>å¹¶å¯åŠ¨ä¸€ä¸ª go routine å¤„ç† Raft å±‚å›è°ƒçš„ applyChã€‚&lt;/p>
&lt;p>é¦–å…ˆæ˜¯ shardï¼Œæˆ‘ä»¬éœ€è¦å°† Client çš„ PUTã€GETã€APPEND è¯·æ±‚é€šè¿‡ key å€¼çš„ hash åˆ†é…ç»™ä¸åŒçš„ shardï¼Œshard2gid æ•°ç»„å¯ä»¥é€šè¿‡è¯»å–é…ç½®è·å–ã€‚ä¸ºäº†é˜²æ­¢é‡å¤ applyï¼Œæˆ‘ä»¬è¦åœ¨ shard ç»“æ„åŠ ä¸Šå»é‡è¡¨ã€‚æ‰€ä»¥æˆ‘å®ç°çš„ shard ç»“æ„ä½“å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Shard&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Log&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">string&lt;/span>
&lt;span class="nx">LastCommand&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">int64&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>
&lt;span class="nx">Status&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è€ƒè™‘æ›´æ–° configï¼Œleader éœ€è¦å¦èµ·ä¸€ä¸ª go routine ä¸æ–­è¯»å–æ–°é…ç½®ï¼Œåœ¨æ›´æ–°é…ç½®ä¹‹å‰æˆ‘ä»¬éœ€è¦åˆ¤æ–­å½“å‰ gid æ˜¯å¦éœ€è¦ pull æˆ– pushï¼ˆå­˜ä¸‹ lastcfgï¼Œç”¨æ¥ä¸å½“å‰ cfg ä½œæ¯”è¾ƒï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">kv&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">ShardKV&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">allSentL&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">shard&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">gid&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lastcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Shards&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">gid&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">gid&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">cfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Shards&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">shard&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">gid&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stateMachine&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">shard&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">Status&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">Serving&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">kv&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">ShardKV&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">allReceivedL&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">shard&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">gid&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lastcfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Shards&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">gid&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">gid&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">cfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Shards&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">shard&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">gid&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">kv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stateMachine&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">shard&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">Status&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">Serving&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è‹¥éœ€è¦ï¼Œåˆ™ç­‰å¾…&lt;strong>ç›¸å…³ shards&lt;/strong>å¤„ç†å®Œæ¯•å†æŸ¥è¯¢æ–°ä¸€ä¸ª configï¼ˆå› ä¸ºæ­¥å­ä¸èƒ½è¿ˆå¾—å¤ªå¤§ï¼Œéœ€è¦ä¸€ä¸ªä¸ª config åœ°è¿›è¡ŒçŠ¶æ€æœºçš„æ›´æ–°ï¼ŒåŸå› ä¹‹ä¸€æ˜¯æ›´æ–°è¿‡ç¨‹ä¼šæ¶‰åŠåˆ° shard çš„åˆ‡æ¢ï¼‰ã€‚&lt;/p>
&lt;p>è‹¥æœ‰ä¸€ä¸ª gid éœ€è¦ pushï¼Œåˆ™å¦ä¸€ä¸ªå°±å¿…ç„¶éœ€è¦ pullã€‚æ— è®ºæ˜¯ç”¨ push è¿˜æ˜¯ç”¨ pull å¤„ç†éƒ½æ˜¯å¯ä»¥çš„ã€‚è€ƒè™‘åˆ° Challenge ä»»åŠ¡éœ€è¦åœ¨ push ä¹‹ååˆ é™¤åºŸå¼ƒ shard é‡Šæ”¾å†…å­˜ã€‚push è‡³å°‘æ¯” pull å°‘ä¸€ä¸ª RPC è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº† pushã€‚&lt;/p>
&lt;p>push ä¸»è¦æ˜¯éœ€è¦å‘é€ RPC ç»™å¯¹åº” status ä¸º pulling çš„ shardï¼Œå¹¶ç­‰å¾… receiver æ¥å—å¹¶ apply å›å¤ OK åè¿›è¡Œ deleteã€‚&lt;/p>
&lt;p>è¿˜è¦è®°å¾—åœ¨ä¸€ä¸ªèŠ‚ç‚¹åˆšæˆä¸º leader çš„æ—¶å€™å‘é€ç©ºæ—¥å¿—ä»¥ apply æ—§çš„æ—¥å¿—ã€‚&lt;/p>
&lt;h2 id="tips">tipsï¼š&lt;/h2>
&lt;ol>
&lt;li>TestConcurrent2 æµ‹çš„æ˜¯å®•æœºå†é‡å¯ Service å±‚ä¸å€ŸåŠ© snapshotï¼Œç”¨ raft å±‚çš„æ—¥å¿—å¿«é€Ÿè¿½èµ¶ï¼Œç„¶åæˆ‘çš„ Get ç»“æœæ€»æ˜¯ä¸æ­£ç¡®ç­”æ¡ˆä¸ä¸€è‡´ï¼Œè¡¨ç°åœ¨å‰é¢æ­£ç¡®ï¼Œåé¢æ­£ç¡®ï¼Œä¸­é—´ç¼ºå¤±ã€‚åŸæ¥æ˜¯åœ¨ shardkv åˆå§‹åŒ–çš„æ—¶å€™ï¼Œcfg ä¸èƒ½åˆå§‹åŒ–ä¸º&lt;code>kv.sc.Query(-1)&lt;/code>ï¼Œå› ä¸ºæˆ‘å°† cfg åˆå§‹åŒ–ä¸ºæœ€æ–°å€¼ï¼Œè¢« Raft å±‚æ¨åˆ° Service å±‚çš„æ—¥å¿—åœ¨åº”ç”¨åœ¨çŠ¶æ€æœºçš„æ—¶å€™å› ä¸º cfgNum ä¸ç­‰äºå½“å‰çš„ cfgï¼Œæ‰€ä»¥è‡ªåŠ¨å±è”½æ‰äº†ï¼ˆå…¶å®è¿™ä¸ªé—®é¢˜åº”è¯¥ä¸éš¾å‘ç°ï¼Œä½†æˆ‘åœ¨æ‰“ log çš„æ—¶å€™æ²¡æœ‰å°† cfgNum ä½œä¸º log å¤´ï¼Œå°±æ²¡æ€ä¹ˆæ³¨æ„åˆ°ï¼Œæ‰¾äº†å¥½ä¹…ã€‚&lt;/li>
&lt;li>éœ€è¦æ€è€ƒæ€ä¹ˆåšåˆ° Multi-Raft çš„å¹‚ç­‰å’Œçº¿æ€§ä¸€è‡´æ€§ã€‚&lt;/li>
&lt;/ol></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/raft/" term="Raft" label="Raft"/><category scheme="https://loomt.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" term="åˆ†å¸ƒå¼" label="åˆ†å¸ƒå¼"/><category scheme="https://loomt.top/tags/6.824/" term="6.824" label="6.824"/></entry><entry><title type="text">6.824 Lab3</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/6.824-lab3/"/><id>https://loomt.top/posts/6.824-lab3/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2023-03-07T18:51:52+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">Task åœ¨ raft æ¡†æ¶çš„åŸºç¡€ä¸Šå»ºç«‹ä¸€ä¸ªå®¹é”™çš„ KV æ•°æ®åº“ã€‚é‡ç‚¹åœ¨äºç†è§£ Service å±‚å’Œ Raft å±‚çš„äº¤äº’ï¼Œä»£ç æ–¹é¢è¾ƒä¸ºç®€å•ï¼Œæ•…ä¸è¿›è¡Œèµ˜è¿°ã€‚ Step åœ¨ client å’Œ service ä¸¤å±‚å®Œæˆ Get(), Append(), Put() å¯¹é‡å¤çš„ Append æˆ– Put è¿›è¡Œå»é‡ service å±‚çš„å¿«ç…§â€¦</summary><content type="html">&lt;h1 id="task">Task&lt;/h1>
&lt;p>åœ¨ raft æ¡†æ¶çš„åŸºç¡€ä¸Šå»ºç«‹ä¸€ä¸ªå®¹é”™çš„ KV æ•°æ®åº“ã€‚é‡ç‚¹åœ¨äºç†è§£ Service å±‚å’Œ Raft å±‚çš„äº¤äº’ï¼Œä»£ç æ–¹é¢è¾ƒä¸ºç®€å•ï¼Œæ•…ä¸è¿›è¡Œèµ˜è¿°ã€‚&lt;/p>
&lt;h2 id="step">Step&lt;/h2>
&lt;ol>
&lt;li>åœ¨ client å’Œ service ä¸¤å±‚å®Œæˆ Get(), Append(), Put()&lt;/li>
&lt;li>å¯¹é‡å¤çš„ Append æˆ– Put è¿›è¡Œå»é‡&lt;/li>
&lt;li>service å±‚çš„å¿«ç…§ä¸æŒä¹…åŒ–ï¼ˆå¿«ç…§å­˜å‚¨çš„æ˜¯ Key/Value ç­‰å…ƒæ•°æ®ï¼‰
&lt;img src="https://loomt.top/img/824lab3.png" alt="lab3">&lt;/li>
&lt;/ol>
&lt;h2 id="tips">tipsï¼š&lt;/h2>
&lt;p>å€¼å¾—ä¸€æçš„æ˜¯åœ¨å†™å®Œ lab3 çš„å¤§æ¦‚æ¡†æ¶åï¼ŒTestSpeed3A ä¸€ç›´ä¸é€šè¿‡ï¼Œå› ä¸ºè¦æ±‚æ˜¯å¹³å‡ 33ms ä¸€ä¸ª commitï¼Œä½†æ­£å¸¸æ¥è¯´ commit æ—¶é—´åº”è¯¥å’Œ heartbeat timeout å·®ä¸å¤šï¼Œé‚ä¿®æ”¹ Start() å‡½æ•°ï¼Œåœ¨ command è¢« Service é€æ¥çš„æ—¶å€™å‘èµ·ä¸€æ¬¡å¿ƒè·³ï¼Œè¿›è¡Œæ—¥å¿—åŒæ­¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Raft&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Start&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">command&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{})&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">bool&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">Leader&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">NULL&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">NULL&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">index&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">term&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Entry&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">Command&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">command&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Term&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">term&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Index&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">index&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">})&lt;/span>
&lt;span class="nf">DPrintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dInfo&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;S%v &amp;lt;- %vst command %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">index&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">command&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">persist&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">startHeartbeatL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">heartbeatTimer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Reset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">getHeartbeatDuration&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">index&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">term&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä»¬è¿˜å¯ä»¥è¿›è¡Œä¸€ç‚¹ä¼˜åŒ–ï¼šå½“ Leader å‘é€å¿ƒè·³æ—¶ï¼ŒåŠ ä¸Šä¸€ä¸ª boolï¼Œè¡¨æ˜ Leader çœŸçš„åªæ˜¯å‘é€å¿ƒè·³ï¼Œæˆ–è€…æ˜¯ä¸ºäº†å¿«é€ŸåŒæ­¥æ—¥å¿—ï¼Œå¦‚æœæ˜¯åè€…ï¼Œè¿˜éœ€è¦åˆ¤æ–­æ¯ä¸€ä¸ª Follower çš„ nextIndex æ˜¯å¦éœ€è¦åŒæ­¥ï¼Œå¦‚æœä¸æ»¡è¶³ &lt;code>(rf.getLastLogL().Index &amp;gt; rf.nextIndex[i])&lt;/code>ï¼Œåˆ™ä¸å†åŒæ­¥æ—¥å¿—ã€‚&lt;/p>
&lt;p>æ­£å¸¸æ¥è¯´åˆ°è¿™ä¸€æ­¥å°±æ²¡é—®é¢˜äº†ï¼Œä½†æ˜¯æˆ‘åˆå‘ç°äº† lab2 çš„ä¸€ä¸ªé—ç•™ bugï¼Œå½“ commit é¢‘ç‡å˜å¾—å¾ˆå¿«æ—¶ Leader å°±ä¼šæš´æ¯™ï¼ˆä¹‹å‰çš„æµ‹è¯•ä»…ä»…é€šè¿‡ heartbeat timeout åŒæ­¥æ—¥å¿—ï¼Œé¢‘ç‡è¾ƒä½ï¼ŒåŸºæœ¬æ²¡æœ‰å‡ºç°è¿™ä¸ªé—®é¢˜ï¼‰ã€‚é€šè¿‡æ‰“ logï¼Œå‘ç° commit æ˜¯é€šè¿‡å•ç‹¬çš„ go routine æ¥æ”¶ channel çš„ä¿¡å·å®ç°çš„ï¼Œå› ä¸º channel åˆå§‹åŒ–ä¸º&lt;code>make(chan int,1)&lt;/code>ï¼Œåœ¨ Leader è¿ç»­ commit æ—¶å®¹æ˜“å µå¡ï¼Œå…¶å®ç†è®ºä¸Šä¼šç¼“æ…¢é€šè¿‡ï¼Œä½†è¿˜æ˜¯æš´æ¯™äº†ï¼Œå±äºæ˜¯ä¸€ä¸ªå¾ˆç„å­¦çš„ bugã€‚æœ€åå°† channel æ‰©å®¹æˆ 100 å°±è½»æ¾è¿‡äº†:)&lt;/p></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/raft/" term="Raft" label="Raft"/><category scheme="https://loomt.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" term="åˆ†å¸ƒå¼" label="åˆ†å¸ƒå¼"/><category scheme="https://loomt.top/tags/6.824/" term="6.824" label="6.824"/></entry><entry><title type="text">6.824 Lab2D</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/6.824-lab2d/"/><id>https://loomt.top/posts/6.824-lab2d/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2023-03-03T14:57:30+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">å‰ç½®èŠå£« Task å®Œæˆ Raft çš„å¿«ç…§åŠŸèƒ½ï¼ˆæ¶‰åŠåˆ°è¾ƒå¤šçš„ä¸ Service å±‚çš„äº¤äº’ã€‚ ä¸ºä»€ä¹ˆè¦æœ‰ snapshot? snapshot å¯ä»¥å°† log å‹ç¼©ï¼Œæ¯”å¦‚å°† 10 ä¸ª log å‹ç¼©æˆ 9 ä¸ªï¼ˆå½“ä¸¤ä¸ª log ä¿®æ”¹çš„ key å€¼ä¸€æ ·æ—¶ï¼‰ã€‚ snapshot å¯ä»¥å‡å°‘ Raft å±‚ log çš„é•¿åº¦ï¼Œå¸®â€¦</summary><content type="html">&lt;blockquote>
&lt;p>&lt;a href="https://loomt.top/posts/6.824-lab2">å‰ç½®èŠå£«&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h1 id="task">Task&lt;/h1>
&lt;p>å®Œæˆ Raft çš„å¿«ç…§åŠŸèƒ½ï¼ˆæ¶‰åŠåˆ°è¾ƒå¤šçš„ä¸ Service å±‚çš„äº¤äº’ã€‚&lt;/p>
&lt;ul>
&lt;li>ä¸ºä»€ä¹ˆè¦æœ‰ snapshot?
&lt;ol>
&lt;li>snapshot å¯ä»¥å°† log å‹ç¼©ï¼Œæ¯”å¦‚å°† 10 ä¸ª log å‹ç¼©æˆ 9 ä¸ªï¼ˆå½“ä¸¤ä¸ª log ä¿®æ”¹çš„ key å€¼ä¸€æ ·æ—¶ï¼‰ã€‚&lt;/li>
&lt;li>snapshot å¯ä»¥å‡å°‘ Raft å±‚ log çš„é•¿åº¦ï¼Œå¸®åŠ©è¿›åº¦è¾ƒæ…¢çš„ Raft èŠ‚ç‚¹å¿«é€Ÿæ¢å¤çŠ¶æ€æœºï¼ˆå‡çŸ­ raft ä¸­ log çš„é•¿åº¦ï¼‰ã€‚snapshot åŒºåˆ«äºæŒä¹…åŒ– logï¼Œåè€…ä¸»è¦æ˜¯ä¸è®©å®•æœºçš„ raft ä¸¢å¤±å¤ªå¤šæ—¥å¿—ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>åœ¨ 2D ä¸­ï¼Œsnapshot ä¼šæ¶‰åŠåˆ° raft å±‚ä¸ service å±‚çš„å¤šæ¬¡äº¤äº’ï¼Œçœ‹è¿™ä¸ª &lt;a href="https://pdos.csail.mit.edu/6.824/notes/raft_diagram.pdf">diagram of Raft interactions&lt;/a>Â  æˆ–è®¸å¯ä»¥å¸®åŠ©ç†è§£ Raft åè®®ä¸åŒå±‚æ¬¡çš„åŠŸèƒ½ä¸ç‰¹æ€§ã€‚&lt;/li>
&lt;li>snapshot ä½œç”¨äºæ¯ä¸€ä¸ª Raft èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è®°å½• snapshot æœ€åä¸€ä¸ª index å’Œ termï¼Œç”¨äºä¸€è‡´æ€§æ£€æŸ¥ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="step">Step&lt;/h2>
&lt;ol>
&lt;li>Snapshot() è¢« service å±‚è°ƒç”¨ï¼Œçº¦è« 10 æ¬¡ commit è°ƒç”¨ä¸€æ¬¡ï¼Œç”¨äºä¿å­˜å¿«ç…§ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¿«ç…§æ˜¯ service ä¼ ç»™ raft å±‚çš„ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬åœ¨ raft å±‚å†™å…¥æ—¥å¿—åˆ›å»ºçš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦åˆ›å»ºå¿«ç…§ï¼Œä»…éœ€è¦å¤„ç† Service å±‚ä¼ è¿›æ¥çš„ snapshotï¼Œè¿›è¡Œæ—¥å¿—æˆªæ–­å’Œå¿«ç…§æŒä¹…åŒ–ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Raft&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Snapshot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">index&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">snapshot&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">lastIncludedIndex&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="nx">index&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">term&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">index&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">index&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">lastIncludedIndex&lt;/span>&lt;span class="p">():]&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">setLastIncludedIndex&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">index&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">setLastIncludedTerm&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">term&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">persister&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SaveStateAndSnapshot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getEncodeStateL&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">snapshot&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">DPrintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dSnap&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;S%v last: %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">index&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://loomt.top/img/snapshot.png" alt="snapshot">
2. InstallSnapshotï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Leader æ–¹é¢ï¼Œå½“$nextIndex[Follower] \leq Leader.lastIncludeIndex$çš„æ—¶å€™ï¼Œç”±äº Leader å·²ç»æ²¡æœ‰è¿™éƒ¨åˆ†çš„æ—¥å¿—ï¼ŒLeader ä¼šå‘é€ InstallSnapshot RPC ç»™ Followerï¼Œè¯·æ±‚ Follower å®‰è£…å¿«ç…§ï¼ˆå¿«é€Ÿè¿½èµ¶ï¼‰ï¼Œå¹¶ä¸”åœ¨æˆåŠŸæ”¶åˆ°è¿”å›å€¼åï¼ŒLeader ä¼šæ›´æ–° nextIndex å’Œ matchIndex&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Follower æ–¹é¢ï¼Œå¦‚æœ Follower æ”¶åˆ° Leader çš„ä»»æœŸæ²¡æœ‰è¿‡æœŸçš„è¯ï¼Œåªèƒ½æ‰§è¡Œã€‚ä¸è®ºæ–‡ä¸åŒçš„æ˜¯ï¼šä¸éœ€è¦è€ƒè™‘åˆ†å—å‘é€ snapshotï¼Œæ‰€ä»¥&lt;code>offset&lt;/code> å’Œ&lt;code>done&lt;/code>éƒ½ä¸éœ€è¦è€ƒè™‘ï¼Œç›¸åº”çš„ï¼Œåœ¨å®ç°çš„æ—¶å€™ä¹Ÿä¸éœ€è¦è€ƒè™‘ç¬¬ 2,3,4 ç‚¹ implementationã€‚æœ€åå¦èµ·ä¸€ä¸ª go routine ä¼  snapshot ä»¥åŠå…¶ä»–å¿…è¦å‚æ•°ç»™ applyCh è®© service æ›´æ–°çŠ¶æ€æœºï¼ˆå‘é€ç»™ service å service ä¸ä¼šç«‹åˆ»æ‹¿ snapshot æ›´æ–°çŠ¶æ€æœºï¼Œä¼šå…ˆè°ƒç”¨ CondInstallsnapshot æ¥è¯¢é—® Follower åœ¨è¿™æœŸé—´æœ‰æ²¡æœ‰ commitï¼Œè‹¥æ²¡æœ‰ï¼Œæ‰ä¼šç”¨ snapshot æ›´æ–°çŠ¶æ€æœºã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://loomt.top/img/installSnapshotRPC.png" alt="snapshotRPC">&lt;/p>
&lt;ul>
&lt;li>CondInstallSnapshotï¼šè‹¥ $lastIncludedIndex\leq commitIndex$ ï¼Œåˆ™è¿”å›&lt;code>false&lt;/code>ï¼Œæ­¤æ—¶ service ä¸ä¼šåº”ç”¨ snapshotï¼›å¦åˆ™å‰ªçŸ­è‡ªå·±çš„ logï¼Œå¹¶æ›´æ–° snapshotã€lastIncludedTerm å’Œ lastIncludedIndexï¼Œå¹¶è¿›è¡ŒæŒä¹…åŒ–ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="tips">tipsï¼š&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>åœ¨æŒä¹…åŒ–çš„æ—¶å€™è€ƒè™‘ lastIncludedIndex å’Œ lastIncludedTermï¼Œå¹¶åº”ç”¨åˆ° commitIndex å’Œ lastAppliedã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å› ä¸ºæˆ‘ä»¬è¦åˆ æ‰å·²ç»è¢« snapshot çš„ logï¼Œæ‰€ä»¥éœ€è¦æ”¹å˜ log çš„ç´¢å¼•æ–¹å¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹ condInstallsnapshot çš„è§£é‡Šï¼šFollower æ”¶åˆ° InstallSnapshotï¼Œå‘æœåŠ¡å™¨è¯·æ±‚åº”ç”¨ snapshot çš„æ—¶å€™ï¼Œå¦‚æœæœåŠ¡å™¨å‘é€ condInstallSnapshot çš„é‚£ä¸€åˆ» lastCommit è¿˜æ²¡è¢«ä¿®æ”¹çš„è¯ï¼Œå°±ä¿è¯äº†åŸå­æ“ä½œã€‚ä¸ºä»€ä¹ˆéœ€è¦ä¿è¯åŸå­æ“ä½œï¼Ÿå› ä¸ºèŠ‚ç‚¹é€šè¿‡ applychan å‘ service é€šä¿¡çš„æƒ…å†µæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ commit åˆ°çŠ¶æ€æœºï¼Œå¦ä¸€ç§æ˜¯ snapshot åˆ°çŠ¶æ€æœºï¼Œä¸¤è€…æ˜¯å¹¶è¡Œçš„ï¼Œäº’ä¸å¹²æ‰°ã€‚åªè¦ raft èŠ‚ç‚¹åœ¨å‘é€ snapshot channel åˆ° service æ¥æ”¶åˆ°è¿™ä¸ª channel ä¹‹é—´æœ‰ commit channelï¼Œä¹Ÿå°±æ˜¯å½“ $lastIncludedIndex\leq commitIndex$ çš„æ—¶å€™ï¼Œsnapshot å‘é€çš„ log å°±å¾ˆæœ‰å¯èƒ½è¢«åº”ç”¨åˆ°çŠ¶æ€æœºäº†ã€‚&lt;/p>
&lt;/li>
&lt;/ol></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/raft/" term="Raft" label="Raft"/><category scheme="https://loomt.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" term="åˆ†å¸ƒå¼" label="åˆ†å¸ƒå¼"/><category scheme="https://loomt.top/tags/6.824/" term="6.824" label="6.824"/></entry><entry><title type="text">6.824 Lab2C</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/6.824-lab2c/"/><id>https://loomt.top/posts/6.824-lab2c/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2023-03-03T14:57:20+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">å‰ç½®èŠå£« Task å®Œæˆ Raft çš„æŒä¹…åŒ–ã€‚ Step å¦‚æœå‰é¢åšå¾—å¥½ï¼Œåªéœ€è¦å®ŒæˆæŒä¹…åŒ–ã€‚ æŒä¹…åŒ–è‡³ Service å±‚ 1 persist() Crash åä» Service å±‚æ¢å¤ 1 readPersist(data []byte) å¦‚æœå’Œæˆ‘ä¸€æ ·å‰é¢å·®ç‚¹æ„æ€ï¼Œå°±è¦å°ä¿®ä¸€ä¸‹ guide AppendEntries Handler ä¸­ï¼ŒFolloweâ€¦</summary><content type="html">&lt;blockquote>
&lt;p>&lt;a href="https://loomt.top/posts/6.824-lab2">å‰ç½®èŠå£«&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h1 id="task">Task&lt;/h1>
&lt;p>å®Œæˆ Raft çš„æŒä¹…åŒ–ã€‚&lt;/p>
&lt;h2 id="step">Step&lt;/h2>
&lt;p>å¦‚æœå‰é¢åšå¾—å¥½ï¼Œåªéœ€è¦å®ŒæˆæŒä¹…åŒ–ã€‚&lt;/p>
&lt;ol>
&lt;li>æŒä¹…åŒ–è‡³ Service å±‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nf">persist&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>Crash åä» Service å±‚æ¢å¤&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nf">readPersist&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>å¦‚æœå’Œæˆ‘ä¸€æ ·å‰é¢å·®ç‚¹æ„æ€ï¼Œå°±è¦å°ä¿®ä¸€ä¸‹
&lt;a href="https://thesquareplanet.com/blog/students-guide-to-raft/#an-aside-on-optimizations">guide&lt;/a>&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>AppendEntries Handler ä¸­ï¼ŒFollower å¼•å…¥ XTerm å’Œ XIndex æ¥å¿«é€Ÿè°ƒæ•´ nextIndexã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="k">if&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Success&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XIndex&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="c1">// Follower&amp;#39;s nextIndex
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// entry logAt prevLogIndex whose term doesn&amp;#39;t match prevLogTerm
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nf">DPrintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dInfo&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;S%v prevLogTerm:%v, prevLogIndex:%v,log[prevLogIndex].Term:%v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogTerm&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogTerm&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Success&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XIndex&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XTerm&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">--&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XTerm&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XIndex&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">i&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">DPrintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dInfo&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;S%v XIndex = %v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Leader å¯¹ XTerm å’Œ XIndex çš„å¤„ç†&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">sendAppendEntries&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">peer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">reply&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="c1">//changeState but not update election timer
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Success&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="c1">// update nextIndex, matchIndex &amp;amp; commit
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="c1">// adjust nextIndex
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XIndex&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">NULL&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">DPrintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dHeart&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;S%v &amp;lt;- S%v heartbeat XIndex:%v, XTerm:%v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">peer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XIndex&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XTerm&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XTerm&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">NULL&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">peer&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XIndex&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">ok&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">peer&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">lastIncludedIndex&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XTerm&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">--&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XTerm&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">ok&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">peer&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;span class="k">break&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">ok&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">peer&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">XIndex&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>electionTimer ä¸èƒ½åœ¨æ¯æ¬¡å˜æˆ Follower çš„æ—¶å€™é‡ç½®ã€‚&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>If election timeout elapses without receiving AppendEntries RPC from current Leader or granting vote to Candidate: convert to Candidate.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>The distinction turns out to matter a lot, as the former implementation can result in significantly reduced liveness in certain situations.&lt;/p>
&lt;/blockquote>
&lt;p>electionTimer é‡ç½®ä»…åœ¨ä»¥ä¸‹æƒ…å†µå‘ç”Ÿï¼š&lt;/p>
&lt;ul>
&lt;li>åˆšæˆä¸º Candidateã€‚&lt;/li>
&lt;li>ç»™åˆ«äººæŠ•ç¥¨åã€‚&lt;/li>
&lt;li>Follower æ”¶åˆ° AppendEntries æˆ–è€… InstallSnapshotï¼Œå¹¶ä¸” args.Term ç­‰äºè‡ªå·±å½“å‰çš„ termï¼ˆåœ¨&lt;a href="https://loomt.top/posts/6.824-lab2B">å‰ç½®èŠå£«&lt;/a>æœ‰è°ˆåˆ°ï¼Œå…¶å®è¿™ä¸ª bug æ˜¯æˆ‘åœ¨ 2C çš„æ—¶å€™æ‰ä¿®çš„ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>æˆ‘åœ¨ Follower æ”¶åˆ° AppendEntries æˆ–è€… InstallSnapshotï¼Œå¹¶ä¸” args.Term å¤§äº currentTerm çš„æ—¶å€™ä¹Ÿé‡ç½®äº† electionTimerã€‚æ”¹ä¸ºä¸é‡ç½®åï¼Œç›´è§‚çš„ç»“æœæ˜¯è·‘ 2C çš„ test å¹³å‡å¿«äº† 15sï¼Œå¹¶ä¸”ä¸ä¼šå‡ºç°&lt;code>fail to reach agreement&lt;/code>äº†ã€‚&lt;/p></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/raft/" term="Raft" label="Raft"/><category scheme="https://loomt.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" term="åˆ†å¸ƒå¼" label="åˆ†å¸ƒå¼"/><category scheme="https://loomt.top/tags/6.824/" term="6.824" label="6.824"/></entry><entry><title type="text">6.824 Lab2B</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/6.824-lab2b/"/><id>https://loomt.top/posts/6.824-lab2b/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2023-03-03T14:57:17+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">å‰ç½®èŠå£« Task å¤„ç†æ—¥å¿—ï¼Œå…·ä½“æ¥è¯´æ˜¯æ¥æ”¶ Service å±‚å‘æ¥çš„æ—¥å¿—ï¼Œæ—¥å¿—å¤åˆ¶ï¼Œåº”ç”¨æ—¥å¿—ã€‚ æ¶‰åŠåˆ°ä¸€ç‚¹ Raft å±‚ä¸ Service å±‚çš„äº¤äº’ï¼Œæ¯”å¦‚ Leader æ¥å— command å¹¶ä¿å­˜ä¸ºæ—¥å¿—ï¼›Apply æ—¥å¿—åˆ° Service å±‚ã€‚ Step é€‰ä¸¾çš„æ—¶å€™éœ€â€¦</summary><content type="html">&lt;blockquote>
&lt;p>&lt;a href="https://loomt.top/posts/6.824-lab2">å‰ç½®èŠå£«&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h1 id="task">Task&lt;/h1>
&lt;p>å¤„ç†æ—¥å¿—ï¼Œå…·ä½“æ¥è¯´æ˜¯æ¥æ”¶ Service å±‚å‘æ¥çš„æ—¥å¿—ï¼Œæ—¥å¿—å¤åˆ¶ï¼Œåº”ç”¨æ—¥å¿—ã€‚&lt;/p>
&lt;p>æ¶‰åŠåˆ°ä¸€ç‚¹ Raft å±‚ä¸ Service å±‚çš„äº¤äº’ï¼Œæ¯”å¦‚ Leader æ¥å— command å¹¶ä¿å­˜ä¸ºæ—¥å¿—ï¼›Apply æ—¥å¿—åˆ° Service å±‚ã€‚&lt;/p>
&lt;h2 id="step">Step&lt;/h2>
&lt;ol>
&lt;li>é€‰ä¸¾çš„æ—¶å€™éœ€è¦é¢å¤–æ³¨æ„ä¸€ä¸ªé™åˆ¶ï¼šåªæŠ•ç¥¨ç»™ log æ¯”è‡ªå·±æ–°çš„ Candidateã€‚&lt;/li>
&lt;li>Leader æ¥å— commandï¼Œappend è¿› logï¼Œè¿”å›æ­¤ command çš„ä¸‹æ ‡ï¼Œæ­¤æ—¶ log åœ¨çŠ¶æ€æœºä¸­è¿˜æ²¡è¢«åº”ç”¨ã€‚&lt;/li>
&lt;li>å¿ƒè·³æ—¶é¡ºä¾¿å‘é€æ—¥å¿—ç»™ Followerï¼ˆä¹Ÿå¯ä»¥åˆ†å¼€ï¼‰ã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>AppendEntries RPC å‚æ•°ä¸­çš„ log éœ€è¦æ·±æ‹·è´æ‰èƒ½å…é­ data raceã€‚&lt;/li>
&lt;li>å‘é€çš„ log å¹¶ä¸æ˜¯ä»å¤´å¼€å§‹ï¼Œè€Œæ˜¯ä» nextIndex å¼€å§‹ã€‚&lt;/li>
&lt;li>åœ¨ä¸å¯é ç½‘ç»œä¸­ï¼Œæ”¶åˆ° RPC ç»“æœçš„æ—¶å€™å¯èƒ½å·²ç»è¿‡äº†å‡ ä¸ªä»»æœŸï¼Œæ­¤æ—¶éœ€è¦å…ˆæ£€æŸ¥ä¸€ä¸‹ args.Term è¿˜ç­‰ä¸ç­‰äº currentTermï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œå¦‚æœè¿”å›çš„ä»»æœŸæ¯” currentTerm è¿˜è¦å¤§ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯ä¸æ˜¯ä¸å¯é ç½‘ç»œï¼Œè¿™ä¸ª Leader éƒ½è¦è½¬ä¸º Followerï¼ˆåŒæ ·çš„ï¼Œå› ä¸ºä¸ç¡®å®šä»–æœ‰æ²¡æœ‰èµ„æ ¼æˆä¸º Candidateï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦å°†å…¶è½¬ä¸º Candidateï¼Œåæ­£ä»»æœŸå¢åŠ åæ€»ä¼šæœ‰ Candidate äº§ç”Ÿï¼‰ï¼›å¦‚æœè¿”å›çš„ä»»æœŸå°äºç­‰äº currentTermï¼Œé‚£ä¹ˆ Leader åªéœ€è¦æ­£å¸¸å¤„ç†ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">sendAppendEntries&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">peer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">reply&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="c1">//changeState but not update election timer
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Success&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="c1">// update nextIndex, matchIndex &amp;amp; commit
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="c1">// adjust nextIndex
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">peer&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nf">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">peer&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>Follower è¿›è¡Œæ—¥å¿—å¤åˆ¶ï¼ˆéœ€ä¸¥æ ¼æŒ‰ç…§è®ºæ–‡ï¼‰ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="nx">prevLogIndex&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;span class="nx">prevLogTerm&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">prevLogIndex&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span>
&lt;span class="nx">args&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">AppendEntriesArgs&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">Term&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">LeaderId&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">prevLogIndex&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">PrevLogTerm&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">prevLogTerm&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Entries&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="nx">Entry&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">prevLogIndex&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="nx">LeaderCommit&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// å¿…é¡»è¦å¤åˆ¶ä¸€éæ‰èƒ½å…é­ data race
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nb">copy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Entries&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">prevLogIndex&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">lastIncludedIndex&lt;/span>&lt;span class="p">():])&lt;/span>
&lt;span class="k">go&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">foraHeartbeat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="5">
&lt;li>AppendEntries RPC å›å¤ååº”å¦‚ä½•æ”¹å˜è‡ªèº«çŠ¶æ€ã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>å…ˆè¿›è¡Œä¸€ä¸ª term çš„å¤„ç†&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="k">if&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Success&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">changeStateL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Follower&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">NULL&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">changeStateL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Follower&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">votedFor&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">electionTimer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Reset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">getElectionDuration&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å†çœ‹çœ‹è‡ªå·±çš„ log ä¸ RPC ä¼ æ¥çš„ entries æœ‰æ²¡æœ‰å†²çªï¼Œæœ‰çš„è¯ä»¥ Leader ä¸ºå‡†ï¼›è¿”å›å‚æ•°è°ƒæ•´è‡ªå·±åœ¨ Leader é‚£è¾¹çš„ nextIndexï¼Œç›´åˆ°å’Œ Leader prevLogIndex çš„ term ä¸€è‡´ä¸ºæ­¢ï¼Œæ‰èƒ½çœŸæ­£ append entriesã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">// last log index is too small
&lt;/span>&lt;span class="c1">// entry logAt prevLogIndex whose term doesn&amp;#39;t match prevLogTerm
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogTerm&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Success&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// log æ¯” Leader çŸ­ || log æ¯” Leader é•¿å¹¶ä¸”å­˜åœ¨ä¸åŒ¹é… -&amp;gt; æˆªæ–­å¹¶è¡¥ä¸Š
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nx">needReplace&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Entries&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Entries&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Entries&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="c1">// idx and term can identify a log
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Entries&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">needReplace&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="k">break&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">needReplace&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PrevLogIndex&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">lastIncludedIndex&lt;/span>&lt;span class="p">()],&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Entries&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>commit è‡ªå·±çš„æ—¥å¿—ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="k">if&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">LeaderCommit&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">LeaderCommit&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Entries&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nf">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Entries&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Entries&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">Index&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nf">DPrintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dInfo&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;S%v lastIndex:%v, commIndex:%v, lastApplied:%v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lastApplied&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lastApplied&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">applyWaker&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Success&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="6">
&lt;li>Leader æ–¹é¢ï¼Œåªæœ‰å½“å¤§éƒ¨åˆ† Follower çš„ matchIndex æ›´æ–°ï¼ˆlog å­˜åˆ° Followerï¼‰äº†ï¼ŒLeader çš„ commitIndex æ‰èƒ½åŒæ­¥æ›´æ–°ã€‚è¿™éƒ¨åˆ†æˆ‘ç›´æ¥ä»åå¾€å‰éå†ï¼Œå› ä¸ºæ—¥å¿—çš„ä»»æœŸæ˜¯æŒ‰é¡ºåºå¢é•¿çš„ï¼Œæ‰€ä»¥å¦‚æœé‡åˆ°æ—¥å¿—ä»»æœŸå°äºå½“å‰ä»»æœŸç›´æ¥ breakï¼Œå› ä¸º Leader åªèƒ½å°†è‡ªå·±ä»»æœŸçš„æ—¥å¿— commitï¼Œå¯¹äºå…¶ä»–ä»»æœŸçš„æ—¥å¿—ï¼Œåªèƒ½è¢«åŠ¨ commitã€‚åœ¨ lab ä¸­ï¼Œæ²¡æœ‰éœ€è¦ Leader&lt;strong>åŠæ—¶&lt;/strong>æ›´æ–°æ—§ commit çš„æƒ…å†µï¼Œæ‰€ä»¥ä¸åšç‰¹æ®Šå¤„ç†ï¼ˆåœ¨æˆä¸º Leader çš„æ—¶å€™å‘ä¸€ä¸ªç©ºæ—¥å¿—ï¼‰ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">--&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">logAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">break&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">cnt&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">p&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">peers&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">p&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">p&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">cnt&lt;/span>&lt;span class="o">++&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">cnt&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">peers&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">commitIndex&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">i&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">applyWaker&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;span class="k">break&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="tips">Tips&lt;/h2>
&lt;ol>
&lt;li>åœ¨ currentTerm &amp;lt; args.Term çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…¶å®æ˜¯ä¸éœ€è¦é‡ç½®é€‰ä¸¾æ—¶é—´çš„ï¼Œå› ä¸ºå¦‚æœå‡ºç°äº†ä¸€ä¸ª Leader æ¯”è‡ªå·±ä»»æœŸå¤§ï¼Œè¯´æ˜è‡ªå·±æ²¡æœ‰ç»™ä»–æŠ•è¿‡ç¥¨ï¼Œä½†ä»–å¾—åˆ°äº†åŠæ•°èŠ‚ç‚¹çš„æ”¯æŒï¼Œè¯´æ˜è‡³å°‘åŠæ•°èŠ‚ç‚¹æœ‰æˆä¸º Candidate çš„æ½œè´¨ï¼Œå¹¶ä¸”å¦‚æœè‡ªå·±çœŸçš„å¼€å§‹é€‰ä¸¾çš„è¯ï¼Œä¼šå‘é€æ— ç”¨çš„ RPCï¼Œé™ä½ Raft çš„è¿è¡Œæ•ˆç‡ã€‚&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>If you follow the rule from Figure 2, the servers with the more up-to-date logs wonâ€™t be interrupted by outdated serversâ€™ elections, and so are more likely to complete the election and become the Leader.&lt;/p>
&lt;/blockquote>
&lt;ol start="2">
&lt;li>å‘é€ heartbeat çš„æ—¶å€™éœ€è¦æ³¨æ„è‡ªå·±è¿˜æ˜¯ä¸æ˜¯ Leaderã€‚&lt;/li>
&lt;/ol>
&lt;p>å› ä¸ºæˆ‘å¿½ç•¥äº†è¿™ä¸ªç‚¹ï¼Œå¯¼è‡´ Leader crash å†æ¢å¤çš„æ—¶å€™æœ‰å¾ˆå°çš„æ¦‚ç‡å‡ºç°ä¸€ä¸ªæœ‰ç‚¹æ€ªçš„ bugï¼šæ¢å¤çš„ä¸€ç¬é—´ï¼ŒLeader æƒ³å°†è‡ªå·±ç§¯ç´¯å·²ä¹…çš„æ—¥å¿—å‘ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œè¢«æ‹’æ”¶åå‘ç°è‡ªå·±çš„ term è¿‡æœŸäº†ï¼Œäºæ˜¯å°†è‡ªå·±è½¬ä¸º Followerâ€¦â€¦ å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ— æ³•å®Œæˆä¸€è‡´æ€§æ£€éªŒï¼Œé€šè¿‡æ‰“ log å‘ç° Leader åœ¨è½¬ä¸º Follower åçš„ä¸€ç¬é—´å‘é€äº†æœ€åä¸€æ³¢å¿ƒè·³ï¼Œäºæ˜¯æ£€æŸ¥ä»£ç ï¼Œå‘ç°æˆ‘åœ¨å‘é€å¿ƒè·³ç»™ä¸åŒçš„ peer çš„æ—¶å€™ç”¨çš„æ˜¯ go routine å¥— go routineï¼Œ&lt;strong>æœªèƒ½ä¿è¯åŸå­æ“ä½œ&lt;/strong>ï¼Œåœ¨å°†è¦å‘é€å¿ƒè·³çš„æ—¶å€™ï¼ŒLeader å·²ç»ä¸å†æ˜¯ Leader äº†ï¼Œä½†è¿˜æ˜¯åšå‡ºäº† Leader çš„è¡Œä¸ºï¼Œæ‰€ä»¥éœ€è¦åœ¨å‘é€å‰æ ¸éªŒè‡ªå·±çš„ Leader èº«ä»½ã€‚&lt;/p>
&lt;ol start="3">
&lt;li>åœ¨ updateCommit çš„æ—¶å€™æˆ‘æƒ³ç›´æ¥åˆ¤æ–­æˆåŠŸè¿”å› AppendEntries RPC çš„ Follower æ•°é‡ï¼Œå¦‚æœè¶…è¿‡ä¸€åŠå°±æ›´æ–° Leader commitIndex = lastLog.indexï¼Œä½†å› ä¸ºå‘é€å’Œæ¥å— RPC å¹¶éåŸå­ï¼Œå¯èƒ½ä¼šå­˜åœ¨å‰é¢çš„ Follower æœªåŒ…å«åé¢æ–°å¢çš„ log çš„æƒ…å†µã€‚&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>If there exists an N such that N &amp;gt; commitIndex, a majority of matchIndex[i] â‰¥ N, and log[N].term == currentTerm: set commitIndex = N (Â§5.3, Â§5.4).&lt;/p>
&lt;/blockquote></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/raft/" term="Raft" label="Raft"/><category scheme="https://loomt.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" term="åˆ†å¸ƒå¼" label="åˆ†å¸ƒå¼"/><category scheme="https://loomt.top/tags/6.824/" term="6.824" label="6.824"/></entry><entry><title type="text">6.824 Lab2A</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/6.824-lab2a/"/><id>https://loomt.top/posts/6.824-lab2a/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2023-03-03T14:57:12+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">Task å®Œæˆå„ç§æƒ…å†µçš„é¢†å¯¼äººé€‰ä¸¾ã€‚ æˆ‘ä»¬é¦–å…ˆéœ€è¦ç†Ÿæ‚‰ä¸€ä¸‹ Raft çš„å·¥ä½œåŸç†ï¼Œå»ºè®®å…ˆè¿‡ä¸€é å‰ç½®èŠå£«ã€‚ Step å…ˆå®Œå–„ Raft ç»“æ„å’Œ Make å‡½æ•°ï¼Œå†ç»“åˆ Gif æ€è€ƒå•ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ã€‚ èŠ‚ç‚¹å¼€å§‹æ—¶çš„çŠ¶æ€æ˜¯ Folâ€¦</summary><content type="html">&lt;h1 id="task">Task&lt;/h1>
&lt;p>å®Œæˆå„ç§æƒ…å†µçš„é¢†å¯¼äººé€‰ä¸¾ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬é¦–å…ˆéœ€è¦ç†Ÿæ‚‰ä¸€ä¸‹ Raft çš„å·¥ä½œåŸç†ï¼Œå»ºè®®å…ˆè¿‡ä¸€é &lt;a href="https://loomt.top/posts/6.824-lab2">å‰ç½®èŠå£«&lt;/a>ã€‚&lt;/p>
&lt;h2 id="step">Step&lt;/h2>
&lt;ol>
&lt;li>å…ˆå®Œå–„ Raft ç»“æ„å’Œ Make å‡½æ•°ï¼Œå†ç»“åˆ &lt;a href="http://thesecretlivesofdata.com/raft/">Gif&lt;/a> æ€è€ƒå•ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ã€‚&lt;/li>
&lt;li>èŠ‚ç‚¹å¼€å§‹æ—¶çš„çŠ¶æ€æ˜¯ Followerï¼Œelection timeout åï¼ŒçŠ¶æ€ä¼šæ”¹ä¸º Candidateã€‚æˆ‘ä»¬åº”è¯¥å¦‚ä½•è®¾è®¡é€‰ä¸¾è¶…æ—¶ï¼Œå½“ç„¶æ˜¯å¼€ä¸€ä¸ª go routine&lt;code>rf.ticker()&lt;/code> å¯¹è¶…æ—¶è¿›è¡Œæ£€æµ‹ã€‚é‚£ä¹ˆæ˜¯ç”¨&lt;code>time.Sleep&lt;/code>è¿˜æ˜¯&lt;code>time.Timer&lt;/code>å®ç°å‘¢ï¼Ÿå®˜æ–¹çš„å»ºè®®æ˜¯ç”¨ sleepï¼Œä½†æˆ‘ç”¨çš„æ˜¯ timerï¼Œä¹Ÿèƒ½å¤Ÿæ­£å¸¸å®ç°ï¼Œå¹¶ä¸”æˆ‘è¿˜å®ç°äº† sleep çš„ç‰ˆæœ¬ï¼Œæ„Ÿè§‰é€Ÿåº¦ä¸Šç›¸å·®æ— å‡ ã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>ticker&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Raft&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">ticker&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">killed&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">select&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">case&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">heartbeatTimer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">C&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">Leader&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">startHeartbeatL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">heartbeatTimer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Reset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">getHeartbeatDuration&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">electionTimer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Reset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">getElectionDuration&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">case&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">electionTimer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">C&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">startElectionL&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">electionTimer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Reset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">getElectionDuration&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>èŠ‚ç‚¹æˆä¸º Candidate åå¹¶å‘å‘é€ RequestVote RPCï¼Œè‡ªå·±å¦‚ä½•å¤„ç† RPC è¿”å›çš„ç»“æœï¼Œå¦‚ä½•åˆ¤æ–­æŠ•ç»™è‡ªå·±çš„èŠ‚ç‚¹æ•°é‡æ˜¯å¦è¶…è¿‡åŠæ•°ï¼Ÿ&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>Leader election&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Raft&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">foraVote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">peer&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">RequestVoteArgs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">cnt&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">reply&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">RequestVoteReply&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;span class="nf">DPrintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dVote&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;S%v -&amp;gt; S%v send vote&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">peer&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">sendRequestVote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">peer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">reply&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">state&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">Candidate&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">VoteGranted&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">DPrintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dVote&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;S%v &amp;lt;- S%v voted&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">peer&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="o">*&lt;/span>&lt;span class="nx">cnt&lt;/span>&lt;span class="o">++&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">cnt&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">peers&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">peers&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">matchIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="nf">DPrintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dHeart&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;S%v &amp;lt;- S%v nextIndex:%v&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextIndex&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">])&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">changeStateL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Leader&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">DPrintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dVote&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;S%v &amp;lt;- S%v ~voted&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">me&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">peer&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">changeStateL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Follower&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">NULL&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">persist&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>peer èŠ‚ç‚¹ä»å“ªäº›æ–¹é¢å¤„ç†æŠ•ç¥¨é€»è¾‘ï¼Œä»»æœŸï¼Ÿæ—¥å¿—æƒ…å†µï¼ˆ2Bï¼‰ï¼Ÿ&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>Follower RequestVote RPC handler&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Raft&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">RequestVote&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">args&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">RequestVoteArgs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">RequestVoteReply&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">persist&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="c1">// currTerm higher || voted
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">votedFor&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nx">NULL&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">VoteGranted&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">changeStateL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Follower&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">NULL&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// check log leader
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">// candidate lastLogTerm to short || (lastLogTerm=rf.lastLogTerm &amp;amp;&amp;amp; candidate lastLogIndex to short)
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">LastLogTerm&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">LastLogTerm&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">getLastLogL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">Index&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">LastLogIndex&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">VoteGranted&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">changeStateL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Follower&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">CandidateId&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">electionTimer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Reset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">getElectionDuration&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Term&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">VoteGranted&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentTerm&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="tips">Tips&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>Candidate é€‰ä¸¾å‰è¦å…ˆè‡ªå¢ &lt;code>currentTerm&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ 2A ä¸­ï¼Œæˆ‘ä»¬å¤„ç† RequestVote Handler çš„æ—¶å€™è¿˜ä¸éœ€è¦å…³æ³¨æ—¥å¿—çš„æ–°æ—§ï¼ˆ2Bï¼‰ï¼Œrf.persist() ä¹Ÿè¿˜ä¸éœ€è¦å…³æ³¨ï¼ˆ2Cï¼‰ï¼Œä»…éœ€è¦æ€è€ƒä»»æœŸåº”è¯¥å¦‚ä½•å¤„ç†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å› ä¸ºå¤„ç†æŠ•ç¥¨ RPC çš„è¿”å›æ—¶éœ€è¦åŠ é”ä¿è¯ rf ç»“æ„çš„åŸå­è¯»å–å’Œå†™å…¥ï¼Œé¡ºä¾¿å°±å¯ä»¥è¿›è¡ŒæŠ•ç¥¨æ•°é‡çš„è®¡æ•°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Candidate æˆä¸º Leader æ—¶ï¼Œéœ€è¦åŠæ—¶å‘é€ heartbeatï¼Œå‘Šè¯‰åˆ«äººè‡ªå·±æ˜¯è€å¤§ï¼Œé˜»æ­¢ä»–ä»¬çš„é€‰ä¸¾ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>heartbeat é¢‘ç‡ä¸èƒ½å¤ªé«˜ï¼Œæ§åˆ¶åœ¨æ¯ç§’ 10 æ¬¡ä»¥å†…ï¼Œå¦åˆ™ä¼šçªç„¶å®•æœºï¼ˆä½†å…¶å®æˆ‘äº²æµ‹ heartbeatTimeout è®¾ä¸º 60msï¼Œelection è®¾ä¸º rand(180)+180ï¼Œtest äº† 1k æ¬¡æ²¡ä¸€æ¬¡æ˜¯ fail çš„ï¼‰ã€‚&lt;/p>
&lt;blockquote>
&lt;p>The paper&amp;rsquo;s Section 5.2 mentions election timeouts in the range of 150 to 300 milliseconds. Such a range only makes sense if the Leader sends heartbeats considerably more often than once per 150 milliseconds (e.g., once per 10 milliseconds). Because the tester limits you tens of heartbeats per second, you will have to use an election timeout larger than the paper&amp;rsquo;s 150 to 300 milliseconds, but not too large, because then you may fail to elect a Leader within five seconds.&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;/ol></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/raft/" term="Raft" label="Raft"/><category scheme="https://loomt.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" term="åˆ†å¸ƒå¼" label="åˆ†å¸ƒå¼"/><category scheme="https://loomt.top/tags/6.824/" term="6.824" label="6.824"/></entry><entry><title type="text">6.824 Lab2</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/6.824-lab2/"/><id>https://loomt.top/posts/6.824-lab2/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2023-02-04T18:09:59+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">Raft Raft æ˜¯ä¸€ä¸ªå®ç°åˆ†å¸ƒå¼å…±è¯†çš„åè®®ï¼Œä¸»è¦è§£å†³çš„æ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„é—®é¢˜ã€‚ Overview å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ª Raft æ¶æ„çš„æœåŠ¡ã€‚æˆ‘ä»¬å°†è¿™ä¸ªæœåŠ¡åˆ†ä¸ºä¸‰å±‚ï¼ŒClientï¼ŒServiceï¼ŒRaftã€‚Câ€¦</summary><content type="html">&lt;h1 id="raft">Raft&lt;/h1>
&lt;p>Raft æ˜¯ä¸€ä¸ªå®ç°åˆ†å¸ƒå¼å…±è¯†çš„åè®®ï¼Œä¸»è¦è§£å†³çš„æ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ª Raft æ¶æ„çš„æœåŠ¡ã€‚æˆ‘ä»¬å°†è¿™ä¸ªæœåŠ¡åˆ†ä¸ºä¸‰å±‚ï¼ŒClientï¼ŒServiceï¼ŒRaftã€‚Client å±‚é¦–å…ˆå‘é€è¯·æ±‚ç»™ Service å±‚ï¼Œç„¶å Service å±‚è§£æè¯·æ±‚ä¸º&lt;code>command&lt;/code>ï¼Œå°†&lt;code>command&lt;/code>å‘é€ç»™ Raft å±‚çš„ Leaderã€‚Leader åœ¨ä¸€å®šæ—¶é—´å†…é€šçŸ¥ Service å±‚ &amp;ldquo;apply&amp;rdquo; åŒ…å«è¿™ä¸ª&lt;code>command&lt;/code>çš„æ—¥å¿—ï¼ŒService å±‚æ‰å¯ä»¥å°†è¿™æ¡æ—¥å¿—ä¿å­˜åˆ°çŠ¶æ€æœºï¼Œè¿›è€Œè¿”å›å¯¹åº”çš„ç»“æœç»™ Client å±‚ã€‚å¹¶ä¸”å› ä¸º Raft å±‚ä¸åº”è¯¥å­˜å‚¨è¿‡å¤šçš„ logï¼Œæ‰€ä»¥ Service å±‚è¿˜ä¼šå°† applied çš„ log å‹ç¼©æˆå¿«ç…§ï¼Œä»¥ä¾¿å¿«é€Ÿåº”ç”¨ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çš„ä»»åŠ¡å°±æ˜¯ç”¨ go å®ç°åŸºç¡€çš„ Raft å±‚æ¶æ„ã€‚&lt;/p>
&lt;ul>
&lt;li>é¢†å¯¼äººé€‰ä¸¾&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>æœ€åˆï¼Œæ‰€æœ‰ Raft èŠ‚ç‚¹éƒ½æ˜¯ Followerï¼Œå¦‚æœåœ¨&lt;code>election timeout&lt;/code>å†…æœªæ”¶åˆ°å½“å‰&lt;code>term&lt;/code>çš„&lt;code>heartbeat&lt;/code>ï¼Œå°±ä¼šè½¬ä¸º Candidateã€‚
&lt;ul>
&lt;li>&lt;code>election timeout&lt;/code>: é€‰ä¸¾è¶…æ—¶æ—¶é—´ã€‚å¤§æ¦‚æ˜¯&lt;code>heartbeat timeout&lt;/code>çš„ 3 å€ã€‚&lt;/li>
&lt;li>&lt;code>term&lt;/code>ï¼šä»»æœŸã€‚æ¯ä¸ªç”¨äºå®ç°ä¸€è‡´æ€§å…±è¯†ã€‚&lt;/li>
&lt;li>&lt;code>heartbeat&lt;/code>ï¼šå¿ƒè·³ã€‚Raft èŠ‚ç‚¹æœ‰ä¸‰ç§çŠ¶æ€ï¼šFollowerï¼ŒCandidateï¼ŒLeaderã€‚Leader ä¸ºäº†ç»´æŒè‡ªå·±çš„é¢†å¯¼ï¼Œéœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´å‘é€ä¸€æ¬¡å¿ƒè·³ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>è½¬ä¸º Candidate ä¹‹åï¼Œ&lt;code>term++&lt;/code>ï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼Œå¹¶å‘é€è¯·æ±‚æŠ•ç¥¨çš„ RPC ç»™ peer èŠ‚ç‚¹ã€‚&lt;/li>
&lt;li>æ”¶åˆ°è¯·æ±‚ RPC çš„ peer æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ‰å¯ä»¥æŠ•ç¥¨ï¼š
&lt;ul>
&lt;li>peer ä»»æœŸå°äº Candidate çš„ä»»æœŸæˆ–è€… peer ä»»æœŸç­‰äº Candidate å¹¶ä¸”å½“å‰ä»»æœŸæ²¡æŠ•è¿‡ã€‚&lt;/li>
&lt;li>peer çš„ log æ²¡æœ‰ Candidate æ–°ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Candidate å¾—åˆ°çš„ç¥¨æ•°è¶…è¿‡åŠæ•°çš„ peer å°±å¯ä»¥æˆä¸º Leaderï¼Œå› ä¸ºä¸Šè¿°é™åˆ¶ï¼Œä¸€ä¸ªé›†ç¾¤åŒä¸€ä¸ª&lt;code>term&lt;/code>åªä¼šé€‰å‡ºä¸€ä¸ª Leaderã€‚&lt;/li>
&lt;li>Leader æ¯éš”ä¸€æ¬¡&lt;code>heartbeat timeout&lt;/code>å°±å‘é€ä¸€æ¬¡åŒ…å« snapshot æˆ– log çš„ heartbeatï¼Œå‘é€å¿«ç…§è¿˜æ˜¯æ—¥å¿—æ ¹æ® peer çš„ &lt;code>nextIndex&lt;/code> è€Œå®šã€‚
&lt;ul>
&lt;li>&lt;code>nextIndex&lt;/code> æ˜¯ Leader å¯¹ peer æ—¥å¿—é•¿åº¦çš„ä¹è§‚æ¨æµ‹ï¼Œæˆä¸º Leader åä¼šå¯¹æ‰€æœ‰ peer çš„ &lt;code>nextIndex&lt;/code> èµ‹å€¼ä¸ºè‡ªå·±çš„ &lt;code>lastLogIndex+1&lt;/code>ï¼Œè€Œåä¼šæ ¹æ® heartbeat ç»“æœæ›´æ”¹ &lt;code>nextIndex&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>lastIncludeIndex&lt;/code> æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ï¼Œè¡¨ç¤º snapshot åŒ…å«çš„æœ€åä¸€ä¸ªæ—¥å¿—çš„ä¸‹æ ‡ï¼Œåˆå§‹ä¸º 0ã€‚&lt;/li>
&lt;li>å¦‚æœ $nextIndex \leq lastIncludedIndex$ ï¼Œå‘é€ InstallSnapshot RPCï¼Œå¦åˆ™å‘é€ AppendEntries RPCã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Follower éœ€è¦å¯¹ Leader å‘é€çš„å¿ƒè·³è¿›è¡Œå¤„ç†ã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>æ—¥å¿—å¤åˆ¶&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>
&lt;p>Service å±‚ä¼šé€šè¿‡ Start(cmd) å‘é€ command ç»™ Leaderã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Leader éœ€è¦ä¿å­˜ command è‡³ logï¼Œå¹¶åœ¨å¿ƒè·³çš„æ—¶å€™å‘ Follower å‘é€ä»–æ²¡æœ‰çš„ logã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Leader ç­‰å¾…ä¸€åŠä»¥ä¸Šçš„ Follower å†™å…¥è‡ªå·±çš„æ—¥å¿—ï¼Œå†è¿›è¡Œ commitã€‚&lt;/p>
&lt;ul>
&lt;li>åˆ¤æ–­ Follower å†™å…¥æ—¥å¿—çš„æ ‡å‡†æ˜¯ &lt;code>matchIndex&lt;/code>ï¼Œä¸Šé¢æœ‰æåˆ° &lt;code>nextIndex&lt;/code> æ˜¯ Leader å¯¹ peer æ—¥å¿—é•¿åº¦çš„ä¹è§‚æ¨æµ‹ï¼Œ&lt;code>matchIndex&lt;/code> åˆ™æ˜¯ç›¸å¯¹æ‚²è§‚çš„æ¨æµ‹ï¼Œåªæœ‰åœ¨ AppendEntries RPC è¿”å›æˆåŠŸå Leader æ‰ä¼šæ›´æ–°ç›¸åº” Follower çš„ &lt;code>matchIndex&lt;/code>ã€‚&lt;/li>
&lt;li>å¹¶ä¸”è€ƒè™‘ RPC è°ƒç”¨çš„éçº¿æ€§è¿”å›ï¼Œéœ€è¦åœ¨ä¿®æ”¹ &lt;code>matchIndex&lt;/code> çš„æ—¶å€™åˆ¤æ–­éœ€è¦ä¿®æ”¹çš„å€¼æ˜¯å¦çœŸçš„å¤§äºå½“å‰çš„ &lt;code>matchIndex&lt;/code> çš„å€¼ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Leader commit åä¿®æ”¹ &lt;code>commitIndex&lt;/code> çš„å€¼ï¼Œå¹¶å¦å¼€ä¸€ä¸ª go routine å°†ä»&lt;code>lastApplied+1&lt;/code> åˆ° &lt;code>commitIndex&lt;/code> çš„å€¼æ¨åˆ° &lt;code>applyCh&lt;/code>ï¼Œå†ä¿®æ”¹&lt;code>lastApplied = commitIndex&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Follower åœ¨ Leader commit åä¹Ÿä¼šä»¥ Leader çš„ commitIndex ä½œä¸ºé™åˆ¶ commit è‡ªå·±çš„ logï¼Œå¹¶å’Œ Leader ä¸€æ ·ï¼Œå°†æ—¥å¿—äº¤ç»™ service applyã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>æ—¥å¿—å‹ç¼©&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>Service å±‚åœ¨è‹¥å¹² commit åï¼Œä¼šå‹ç¼©å·²æäº¤çš„æ—¥å¿—ï¼Œå¹¶é€šè¿‡ Snapshot(index,snapshot) æé†’ raft å±‚ã€‚&lt;/li>
&lt;li>raft å±‚åˆ™éœ€è¦è¿›è¡Œä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚åˆ æ‰è¢«å‹ç¼©çš„æ—¥å¿—ï¼Œæ”¹å˜æ—¥å¿—çš„ç´¢å¼•æ–¹å¼ï¼ŒæŒä¹…åŒ– snapshot çš„ä¿¡æ¯ï¼ˆä½†ä¸éœ€è¦ä¿å­˜ snapshotï¼Œsnapshot ä»…å­˜åœ¨ Service å±‚ï¼‰ã€‚&lt;/li>
&lt;li>å¯¹äº Leaderï¼Œåœ¨ heartbeat æ—¶ï¼Œè‹¥æ»¡è¶³ $nextIndex \leq lastIncludedIndex$ ï¼Œåˆ™é€šè¿‡ &lt;code>persister.ReadSnapshot()&lt;/code> è¯»å– snapshot ç»™ Followerã€‚&lt;/li>
&lt;li>å¦‚æœ Follower term &amp;lt;= Leader termï¼Œåªèƒ½æ¥å— snapshotï¼Œå¹¶åˆ æ‰è¢«å‹ç¼©çš„æ—¥å¿—ï¼Œæ”¹å˜æ—¥å¿—çš„ç´¢å¼•æ–¹å¼ï¼ŒæŒä¹…åŒ– snapshot çš„ä¿¡æ¯ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="tips">Tips&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>æ³¨æ„ data raceï¼Œå¯¹å¤§éƒ¨åˆ† rf ç»“æ„çš„ä¿®æ”¹å’Œè¯»å–éƒ½è¦ä¸Šé”ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ‰€æœ‰ RPC éƒ½è¦æ£€æµ‹ä»»æœŸï¼Œå¹¶å¯¹è¿‡æœŸçŠ¶æ€è¿›è¡Œå¤„ç†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ lab2D ä¸­ï¼Œéœ€è¦æ”¹å˜ä¸‹æ ‡çš„ç´¢å¼•æ–¹å¼ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>Each log entry also has an integer index iden-tifying its position in the log.&lt;/p>
&lt;/blockquote>
&lt;p>ä½†è¿™ä¸ªå…¶å®å¾ˆå®¹æ˜“æ”¹ï¼Œæ‰€ä»¥æ¨èåœ¨ 2D ä¹‹å‰ä¸è¦å»ç®¡ä¸‹æ ‡çš„é—®é¢˜ï¼Œç›´æ¥ç”¨ log æ•°ç»„è‡ªå·±çš„ä¸‹æ ‡å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;h3 id="struct">struct&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">const&lt;/span> &lt;span class="nx">NULL&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;span class="kd">const&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="nx">_&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">iota&lt;/span>
&lt;span class="nx">Follower&lt;/span>
&lt;span class="nx">Candidate&lt;/span>
&lt;span class="nx">Leader&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="kd">type&lt;/span> &lt;span class="nx">ApplyMsg&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">CommandValid&lt;/span> &lt;span class="kt">bool&lt;/span>
&lt;span class="nx">Command&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;span class="nx">CommandIndex&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="nx">SnapshotValid&lt;/span> &lt;span class="kt">bool&lt;/span>
&lt;span class="nx">Snapshot&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>
&lt;span class="nx">SnapshotTerm&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="nx">SnapshotIndex&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">type&lt;/span> &lt;span class="nx">Entry&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Command&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{}&lt;/span> &lt;span class="c1">// Command for state machine
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Term&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// Command received Term
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Index&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// A Go object implementing a single Raft peer.
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">type&lt;/span> &lt;span class="nx">Raft&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">mu&lt;/span> &lt;span class="nx">sync&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Mutex&lt;/span> &lt;span class="c1">// Lock to protect shared access to this peer&amp;#39;s state
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">peers&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">labrpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ClientEnd&lt;/span> &lt;span class="c1">// RPC end points of all peers
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">persister&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Persister&lt;/span> &lt;span class="c1">// Object to hold this peer&amp;#39;s persisted state
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">me&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// this peer&amp;#39;s index into peers[]
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">dead&lt;/span> &lt;span class="kt">int32&lt;/span> &lt;span class="c1">// set by Kill()
&lt;/span>&lt;span class="c1">&lt;/span>
&lt;span class="c1">// Persistent state
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">currentTerm&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// 0...
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">votedFor&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// null if none
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">log&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nx">Entry&lt;/span> &lt;span class="c1">// index 1...
&lt;/span>&lt;span class="c1">&lt;/span>
&lt;span class="c1">// Volatile state
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">commitIndex&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// most of the server has been replicated and durable, 0...
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">lastApplied&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// highest entry applied to state machine, 0...
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">state&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="nx">heartbeatTimer&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Timer&lt;/span>
&lt;span class="nx">electionTimer&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Timer&lt;/span>
&lt;span class="nx">applyCh&lt;/span> &lt;span class="kd">chan&lt;/span> &lt;span class="nx">ApplyMsg&lt;/span>
&lt;span class="nx">applyWaker&lt;/span> &lt;span class="kd">chan&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="c1">// for leader (reinitialized after election)
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">nextIndex&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="c1">// last log index+1...
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">matchIndex&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="c1">// highest log entry be replicated on server, 0..., update: PrevLogIndex+len(Entries)
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Raft&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">lastIncludedTerm&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">Term&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Raft&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">lastIncludedIndex&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">Index&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Raft&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">setLastIncludedTerm&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">term&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">Term&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">term&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">rf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Raft&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">setLastIncludedIndex&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">index&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">rf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="nx">Index&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">index&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="nf">getHeartbeatDuration&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Duration&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Millisecond&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">60&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="nf">getElectionDuration&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Duration&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Millisecond&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Duration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rand&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Int31n&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">180&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">180&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="res">res&lt;/h3>
&lt;p>&lt;img src="https://loomt.top/img/824lab2.png" alt="res">&lt;/p>
&lt;p>&lt;em>&lt;strong>reference&lt;/strong>&lt;/em>&lt;/p>
&lt;p>&lt;a href="https://thesquareplanet.com/blog/students-guide-to-raft/">https://thesquareplanet.com/blog/students-guide-to-raft/&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://pdos.csail.mit.edu/6.824/papers/raft-extended.pdf">https://pdos.csail.mit.edu/6.824/papers/raft-extended.pdf&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://pdos.csail.mit.edu/6.824/notes/raft_diagram.pdf">https://pdos.csail.mit.edu/6.824/notes/raft_diagram.pdf&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://thesecretlivesofdata.com/raft/">http://thesecretlivesofdata.com/raft/&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://pdos.csail.mit.edu/6.824/labs/raft-structure.txt">https://pdos.csail.mit.edu/6.824/labs/raft-structure.txt&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://pdos.csail.mit.edu/6.824/labs/raft-locking.txt">https://pdos.csail.mit.edu/6.824/labs/raft-locking.txt&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://blog.josejg.com/debugging-pretty/">https://blog.josejg.com/debugging-pretty/&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://flaneur2020.github.io/2020/11/07/mit6-824-raft/">https://flaneur2020.github.io/2020/11/07/mit6-824-raft/&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/OneSizeFitsQuorum/MIT6.824-2021/blob/master/docs/lab2.md">https://github.com/OneSizeFitsQuorum/MIT6.824-2021/blob/master/docs/lab2.md&lt;/a>&lt;/p></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/raft/" term="Raft" label="Raft"/><category scheme="https://loomt.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" term="åˆ†å¸ƒå¼" label="åˆ†å¸ƒå¼"/><category scheme="https://loomt.top/tags/6.824/" term="6.824" label="6.824"/></entry><entry><title type="text">6.824 Lab1</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/6.824-lab1/"/><id>https://loomt.top/posts/6.824-lab1/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2023-02-03T23:25:54+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">Lab1 MapReduce Paper MapReduce: Simplified Data Processing on Large Clusters MapReduce å°†åˆ†å¸ƒå¼ç³»ç»Ÿå¤„ç†æ•°æ®çš„ç»†èŠ‚ï¼ˆå¹¶è¡Œã€å®¹é”™ã€å±€éƒ¨æ€§ä¼˜åŒ–ã€è´Ÿè½½å‡è¡¡ç­‰ï¼‰éšè—èµ·æ¥ï¼Œæä¾›ä¸€å¥—ç®€åŒ–æ–¹æ¡ˆï¼Œè§£å†³äº†åœ¨å¤šå°æœºå™¨å¤„ç†å¤§é‡é€»è¾‘ç®€å•çš„è®¡ç®—ï¼ˆåˆ†å¸ƒå¼â€¦</summary><content type="html">&lt;h2 id="lab1-mapreduce">Lab1 MapReduce&lt;/h2>
&lt;h3 id="paper">Paper&lt;/h3>
&lt;p>&lt;a href="https://pdos.csail.mit.edu/6.824/papers/mapreduce.pdf">MapReduce: Simplified Data Processing on Large Clusters&lt;/a>&lt;/p>
&lt;p>MapReduce å°†åˆ†å¸ƒå¼ç³»ç»Ÿå¤„ç†æ•°æ®çš„ç»†èŠ‚ï¼ˆå¹¶è¡Œã€å®¹é”™ã€å±€éƒ¨æ€§ä¼˜åŒ–ã€è´Ÿè½½å‡è¡¡ç­‰ï¼‰éšè—èµ·æ¥ï¼Œæä¾›ä¸€å¥—ç®€åŒ–æ–¹æ¡ˆï¼Œè§£å†³äº†åœ¨å¤šå°æœºå™¨å¤„ç†å¤§é‡é€»è¾‘ç®€å•çš„è®¡ç®—ï¼ˆåˆ†å¸ƒå¼è®¡ç®—ï¼‰å®ç°å¤æ‚çš„é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="å®ç°">å®ç°&lt;/h3>
&lt;p>æœ¬å®éªŒå¯ä»¥ç”± 1 ä¸ª coordinator/master è°ƒåº¦è‹¥å¹²ä¸ª workerã€‚å…ˆå®Œæˆæ‰€æœ‰ map ä»»åŠ¡ï¼Œç”Ÿæˆä¸­é—´é”®å€¼å¯¹å¹¶å°†å…¶å­˜åœ¨ä¸­é—´æ–‡ä»¶åå†è¿›è¡Œ reduce ä»»åŠ¡ï¼Œæœ€åå°† reduce ä»»åŠ¡çš„ç»“æœè¾“å‡ºåˆ°æ–‡æœ¬ã€‚&lt;/p>
&lt;p>éœ€è¦æˆ‘ä»¬ä¿®æ”¹çš„æ–‡ä»¶ä¸º &lt;code>mr/*&lt;/code>&lt;/p>
&lt;ol>
&lt;li>worker é€šè¿‡ RPC å¾ªç¯è¯·æ±‚ä»»åŠ¡ã€‚&lt;/li>
&lt;li>coordinator è¯»å– 8 ä¸ªç»™å®šçš„æ–‡ä»¶åˆ†ç»™ä¸åŒçš„ worker è¿›è¡Œ map ä»»åŠ¡ï¼Œè¿™éƒ¨åˆ†å¦‚æœå–œæ¬¢ä¹Ÿå¯ä»¥æŒ‰å›ºå®š bytes è¿›è¡Œåˆ‡å‰²&lt;del>ä½†æˆ‘æ‡’å¾—å¤„ç†äº†&lt;/del>ã€‚&lt;/li>
&lt;li>worker è¯»å–æ–‡ä»¶å¹¶æ‰”ç»™&lt;code>fmap&lt;/code>è¿›è¡Œå¤„ç†ï¼Œç”Ÿæˆä¸­é—´é”®å€¼å¯¹ï¼Œè®¡ç®—å­—ç¬¦ä¸²çš„ hash åå°†&lt;code>key-intermediate_value&lt;/code>å­˜åœ¨ &lt;code>mr-taskid-ihash(str)&lt;/code> é‡Œé¢ã€‚&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>fmap å‡½æ•°é€šè¿‡ç¼–è¯‘ç”Ÿæˆçš„ *.so è°ƒç”¨&lt;/p>
&lt;/blockquote>
&lt;style type="text/css">.notice{--root-color:#444;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#c33;--warning-content:#fee;--info-title:#fb7;--info-content:#fec;--note-title:#6be;--note-content:#e7f2fa;--tip-title:#5a5;--tip-content:#efe}@media (prefers-color-scheme:dark){.notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}}body.dark .notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}&lt;/style>
&lt;div>&lt;svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg">&lt;symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/>&lt;/symbol>&lt;symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/>&lt;/symbol>&lt;symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/>&lt;/symbol>&lt;symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/>&lt;/symbol>&lt;/svg>&lt;/div>&lt;div class="notice tip" >
&lt;p class="first notice-title">&lt;span class="icon-notice baseline">&lt;svg>&lt;use href="https://loomt.top/posts/6.824-lab1/#tip-notice">&lt;/use>&lt;/svg>&lt;/span>æç¤º&lt;/p>&lt;p>çœ‹åˆ°ä¸€äº›åŒå­¦æ˜¯å…ˆ os.CreateTemp(&amp;quot;&amp;quot;, tmpFileName) å­˜åœ¨ä¸´æ—¶æ–‡ä»¶é‡Œé¢ï¼Œç­‰å¤„ç†å®Œäº†å† rename æˆ&lt;code>mr-taskid-ihash(str)&lt;/code>ã€‚è¿™æ ·åº”è¯¥ä¼šæ›´åŠ è§„èŒƒä¸€äº›ï¼Œä½†ä¸åˆ›å»º tempfile åœ¨ lab1 ç†è®ºä¸Šåº”è¯¥ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚&lt;/p>
&lt;p>å½“æ–‡ä»¶æ²¡å®Œå…¨å†™å®Œ worker å°± crash æ—¶ï¼Œè¿™ä¸ªä»»åŠ¡ä¼šè¢« coordinator å‘ç°å¹¶äº¤ç»™åˆ«çš„ worker é‡åšã€‚å› ä¸ºç”¨çš„æ˜¯&lt;code>os.Create()&lt;/code>ï¼Œæ–‡ä»¶ä¼šè¢«æ–°çš„è¦†ç›–ï¼Œç›´åˆ° worker æˆåŠŸå®Œæˆä»»åŠ¡ä¸ºæ­¢ã€‚&lt;/p>
&lt;p>å¦‚æœé€»è¾‘å…è®¸ä¸¤ä¸ª worker åŒæ—¶å¤„ç†ä¸€ä¸ªä»»åŠ¡çš„è¯ï¼Œå°±éœ€è¦åˆ›å»º tempFile å† rename çš„æ–¹å¼ï¼Œå› ä¸ºéœ€è¦ä¿è¯åˆ›å»ºçš„ï¼ˆä¸´æ—¶ï¼‰æ–‡ä»¶å†…å®¹ä¸é‡å¤ã€‚&lt;/p>&lt;/div>
&lt;ol start="4">
&lt;li>map ä»»åŠ¡å…¨éƒ¨å®Œæˆå coordinator åˆ†é… NReduce ä¸ª reduce ä»»åŠ¡ç»™ä¸åŒçš„ worker å¤„ç†ã€‚&lt;/li>
&lt;li>worker è¯»å–ä¸­é—´æ–‡ä»¶ï¼Œå¹¶å°†&lt;code>key-list(intermediate_value)&lt;/code>æ‰”ç»™&lt;code>freduce&lt;/code>å¤„ç†æˆ&lt;code>key-value&lt;/code> å†™å…¥&lt;code>mr-out-ihash(str)&lt;/code>ã€‚&lt;/li>
&lt;li>coordinator å‘ç°ä»»åŠ¡å…¨éƒ½å¤„ç†å®Œåè¸¢èµ° workerï¼Œå¹¶åœ¨è‹¥å¹²ç§’åé€€å‡ºã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="tips">Tips&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>ç»“æ„&lt;/p>
&lt;ul>
&lt;li>
&lt;p>go å¯ä»¥ç”¨ const å’Œ iota ä»£æ›¿ enumã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>WorkerInfo åœ¨è¿™ä¸ªå®éªŒå¯ä»¥çœç•¥ï¼Œä¸éœ€è¦ä¿ç•™ worker çš„çŠ¶æ€ï¼Œä½†æˆ‘å†™äº†å°±ä¸æƒ³åˆ äº†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœ¬æ¥è¿˜æƒ³å¾€ç»“æ„ä½“å†…ç½®ä¸€ä¸ª logger çš„ï¼Œä½† RPC è°ƒç”¨éœ€è¦ gob åºåˆ—åŒ–ï¼Œè€Œ logger ä¸çŸ¥é“ä¸ºå•¥ä¼šåºåˆ—åŒ–å¤±è´¥ï¼Œä¸çŸ¥é“æ˜¯å•¥ bugï¼Œä»¥åå†ç…ç…ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">const&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="nx">_&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">iota&lt;/span>
&lt;span class="c1">// MAP REDUCE WAIT: Task type
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">MAP&lt;/span>
&lt;span class="nx">REDUCE&lt;/span>
&lt;span class="nx">WAIT&lt;/span>
&lt;span class="c1">// IDLE BUSY DONE: Task status || WorkerInfo status
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">IDLE&lt;/span>
&lt;span class="nx">BUSY&lt;/span>
&lt;span class="nx">DONE&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="kd">type&lt;/span> &lt;span class="nx">Coordinator&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">NMap&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// map ä»»åŠ¡çš„ä¸ªæ•°
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">NReduce&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// reduce ä»»åŠ¡çš„ä¸ªæ•°
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">DMap&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// è®°å½• map task å®Œæˆçš„ä¸ªæ•°
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">DReduce&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// è®°å½• reduce task å®Œæˆçš„ä¸ªæ•°
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">WorkerId&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// ä¸ºæ–°çš„ worker åˆ†é… workerIds
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">TaskDone&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">bool&lt;/span> &lt;span class="c1">// è®°å½• task æ˜¯å¦è¢«å®Œæˆ
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Map&lt;/span> &lt;span class="kd">chan&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Task&lt;/span> &lt;span class="c1">// å¾…å–å‡ºçš„ map task
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Reduce&lt;/span> &lt;span class="kd">chan&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Task&lt;/span> &lt;span class="c1">// å¾…å–å‡ºçš„ reduce task
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">TaskMutex&lt;/span> &lt;span class="nx">sync&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Mutex&lt;/span> &lt;span class="c1">// ç”¨äºä»»åŠ¡åˆ†å‘ç›¸å…³æ•°æ®çš„ mutex
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">DoneMutex&lt;/span> &lt;span class="nx">sync&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Mutex&lt;/span> &lt;span class="c1">// ç”¨äºå®Œæˆä»»åŠ¡ç›¸å…³æ•°æ®çš„ mutex
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Mutex&lt;/span> &lt;span class="nx">sync&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Mutex&lt;/span> &lt;span class="c1">// ç”¨äºå…¶ä»–ç»†èŠ‚çš„ mutex
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;span class="kd">type&lt;/span> &lt;span class="nx">Task&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">StartTime&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Time&lt;/span>
&lt;span class="nx">NReduce&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// ä¼ ç»™ workerï¼Œç”¨äº ihash çš„ mod
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Type&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// MAP REDUCE WAIT
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Status&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// IDLE BUSY DONE
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">FileName&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="nx">TaskId&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="nx">WorkerId&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">type&lt;/span> &lt;span class="nx">WorkerInfo&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">WorkerId&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="nx">TaskId&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="nx">Type&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="nx">Status&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="c1">//Lg *log.Logger
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">//Why this error?
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">//gob: type log.Logger has no exported fields
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">//2023/01/31 14:34:13 RPC getWork failed
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">//exit status 1
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;span class="c1">// Map functions return a slice of KeyValue.
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">type&lt;/span> &lt;span class="nx">KeyValue&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Key&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="nx">Value&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>RPC å†™å…¥ reply çš„æ—¶å€™ä¸èƒ½ç›´æ¥å°† reply æŒ‡å‘ä¸€ä¸ªæ–°çš„åœ°å€ï¼Œè€Œæ˜¯è¦ä¿®æ”¹ reply åœ°å€çš„å€¼ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go"> &lt;span class="c1">//reply = &amp;amp;GetWorkReply{&amp;amp;Task{...}}
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">//ä¸Šé¢çš„æ–¹æ³•ä¸ä¼šè¿”å›æƒ³è¦çš„ replyï¼Œå› ä¸º reply æŒ‡å‘çš„æ˜¯æ–°çš„ GetWorkReply å€¼åœ¨ rpc æœåŠ¡å™¨çš„æŒ‡é’ˆã€‚è¿™éƒ¨åˆ†å®¢æˆ·ç«¯çš„å†…å­˜å’ŒæœåŠ¡å™¨çš„ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¾—åˆ°çš„æ˜¯ç©ºå€¼ï¼›ä¸‹é¢çš„æ–¹æ³•å› ä¸º reply æ˜¯å…±äº«å†…å­˜çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½å¯ä»¥è®¿é—® &amp;amp;replyã€‚
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">//åœ¨ RPC è°ƒç”¨æ—¶ï¼Œè¦é¿å…ä¼ é€’æŒ‡é’ˆå‚æ•°ï¼Œå¦‚æœä¼ é€’çš„å‚æ•°æ˜¯å€¼ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°†ä¼šè¢«å¤åˆ¶åˆ°å¦ä¸€ä¸ªåœ°å€
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">reply&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">GetWorkReply&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">Task&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">StartTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Now&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;span class="nx">Type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">MAP&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">BUSY&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">FileName&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">mapTask&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileName&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">NReduce&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">NReduce&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">WorkerId&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">args&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">WorkerId&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">TaskId&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">mapTask&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">TaskId&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">}}&lt;/span> &lt;span class="c1">// equal to reply.Task = &amp;amp;Task{...}
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>clash testï¼Œéœ€è¦ coordinator åœ¨ worker å®•æœº 10s åä¸ºåŒä¸€ä¸ªä»»åŠ¡é‡æ–°åˆ†é… workerï¼Œè¿™éƒ¨åˆ†éœ€è¦è€ƒè™‘ä¸€ä¸‹æ³¨æ„ä¸€ä¸‹ data race&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="k">go&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taskId&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">filename&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">select&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">case&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">After&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">12&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Second&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Mutex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Lock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">TaskDone&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">taskId&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Mutex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">dosomething&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Mutex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Unlock&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">dootherthing&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// default:{
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">// }
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="c1">// default ä¸èƒ½å†™ï¼Œå¦‚æœå†™äº†å°±ä¼šç›´æ¥è·³åˆ° defaultï¼Œä¸ä¼šè¿›å…¥ 12s çš„ case
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span>
&lt;span class="p">}(&lt;/span>&lt;span class="nx">maptask&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">TaskId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">mapTask&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>å¹¶å‘ç¼–ç¨‹ç»†èŠ‚&lt;/li>
&lt;/ol>
&lt;p>å› ä¸º MapReduce çš„ç‰¹æ€§ï¼Œmap task å¯ä»¥å¹¶å‘ï¼Œreduce task å¯ä»¥å¹¶å‘ï¼Œä½†ä¸¤ç§ä»»åŠ¡ä¸èƒ½åŒæ—¶å¹¶å‘ï¼Œæ‰€ä»¥éœ€è¦ç­‰åˆ° map task è·‘å®Œæ‰å¯ä»¥è¿›è¡Œ reduce taskã€‚å¦‚æœåŒæ—¶è¯»å†™åŒä¸€ä¸ªå˜é‡ï¼Œéœ€è¦åŠ é”ã€‚å…¶å®è¿˜å¯ä»¥ç”¨ chan å®ç° lock-freeï¼Œä»¥åè¯•è¯•ï¼Œå¦‚æœæœ‰æ—¶é—´çš„è¯ã€‚&lt;/p>
&lt;ol start="5">
&lt;li>éšæ‰‹å†™çš„ makefile&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-makefile" data-lang="makefile">&lt;span class="c"># location: src/Makefile
&lt;/span>&lt;span class="c">&lt;/span>&lt;span class="nv">ntest&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="m">50&lt;/span>
&lt;span class="nf">lab1&lt;/span>&lt;span class="o">:&lt;/span>
@cd main&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="k">for&lt;/span> i in &lt;span class="nv">$$&lt;/span>&lt;span class="o">(&lt;/span>seq &lt;span class="m">1&lt;/span> &lt;span class="k">$(&lt;/span>ntest&lt;span class="k">)&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> bash test-mr.sh &amp;gt; res&lt;span class="nv">$$&lt;/span>i&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="k">done&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="nv">cnt&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="k">for&lt;/span> i in &lt;span class="nv">$$&lt;/span>&lt;span class="o">(&lt;/span>seq &lt;span class="m">1&lt;/span> &lt;span class="nv">$$&lt;/span>&lt;span class="o">(&lt;/span>expr &lt;span class="k">$(&lt;/span>ntest&lt;span class="k">)&lt;/span> - 1&lt;span class="o">))&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="k">if&lt;/span> cmp res&lt;span class="nv">$$&lt;/span>i res&lt;span class="nv">$$&lt;/span>&lt;span class="o">(&lt;/span>expr &lt;span class="nv">$$&lt;/span>i + 1&lt;span class="o">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="nv">cnt&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$$&lt;/span>&lt;span class="o">(&lt;/span>expr &lt;span class="nv">$$&lt;/span>cnt + 1&lt;span class="o">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="k">fi&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="k">done&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;same file num:&amp;#34;&lt;/span>&lt;span class="nv">$$&lt;/span>&lt;span class="o">(&lt;/span>expr &lt;span class="nv">$$&lt;/span>cnt + 1&lt;span class="o">)&lt;/span> &lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$$&lt;/span>cnt -eq &lt;span class="nv">$$&lt;/span>&lt;span class="o">(&lt;/span>expr &lt;span class="k">$(&lt;/span>ntest&lt;span class="k">)&lt;/span> - 1&lt;span class="o">)&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span> &lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;****************************************************************&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;all res is the same!&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;result content as follow.&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;****************************************************************&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> cat main/res1&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;****************************************************************&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;span class="se">&lt;/span> &lt;span class="k">fi&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="6">
&lt;li>result&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">same file num:50
****************************************************************
all res is the same!
result content as follow.
****************************************************************
*** Starting wc test.
--- wc test: PASS
*** Starting indexer test.
--- indexer test: PASS
*** Starting map parallelism test.
--- map parallelism test: PASS
*** Starting reduce parallelism test.
--- reduce parallelism test: PASS
*** Starting job count test.
--- job count test: PASS
*** Starting early &lt;span class="nb">exit&lt;/span> test.
--- early &lt;span class="nb">exit&lt;/span> test: PASS
*** Starting crash test.
--- crash test: PASS
*** PASSED ALL TESTS
****************************************************************
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/raft/" term="Raft" label="Raft"/><category scheme="https://loomt.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" term="åˆ†å¸ƒå¼" label="åˆ†å¸ƒå¼"/><category scheme="https://loomt.top/tags/6.824/" term="6.824" label="6.824"/></entry><entry><title type="text">6.824</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/6.824/"/><id>https://loomt.top/posts/6.824/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2023-01-17T23:11:57+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">MIT 6.824ï¼ˆç°åœ¨å¥½åƒå˜æˆäº† 6.5840 schedule go å¹¶å‘ç¼–ç¨‹ lab1 solution Efficient debug and test Debugging by Pretty Printing Humans are visual creatures so itâ€™s a good idea to make use of visual tools like colors or columns to encode different types of information. dslogs.py -&amp;gt; build pretty printer for logs 1 2 3 4 5 6 7 8 9 10 11 12 13 14â€¦</summary><content type="html">&lt;h1 id="mit-6824ç°åœ¨å¥½åƒå˜æˆäº†-65840">MIT 6.824ï¼ˆç°åœ¨å¥½åƒå˜æˆäº† 6.5840&lt;/h1>
&lt;p>&lt;a href="https://pdos.csail.mit.edu/6.824/schedule.html">schedule&lt;/a>
&lt;a href="https://www.youtube.com/watch?v=IdCbMO0Ey9I">go å¹¶å‘ç¼–ç¨‹&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.loomt.top/posts/6.824-lab1">lab1 solution&lt;/a>&lt;/p>
&lt;h2 id="efficient-debug-and-test">Efficient debug and test&lt;/h2>
&lt;p>&lt;a href="https://blog.josejg.com/debugging-pretty/">Debugging by Pretty Printing&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>Humans are visual creatures so itâ€™s a good idea to make use of visual tools like colors or columns to encode different types of information.&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>dslogs.py -&amp;gt; build pretty printer for logs&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="ch">#!/usr/bin/env python&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">sys&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">shutil&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">typing&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Optional&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Tuple&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Dict&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">typer&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">rich&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="nb">print&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">rich.columns&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Columns&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">rich.console&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Console&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">rich.traceback&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">install&lt;/span>
&lt;span class="c1"># fmt: off&lt;/span>
&lt;span class="c1"># Mapping from topics to colors&lt;/span>
&lt;span class="n">TOPICS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="s2">&amp;#34;TIMR&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#9a9a99&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;VOTE&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#67a0b2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;LEAD&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#d0b343&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;TERM&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#70c43f&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;LOG1&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#4878bc&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;LOG2&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#398280&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;CMIT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#98719f&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;PERS&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#d08341&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;SNAP&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#FD971F&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;DROP&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#ff615c&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;CLNT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#00813c&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;TEST&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#fe2c79&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;INFO&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#ffffff&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;WARN&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#d08341&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;ERRO&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#fe2626&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;TRCE&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#fe2626&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;FORC&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#3571a4&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;HEAR&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#ffcf3e&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="s2">&amp;#34;STAT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#cf5fb4&amp;#34;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1"># fmt: on&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">list_topics&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Optional&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">]):&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">value&lt;/span>
&lt;span class="n">topics&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">topic&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">topics&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">topic&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">TOPICS&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">raise&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">BadParameter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;topic &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">topic&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> not recognized&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">topics&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">FileText&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Argument&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;File to read, stdin otherwise&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">colorize&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">bool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;--no-color&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">n_columns&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Optional&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;--columns&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-c&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">ignore&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Optional&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;--ignore&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-i&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">list_topics&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">just&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Optional&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;--just&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-j&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">list_topics&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="p">):&lt;/span>
&lt;span class="n">topics&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TOPICS&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1"># We can take input from a stdin (pipes) or from a file&lt;/span>
&lt;span class="n">input_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">stdin&lt;/span>
&lt;span class="c1"># Print just some topics or exclude some topics (good for avoiding verbose ones)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">just&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">topics&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">just&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">ignore&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">topics&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">lvl&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">lvl&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">topics&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">lvl&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ignore&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;span class="n">topics&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">topics&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">console&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Console&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span>
&lt;span class="n">panic&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">False&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">line&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">input_&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">time&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">topic&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">msg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34; &amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1"># To ignore some topics&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">topic&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">topics&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">continue&lt;/span>
&lt;span class="n">msg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34; &amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1"># Debug calls from the test suite aren&amp;#39;t associated with&lt;/span>
&lt;span class="c1"># any particular peer. Otherwise we can treat second column&lt;/span>
&lt;span class="c1"># as peer id&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">topic&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s2">&amp;#34;TEST&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;span class="c1"># Colorize output by using rich syntax when needed&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">colorize&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">topic&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">TOPICS&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TOPICS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">topic&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="n">msg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;[&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">color&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">]&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">[/&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">color&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">]&amp;#34;&lt;/span>
&lt;span class="c1"># Single column printing. Always the case for debug stmts in tests&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">n_columns&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="kc">None&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">topic&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;TEST&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">msg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="c1"># Multi column printing, timing is dropped to maximize horizontal&lt;/span>
&lt;span class="c1"># space. Heavylifting is done through rich.column.Columns object&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">cols&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n_columns&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;span class="n">msg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">msg&lt;/span>
&lt;span class="n">cols&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">msg&lt;/span>
&lt;span class="n">col_width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">n_columns&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">cols&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Columns&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cols&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col_width&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">equal&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">expand&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cols&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">except&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="c1"># Code from tests or panics does not follow format&lt;/span>
&lt;span class="c1"># so we print it as is&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">startswith&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;panic&amp;#34;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">panic&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;span class="c1"># Output from tests is usually important so add a&lt;/span>
&lt;span class="c1"># horizontal line with hashes to make it more obvious&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">panic&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;#&amp;#34;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">end&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>dstest.py -&amp;gt; concurrency test&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;span class="lnt">202
&lt;/span>&lt;span class="lnt">203
&lt;/span>&lt;span class="lnt">204
&lt;/span>&lt;span class="lnt">205
&lt;/span>&lt;span class="lnt">206
&lt;/span>&lt;span class="lnt">207
&lt;/span>&lt;span class="lnt">208
&lt;/span>&lt;span class="lnt">209
&lt;/span>&lt;span class="lnt">210
&lt;/span>&lt;span class="lnt">211
&lt;/span>&lt;span class="lnt">212
&lt;/span>&lt;span class="lnt">213
&lt;/span>&lt;span class="lnt">214
&lt;/span>&lt;span class="lnt">215
&lt;/span>&lt;span class="lnt">216
&lt;/span>&lt;span class="lnt">217
&lt;/span>&lt;span class="lnt">218
&lt;/span>&lt;span class="lnt">219
&lt;/span>&lt;span class="lnt">220
&lt;/span>&lt;span class="lnt">221
&lt;/span>&lt;span class="lnt">222
&lt;/span>&lt;span class="lnt">223
&lt;/span>&lt;span class="lnt">224
&lt;/span>&lt;span class="lnt">225
&lt;/span>&lt;span class="lnt">226
&lt;/span>&lt;span class="lnt">227
&lt;/span>&lt;span class="lnt">228
&lt;/span>&lt;span class="lnt">229
&lt;/span>&lt;span class="lnt">230
&lt;/span>&lt;span class="lnt">231
&lt;/span>&lt;span class="lnt">232
&lt;/span>&lt;span class="lnt">233
&lt;/span>&lt;span class="lnt">234
&lt;/span>&lt;span class="lnt">235
&lt;/span>&lt;span class="lnt">236
&lt;/span>&lt;span class="lnt">237
&lt;/span>&lt;span class="lnt">238
&lt;/span>&lt;span class="lnt">239
&lt;/span>&lt;span class="lnt">240
&lt;/span>&lt;span class="lnt">241
&lt;/span>&lt;span class="lnt">242
&lt;/span>&lt;span class="lnt">243
&lt;/span>&lt;span class="lnt">244
&lt;/span>&lt;span class="lnt">245
&lt;/span>&lt;span class="lnt">246
&lt;/span>&lt;span class="lnt">247
&lt;/span>&lt;span class="lnt">248
&lt;/span>&lt;span class="lnt">249
&lt;/span>&lt;span class="lnt">250
&lt;/span>&lt;span class="lnt">251
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="ch">#!/usr/bin/env python&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">itertools&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">math&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">signal&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">subprocess&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">tempfile&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">shutil&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">time&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">sys&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">datetime&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">collections&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">defaultdict&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">concurrent.futures&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">FIRST_COMPLETED&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">dataclasses&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">dataclass&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">pathlib&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Path&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">typing&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Optional&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Dict&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">DefaultDict&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Tuple&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">typer&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="nn">rich&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">rich&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="nb">print&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">rich.table&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Table&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">rich.progress&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="n">Progress&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">TimeElapsedColumn&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">TimeRemainingColumn&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">TextColumn&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">BarColumn&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">SpinnerColumn&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">rich.live&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Live&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">rich.panel&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Panel&lt;/span>
&lt;span class="kn">from&lt;/span> &lt;span class="nn">rich.traceback&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">install&lt;/span>
&lt;span class="n">install&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">show_locals&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nd">@dataclass&lt;/span>
&lt;span class="k">class&lt;/span> &lt;span class="nc">StatsMeter&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;span class="s2"> Auxiliary classs to keep track of online stats including: count, mean, variance
&lt;/span>&lt;span class="s2"> Uses Welford&amp;#39;s algorithm to compute sample mean and sample variance incrementally.
&lt;/span>&lt;span class="s2"> https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance#On-line_algorithm
&lt;/span>&lt;span class="s2"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;span class="n">n&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">int&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="n">mean&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">float&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>
&lt;span class="n">S&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">float&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mf">0.0&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">datum&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;span class="n">delta&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datum&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>
&lt;span class="c1"># Mk = Mk-1+ (xk â€“ Mk-1)/k&lt;/span>
&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">delta&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">n&lt;/span>
&lt;span class="c1"># Sk = Sk-1 + (xk â€“ Mk-1)*(xk â€“ Mk).&lt;/span>
&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">S&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">delta&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">datum&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nd">@property&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">variance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">S&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">n&lt;/span>
&lt;span class="nd">@property&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">std&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">math&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sqrt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">variance&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">print_results&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">results&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">StatsMeter&lt;/span>&lt;span class="p">]],&lt;/span> &lt;span class="n">timing&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Table&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">show_header&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">header_style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;bold&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Test&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Failed&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">justify&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;right&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Total&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">justify&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;right&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">timing&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Time&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">justify&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;right&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Real Time&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">justify&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;right&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;User Time&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">justify&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;right&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;System Time&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">justify&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;right&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stats&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">results&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">():&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;completed&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">continue&lt;/span>
&lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;green&amp;#34;&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;failed&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="s2">&amp;#34;red&amp;#34;&lt;/span>
&lt;span class="n">row&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;[&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">color&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">]&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">[/&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">color&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;failed&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;completed&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="p">]&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">timing&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">row&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.2f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> Â± &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.2f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">row&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">extend&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="p">[&lt;/span>
&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;real_time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.2f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> Â± &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;real_time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.2f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;user_time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.2f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> Â± &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;user_time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.2f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;system_time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.2f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> Â± &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;system_time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">.2f&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">]&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="n">table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_row&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">table&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">run_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">race&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">bool&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">timing&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">bool&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">test_cmd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;go&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;test&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;-run=&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">race&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">test_cmd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;-race&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">timing&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">test_cmd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">test_cmd&lt;/span>
&lt;span class="n">f&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tempfile&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mkstemp&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">start&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">proc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">subprocess&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test_cmd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stdout&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">stderr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">runtime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">start&lt;/span>
&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">proc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">returncode&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">runtime&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">last_line&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;rb&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SEEK_END&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">while&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="sa">b&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SEEK_CUR&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readline&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">decode&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="n">line&lt;/span>
&lt;span class="c1"># fmt: off&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">run_tests&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="n">tests&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">],&lt;/span>
&lt;span class="n">sequential&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">bool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;--sequential&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-s&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Run all test of each group in order&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">workers&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">int&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;--workers&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-p&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Number of parallel tasks&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">iterations&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">int&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;--iter&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-n&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Number of iterations to run&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">output&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Optional&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">Path&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;--output&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-o&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Output path to use&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">verbose&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">int&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;--verbose&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-v&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Verbosity level&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">archive&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">bool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;--archive&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Save all logs intead of only failed ones&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">race&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">bool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;--race/--no-race&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-r/-R&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Run with race checker&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">loop&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">bool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;--loop&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-l&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Run continuously&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">growth&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">int&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;--growth&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-g&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Growth ratio of iterations when using --loop&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="n">timing&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">bool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Option&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;--timing&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-t&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;Report timing, only works on macOS&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="c1"># fmt: on&lt;/span>
&lt;span class="p">):&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">timestamp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%Y%m&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s2">_%H%M%S&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Path&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">timestamp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">race&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[yellow]Running with the race detector&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">[/yellow]&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">verbose&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;[yellow] Verbosity level set to &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">verbose&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">[/yellow]&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">environ&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;VERBOSE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">verbose&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">total&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iterations&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tests&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">completed&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="n">results&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">defaultdict&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">StatsMeter&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">test&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">tests&lt;/span>&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">sequential&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">test_instances&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">itertools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">chain&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_iterable&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">itertools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">repeat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">iterations&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">test&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">tests&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">test_instances&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">itertools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">chain&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_iterable&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">itertools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">repeat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tests&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">iterations&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">test_instances&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test_instances&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">total_progress&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Progress&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="s2">&amp;#34;[progress.description]&lt;/span>&lt;span class="si">{task.description}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">BarColumn&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;span class="n">TimeRemainingColumn&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;span class="s2">&amp;#34;[progress.percentage]&lt;/span>&lt;span class="si">{task.percentage:&amp;gt;3.0f}&lt;/span>&lt;span class="s2">%&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">TimeElapsedColumn&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="n">total_task&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">total_progress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[yellow]Tests[/yellow]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">total&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">task_progress&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Progress&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="s2">&amp;#34;[progress.description]&lt;/span>&lt;span class="si">{task.description}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="n">SpinnerColumn&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;span class="n">BarColumn&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{task.completed}&lt;/span>&lt;span class="s2">/&lt;/span>&lt;span class="si">{task.total}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="n">tasks&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">task_progress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">iterations&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">test&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">tests&lt;/span>&lt;span class="p">}&lt;/span>
&lt;span class="n">progress_table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">grid&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">progress_table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_row&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">total_progress&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">progress_table&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_row&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Panel&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_progress&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="k">with&lt;/span> &lt;span class="n">Live&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">progress_table&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">transient&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">live&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">def&lt;/span> &lt;span class="nf">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">frame&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">live&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">stop&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">print_results&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">results&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">signal&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">signal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">signal&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SIGINT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">handler&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">with&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_workers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">workers&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">executor&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">futures&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;span class="k">while&lt;/span> &lt;span class="n">completed&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">futures&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">workers&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">test&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">itertools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">islice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test_instances&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">workers&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;span class="n">futures&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">submit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">run_test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">race&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">timing&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">done&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">not_done&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">futures&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">return_when&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">FIRST_COMPLETED&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="n">future&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">done&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">runtime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">future&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="n">results&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;completed&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">results&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">runtime&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">task_progress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tasks&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">advance&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">dest&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">_&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">completed&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">.log&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">as_posix&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">rc&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;Failed test &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> - &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">dest&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">task_progress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tasks&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">description&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;[red]&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">[/red]&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">results&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;failed&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">results&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;completed&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">iterations&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">results&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;failed&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">task_progress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tasks&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">description&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;[green]&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">[/green]&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">rc&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">archive&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mkdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">exist_ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">parents&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">shutil&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">copy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dest&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">timing&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">last_line&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">real&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">user&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">system&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">results&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;real_time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">float&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">real&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">results&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;user_time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">float&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">results&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;system_time&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">float&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">completed&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;span class="n">total_progress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">total_task&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">advance&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">futures&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">not_done&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="n">print_results&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">results&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">timing&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="n">loop&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">iterations&lt;/span> &lt;span class="o">*=&lt;/span> &lt;span class="n">growth&lt;/span>
&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;[yellow]Increasing iterations to &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">iterations&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">[/yellow]&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="k">break&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;span class="n">typer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">run_tests&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>configuration&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="c1"># ~/.zshrc &lt;/span>
&lt;span class="nb">alias&lt;/span> &lt;span class="nv">dslogs&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;python ~/.pyScript/dslogs.py&amp;#34;&lt;/span>
&lt;span class="nb">alias&lt;/span> &lt;span class="nv">dstest&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;python ~/.pyScript/dstest.py&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>dslogs&lt;/li>
&lt;/ul>
&lt;p>&lt;code>VERBOSE=1 go test &amp;gt; out&lt;/code>&lt;/p>
&lt;p>&lt;code>dslog out -c 6&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">â¯ dslogs --help
Usage: dslogs.py &lt;span class="o">[&lt;/span>OPTIONS&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>FILE&lt;span class="o">]&lt;/span>
â•­â”€ Arguments â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ file &lt;span class="o">[&lt;/span>FILE&lt;span class="o">]&lt;/span> File to read, stdin otherwise &lt;span class="o">[&lt;/span>default: None&lt;span class="o">]&lt;/span>
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•­â”€ Options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ --no-color &lt;span class="o">[&lt;/span>default: True&lt;span class="o">]&lt;/span>
â”‚ --columns -c INTEGER &lt;span class="o">[&lt;/span>default: None&lt;span class="o">]&lt;/span> // &amp;gt;rfçš„æ•°é‡
â”‚ --ignore -i TEXT &lt;span class="o">[&lt;/span>default: None&lt;span class="o">]&lt;/span> // ä¸æ˜¾ç¤ºæŸäº›TAG
â”‚ --just -j TEXT &lt;span class="o">[&lt;/span>default: None&lt;span class="o">]&lt;/span> // ä»…æ˜¾ç¤ºæŸäº›TAG
â”‚ --help Show this message and exit.
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>dstest&lt;/li>
&lt;/ul>
&lt;p>&lt;code>dstest -v 1 -s -p 10 -n 10 -o logs -r 2A&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">â¯ dstest --help
Usage: dstest.py &lt;span class="o">[&lt;/span>OPTIONS&lt;span class="o">]&lt;/span> TESTS...
â•­â”€ Arguments â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ * tests TESTS... &lt;span class="o">[&lt;/span>default: None&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>required&lt;span class="o">]&lt;/span>
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•­â”€ Options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ --sequential -s Run all &lt;span class="nb">test&lt;/span> of each group in order
â”‚ --workers -p INTEGER Number of parallel tasks &lt;span class="o">[&lt;/span>default: 1&lt;span class="o">]&lt;/span> // çº¿ç¨‹æ•°
â”‚ --iter -n INTEGER Number of iterations to run &lt;span class="o">[&lt;/span>default: 10&lt;span class="o">]&lt;/span> // é‡å¤è¿è¡ŒåŒä¸€ä¸ªä»»åŠ¡
â”‚ --output -o PATH Output path to use &lt;span class="o">[&lt;/span>default: None&lt;span class="o">]&lt;/span>
â”‚ --verbose -v INTEGER Verbosity level &lt;span class="o">[&lt;/span>default: 0&lt;span class="o">]&lt;/span> // æ˜¯å¦æ˜¾ç¤ºDprintfå†…å®¹
â”‚ --archive -a Save all logs intead of only failed ones
â”‚ --race -r --no-race -R Run with race checker &lt;span class="o">[&lt;/span>default: no-race&lt;span class="o">]&lt;/span>
â”‚ --loop -l Run continuously // æµ‹å®Œåç»§ç»­æ— é™æµ‹è¯•
â”‚ --growth -g INTEGER Growth ratio of iterations when using --loop &lt;span class="o">[&lt;/span>default: 10&lt;span class="o">]&lt;/span> // å’Œloopé…åˆä½¿ç”¨ï¼Œiter*&lt;span class="o">=&lt;/span>growth
â”‚ --timing -t Report timing, only works on macOS
â”‚ --help Show this message and exit.
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/raft/" term="Raft" label="Raft"/><category scheme="https://loomt.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" term="åˆ†å¸ƒå¼" label="åˆ†å¸ƒå¼"/><category scheme="https://loomt.top/tags/6.824/" term="6.824" label="6.824"/></entry><entry><title type="text">RPC</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/rpc/"/><id>https://loomt.top/posts/rpc/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2023-01-15T21:47:06+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">RPC Remote Procedure Call ç‰¹ç‚¹ RPC ä¸ HTTP å¹¶ä¸æ˜¯å¹¶åˆ—å…³ç³»ï¼ŒRPC åªæ˜¯ä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„è§„çº¦ï¼Œå¯ä»¥ç”¨ HTTP è¿›è¡Œä¿¡æ¯çš„ä¼ è¾“ã€‚ RPC çš„ä¸»è¦ç›®çš„æ˜¯åšåˆ°ä¸åŒæœåŠ¡é—´è°ƒç”¨æ–¹æ³•åƒåŒä¸€æœåŠ¡é—´è°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ã€‚ å¤§â€¦</summary><content type="html">&lt;h2 id="rpc">RPC&lt;/h2>
&lt;blockquote>
&lt;p>Remote Procedure Call&lt;/p>
&lt;/blockquote>
&lt;h3 id="ç‰¹ç‚¹">ç‰¹ç‚¹&lt;/h3>
&lt;p>RPC ä¸ HTTP å¹¶ä¸æ˜¯å¹¶åˆ—å…³ç³»ï¼ŒRPC åªæ˜¯ä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„è§„çº¦ï¼Œå¯ä»¥ç”¨ HTTP è¿›è¡Œä¿¡æ¯çš„ä¼ è¾“ã€‚&lt;/p>
&lt;p>RPC çš„ä¸»è¦ç›®çš„æ˜¯åšåˆ°ä¸åŒæœåŠ¡é—´è°ƒç”¨æ–¹æ³•åƒåŒä¸€æœåŠ¡é—´è°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ã€‚&lt;/p>
&lt;p>å¤§è‡´æµç¨‹æ˜¯ç¼–ç ï¼ˆå¯ä»¥ç”¨ protobufï¼‰ï¼Œä¼ è¾“ï¼Œæ¥æ”¶ï¼Œè§£ç &lt;/p>
&lt;h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹&lt;/h3>
&lt;ol>
&lt;li>å•ä¸€è´£ä»»&lt;/li>
&lt;li>æ‰©å±•æ€§&lt;/li>
&lt;li>æ•…éšœéš”ç¦»&lt;/li>
&lt;/ol>
&lt;h4 id="è®ºæ–‡æ¶æ„">è®ºæ–‡æ¶æ„&lt;/h4>
&lt;p>User, User-Stub, RPC-Runtime, Server-Stub, Server&lt;/p>
&lt;p>&lt;img src="https://loomt.top/img/Implementing-remote-procedure-calls.png" alt="Implementing-remote-procedure-calls">&lt;/p>
&lt;h3 id="å®ç°">å®ç°&lt;/h3>
&lt;p>&lt;img src="https://loomt.top/img/rpc-real.png" alt="rpc-real">&lt;/p>
&lt;h4 id="idl-interface-description-language">IDL (Interface description language)&lt;/h4>
&lt;p>Descript the interface.&lt;/p>
&lt;h5 id="tlv-ç¼–ç ">TLV ç¼–ç &lt;/h5>
&lt;ul>
&lt;li>Tagï¼šç±»å‹&lt;/li>
&lt;li>Lengthï¼šé•¿åº¦&lt;/li>
&lt;li>Valueï¼šå€¼ï¼ˆä¹Ÿå¯ä»¥æ˜¯ TLV ç»“æ„ï¼‰
&lt;img src="https://loomt.top/img/IDL-TLV.png" alt="IDL-TLV">&lt;/li>
&lt;/ul>
&lt;h4 id="gencode">GenCode&lt;/h4>
&lt;p>Translate the IDL to different programming language.&lt;/p>
&lt;p>Need decode and encode logic.&lt;/p>
&lt;p>å…¼å®¹æ€§â€”â€”å¢åŠ æ–°çš„å­—æ®µä¸å½±å“ç°æœ‰æœåŠ¡&lt;/p>
&lt;p>é€šç”¨æ€§â€”â€”è·¨å¹³å°è·¨è¯­è¨€&lt;/p>
&lt;p>æ€§èƒ½â€”â€”ç©ºé—´æ—¶é—´ç»´åº¦ï¼Œç¼–ç åçš„æ•°æ®å¤§å°å’Œç¼–ç æ—¶é•¿&lt;/p>
&lt;h4 id="encode">Encode&lt;/h4>
&lt;p>Conv code to byte.&lt;/p>
&lt;h4 id="protocol">Protocol&lt;/h4>
&lt;p>Necessary data and metadata&lt;/p>
&lt;p>0 1 2 3 4 5 6 7 8 9 a b c d e f 0 1 2 3 4 5 6 7 8 9 a b c d e f
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+
| 0| LENGTH |
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+
| 0| HEADER MAGIC | FLAGS |
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+
| SEQUENCE NUMBER |
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+
| 0| Header Size(/32) | &amp;hellip;
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&lt;/p>
&lt;pre>&lt;code> Header is of variable size:
(and starts at offset 14)
&lt;/code>&lt;/pre>
&lt;p>+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+
| PROTOCOL ID (varint) | NUM TRANSFORMS (varint) |
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+
| TRANSFORM 0 ID (varint) | TRANSFORM 0 DATA &amp;hellip;
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+
| &amp;hellip; &amp;hellip; |
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+
| INFO 0 ID (varint) | INFO 0 DATA &amp;hellip;
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+
| &amp;hellip; &amp;hellip; |
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+
| |
| PAYLOAD |
| |
+&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-+&lt;/p>
&lt;p>LENGTH: æ•°æ®åŒ…å¤§å°ï¼Œä¸åŒ…å«è‡ªèº«&lt;/p>
&lt;p>HEADER MAGIC:æ ‡è¯†ç‰ˆæœ¬ä¿¡æ¯ï¼Œåè®®è§£ææ—¶å¿«é€Ÿæ ¡éªŒ&lt;/p>
&lt;p>SEQUENCE NUMBER:è¡¨ç¤ºæ•°æ®åŒ…çš„ seqlDï¼Œå¯ç”¨äºå¤šè·¯å¤ç”¨ï¼Œå•è¿æ¥å†…é€’å¢
HEADER SIZE:å¤´éƒ¨é•¿åº¦ï¼Œä»ç¬¬ 14 ä¸ªå­—èŠ‚å¼€å§‹è®¡ç®—ä¸€ç›´åˆ° PAYLOAD å‰
PROTOCOL ID:ç¼–è§£ç æ–¹å¼ï¼Œæœ‰ Binary å’Œ Compact ä¸¤ç§
TRANSFORM ID:å‹ç¼©æ–¹å¼ï¼Œå¦‚ zlilb å’Œ snappy
INFO ID:ä¼ é€’ä¸€äº›å®šåˆ¶çš„ meta ä¿¡æ¯
PAYLOAD:æ¶ˆæ¯ä½“&lt;/p>
&lt;h4 id="network-transfer">Network Transfer&lt;/h4>
&lt;pre tabindex="0">&lt;code>Application Layer
Sockets API
TCP/UDP
IP
Driver
Physical Layer
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://loomt.top/img/socket.png" alt="socket">&lt;/p>
&lt;p>&lt;em>reference&lt;/em>&lt;/p>
&lt;p>&lt;a href="http://ddia.vonng.com/#/ch4?id=%e6%9c%8d%e5%8a%a1%e4%b8%ad%e7%9a%84%e6%95%b0%e6%8d%ae%e6%b5%81%ef%bc%9arest%e4%b8%8erpc">http://ddia.vonng.com/#/ch4?id=%e6%9c%8d%e5%8a%a1%e4%b8%ad%e7%9a%84%e6%95%b0%e6%8d%ae%e6%b5%81%ef%bc%9arest%e4%b8%8erpc&lt;/a>&lt;/p></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/></entry><entry><title type="text">go-zero å•ä½“æœåŠ¡</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/go-zero%E5%8D%95%E4%BD%93%E6%9C%8D%E5%8A%A1/"/><id>https://loomt.top/posts/go-zero%E5%8D%95%E4%BD%93%E6%9C%8D%E5%8A%A1/</id><updated>2023-05-06T16:40:09+00:00</updated><published>2023-01-08T09:46:11+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">go-zero go-zero ç®€ä»‹ go-zeroæ˜¯ä¸€ä¸ªèƒ½å¤Ÿå¿«é€Ÿç”Ÿæˆ APIï¼ŒMODEL å’Œ RPC çš„æ¡†æ¶ã€‚ go-zero é¡¹ç›®ç»“æ„ï¼ˆä¸å« RPCï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33â€¦</summary><content type="html">&lt;h2 id="go-zero">go-zero&lt;/h2>
&lt;h3 id="go-zero-ç®€ä»‹">go-zero ç®€ä»‹&lt;/h3>
&lt;p>&lt;a href="https://go-zero.dev/cn/docs/introduction">go-zero&lt;/a>æ˜¯ä¸€ä¸ªèƒ½å¤Ÿå¿«é€Ÿç”Ÿæˆ APIï¼ŒMODEL å’Œ RPC çš„æ¡†æ¶ã€‚&lt;/p>
&lt;h3 id="go-zero-é¡¹ç›®ç»“æ„ä¸å«-rpc">go-zero é¡¹ç›®ç»“æ„ï¼ˆä¸å« RPCï¼‰&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">.
â”œâ”€â”€ api
â”‚Â Â  â”œâ”€â”€ etc
â”‚Â Â  â”‚Â Â  â””â”€â”€ park-api.yaml
â”‚Â Â  â”œâ”€â”€ internal
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ config.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ handler
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ accessHandler.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ deviceInfoHandler.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ incomeHandler.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ parkingLotHandler.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ routes.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ siteInfoHandler.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ touristCarProvinceHandler.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ touristFlowHandler.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ userHandler.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ wechatHandler.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logic
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ accessLogic.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ deviceInfoLogic.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ incomeLogic.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ parkingLotLogic.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ siteInfoLogic.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ touristCarProvinceLogic.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ touristFlowLogic.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ userLogic.go
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ wechatLogic.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ svc
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ serviceContext.go
â”‚Â Â  â”‚Â Â  â””â”€â”€ types
â”‚Â Â  â”‚Â Â  â””â”€â”€ types.go
â”‚Â Â  â”œâ”€â”€ park.api
â”‚Â Â  â”œâ”€â”€ park.go
â”‚Â Â  â””â”€â”€ park.md
â”œâ”€â”€ genModel
â”‚Â Â  â”œâ”€â”€ model
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ accessModel.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ accessModel_gen.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ deviceInfoModel.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ deviceInfoModel_gen.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ incomeModel.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ incomeModel_gen.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logErrModel.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logErrModel_gen.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ parkingLotModel.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ parkingLotModel_gen.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ siteInfoModel.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ siteInfoModel_gen.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ touristCarProvinceModel.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ touristCarProvinceModel_gen.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ touristFlowModel.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ touristFlowModel_gen.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ userModel.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ userModel_gen.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ vars.go
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ wechatModel.go
â”‚Â Â  â”‚Â Â  â””â”€â”€ wechatModel_gen.go
â”‚Â Â  â””â”€â”€ resources
â”‚Â Â  â”œâ”€â”€ genModel.sh
â”‚Â Â  â””â”€â”€ park.sql
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ model
â”œâ”€â”€ accessModel.go
â”œâ”€â”€ accessModel_gen.go
â”œâ”€â”€ deviceInfoModel.go
â”œâ”€â”€ deviceInfoModel_gen.go
â”œâ”€â”€ incomeModel.go
â”œâ”€â”€ incomeModel_gen.go
â”œâ”€â”€ logErrModel.go
â”œâ”€â”€ logErrModel_gen.go
â”œâ”€â”€ parkingLotModel.go
â”œâ”€â”€ parkingLotModel_gen.go
â”œâ”€â”€ siteInfoModel.go
â”œâ”€â”€ siteInfoModel_gen.go
â”œâ”€â”€ touristCarProvinceModel.go
â”œâ”€â”€ touristCarProvinceModel_gen.go
â”œâ”€â”€ touristFlowModel.go
â”œâ”€â”€ touristFlowModel_gen.go
â”œâ”€â”€ userModel.go
â”œâ”€â”€ userModel_gen.go
â”œâ”€â”€ vars.go
â”œâ”€â”€ wechatModel.go
â””â”€â”€ wechatModel_gen.go
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>api&lt;/code> æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾å¤–éƒ¨è°ƒç”¨ï¼Œéœ€è¦æ”¹åŠ¨çš„æ˜¯ &lt;code>*.api&lt;/code>, &lt;code>etc/*.yaml&lt;/code>, &lt;code>svc/serviceContext.go&lt;/code>, &lt;code>logic/*&lt;/code>ï¼Œä½œç”¨åˆ†åˆ«æ˜¯ç”Ÿæˆ api è°ƒç”¨æ¡†æ¶ï¼Œå†™é…ç½®æ–‡ä»¶ï¼Œå°†æ•°æ®æ·»åŠ åˆ° Context ä¾›é€»è¾‘è°ƒç”¨ï¼Œé€»è¾‘å®ç°ã€‚&lt;/li>
&lt;li>&lt;code>genModel&lt;/code> æ–‡ä»¶å¤¹ç”¨äºç”Ÿæˆæ•°æ®åº“è°ƒç”¨ç›¸å…³å®ç°ï¼Œéœ€è¦æ”¹åŠ¨çš„æ˜¯&lt;code>resources/*.sql&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>model&lt;/code> æ–‡ä»¶å¤¹ç”¨äºæ·»åŠ é¢å¤–çš„æ•°æ®åº“è°ƒç”¨é€»è¾‘ï¼ˆå°†&lt;code>genModel/model/*&lt;/code>å¤åˆ¶åˆ° model åå¼€æ”¹ï¼ï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="ç®€å•ä½¿ç”¨">ç®€å•ä½¿ç”¨&lt;/h3>
&lt;p>é€šè¿‡ goctl ç”Ÿæˆä»£ç æ¡†æ¶ã€‚&lt;/p>
&lt;h4 id="api-æ¡†æ¶é€šè¿‡-apiapiç”Ÿæˆ">API æ¡†æ¶é€šè¿‡ &lt;code>api/*.api&lt;/code>ç”Ÿæˆ&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="c1">//park.api
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="nx">syntax&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;v1&amp;#34;&lt;/span>
&lt;span class="nf">info&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nx">title&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;parkApi&amp;#34;&lt;/span>
&lt;span class="nx">desc&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;parkBackEnd&amp;#34;&lt;/span>
&lt;span class="nx">author&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;loomt&amp;#34;&lt;/span>
&lt;span class="nx">email&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;loomt_@outlook.com&amp;#34;&lt;/span>
&lt;span class="nx">version&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;1.0&amp;#34;&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="kd">type&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="nx">accessResp&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Id&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span>
&lt;span class="nx">Location&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;location&amp;#34;`&lt;/span> &lt;span class="c1">// æ¥å…¥åœ°ç‚¹
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Date&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;date&amp;#34;`&lt;/span> &lt;span class="c1">// æ¥å…¥æ—¥æœŸ
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Num&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;num&amp;#34;`&lt;/span> &lt;span class="c1">// æ¥å…¥æ•°é‡
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nx">incomeResp&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Id&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span>
&lt;span class="nx">Type&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;type&amp;#34;`&lt;/span> &lt;span class="c1">// æ”¶å…¥ç±»å‹
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Date&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;date&amp;#34;`&lt;/span> &lt;span class="c1">// æ—¥æœŸ
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Num&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;num&amp;#34;`&lt;/span> &lt;span class="c1">// å½“å¤©æ”¶å…¥
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nx">parkingLotResp&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Id&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span>
&lt;span class="nx">Name&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;name&amp;#34;`&lt;/span> &lt;span class="c1">// åœè½¦åœºåå­—
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Duration&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;duration&amp;#34;`&lt;/span> &lt;span class="c1">// åœè½¦æ—¶é—´ï¼ˆå°æ—¶ï¼‰
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Num&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;num&amp;#34;`&lt;/span> &lt;span class="c1">// æ³Šè½¦æ•°
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nx">siteInfoResp&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Id&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span>
&lt;span class="nx">Date&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;date&amp;#34;`&lt;/span> &lt;span class="c1">// æ—¥æœŸ
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">RevisitRate&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;revisit_rate&amp;#34;`&lt;/span> &lt;span class="c1">// é‡å¤è®¿é—®ç‡ï¼ˆ%ï¼‰
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">SiteHealth&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;site_health&amp;#34;`&lt;/span> &lt;span class="c1">// ç«™ç‚¹å¥åº·åº¦
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">RfHealth&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;rf_health&amp;#34;`&lt;/span> &lt;span class="c1">// å°„é¢‘å¥åº·åº¦
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">DeviceHealth&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;device_health&amp;#34;`&lt;/span> &lt;span class="c1">// è®¾å¤‡å¥åº·åº¦
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Flow&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;flow&amp;#34;`&lt;/span> &lt;span class="c1">// å½“æ—¥ç«™ç‚¹æµé‡
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nx">touristFlowResp&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Id&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span>
&lt;span class="nx">Location&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;location&amp;#34;`&lt;/span> &lt;span class="c1">// å›­åŒºåœ°ç‚¹
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Date&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;date&amp;#34;`&lt;/span> &lt;span class="c1">// æ—¶é—´
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Num&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;num&amp;#34;`&lt;/span> &lt;span class="c1">// æ¸¸å®¢æ•°é‡
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nx">touristCarProvinceResp&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Id&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span>
&lt;span class="nx">Province&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;province&amp;#34;`&lt;/span> &lt;span class="c1">// çœä»½
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Date&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;date&amp;#34;`&lt;/span> &lt;span class="c1">// æ—¥æœŸ
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">FlowNum&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;flow_num&amp;#34;`&lt;/span> &lt;span class="c1">// äººæµæ•°é‡
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">CarNum&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;car_num&amp;#34;`&lt;/span> &lt;span class="c1">// è½¦è¾†æ•°
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nx">userReq&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Id&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span> &lt;span class="c1">// ç”¨æˆ· id
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nx">userResp&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Id&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span> &lt;span class="c1">// ç”¨æˆ· id
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Username&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;username&amp;#34;`&lt;/span> &lt;span class="c1">// ç”¨æˆ·å
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nx">wechatResp&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Date&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;date&amp;#34;`&lt;/span> &lt;span class="c1">// æ—¥æœŸ
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Num&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;num&amp;#34;`&lt;/span> &lt;span class="c1">// å¾®ä¿¡å…³æ³¨æ•°é‡
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="nx">deviceInfoResp&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">Id&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span>
&lt;span class="nx">UplinkRate&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="s">`json:&amp;#34;uplink_rate&amp;#34;`&lt;/span> &lt;span class="c1">// ä¸Šè¡Œé€Ÿç‡
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">DownlinkRate&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="s">`json:&amp;#34;downlink_rate&amp;#34;`&lt;/span> &lt;span class="c1">// ä¸‹è½½é€Ÿç‡
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Flow&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="s">`json:&amp;#34;flow&amp;#34;`&lt;/span> &lt;span class="c1">// æµé‡
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">CpuRate&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="s">`json:&amp;#34;cpu_rate&amp;#34;`&lt;/span> &lt;span class="c1">// CPU å æœ‰ç‡
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Longitude&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="s">`json:&amp;#34;longitude&amp;#34;`&lt;/span> &lt;span class="c1">// ç»åº¦
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">Latitude&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="s">`json:&amp;#34;latitude&amp;#34;`&lt;/span> &lt;span class="c1">// çº¬åº¦
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nf">server&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nx">prefix&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">api&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="nx">service&lt;/span> &lt;span class="nx">park&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">api&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">doc&lt;/span> &lt;span class="s">&amp;#34;è·å–æ¥å…¥è¯¦æƒ…&amp;#34;&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">handler&lt;/span> &lt;span class="nx">accessHandler&lt;/span>
&lt;span class="nx">get&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">access&lt;/span> &lt;span class="nf">returns&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">accessResp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">doc&lt;/span> &lt;span class="s">&amp;#34;è·å–æ—¥æ”¶å…¥è¯¦æƒ…&amp;#34;&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">handler&lt;/span> &lt;span class="nx">incomeHandler&lt;/span>
&lt;span class="nx">get&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">income&lt;/span> &lt;span class="nf">returns&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">incomeResp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">doc&lt;/span> &lt;span class="s">&amp;#34;è·å–åœè½¦è¯¦æƒ…&amp;#34;&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">handler&lt;/span> &lt;span class="nx">parkingLotHandler&lt;/span>
&lt;span class="nx">get&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">parkingLot&lt;/span> &lt;span class="nf">returns&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">parkingLotResp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">doc&lt;/span> &lt;span class="s">&amp;#34;è·å–ç«™ç‚¹è¯¦æƒ…&amp;#34;&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">handler&lt;/span> &lt;span class="nx">siteInfoHandler&lt;/span>
&lt;span class="nx">get&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">siteInfo&lt;/span> &lt;span class="nf">returns&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">siteInfoResp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">doc&lt;/span> &lt;span class="s">&amp;#34;è·å–å®¢æµé‡è¯¦æƒ…&amp;#34;&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">handler&lt;/span> &lt;span class="nx">touristFlowHandler&lt;/span>
&lt;span class="nx">get&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">touristFlow&lt;/span> &lt;span class="nf">returns&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">touristFlowResp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">doc&lt;/span> &lt;span class="s">&amp;#34;è·å–æ¸¸å®¢ä¸è½¦è¾†æ¥æºçœä»½&amp;#34;&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">handler&lt;/span> &lt;span class="nx">touristCarProvinceHandler&lt;/span>
&lt;span class="nx">get&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">touristCarProvince&lt;/span> &lt;span class="nf">returns&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">touristCarProvinceResp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">doc&lt;/span> &lt;span class="s">&amp;#34;è·å–ç”¨æˆ·è¯¦æƒ…&amp;#34;&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">handler&lt;/span> &lt;span class="nx">userHandler&lt;/span>
&lt;span class="nx">post&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nf">user&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">userReq&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">returns&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">userResp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">doc&lt;/span> &lt;span class="s">&amp;#34;è·å–å¾®ä¿¡å…³æ³¨è¯¦æƒ…&amp;#34;&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">handler&lt;/span> &lt;span class="nx">wechatHandler&lt;/span>
&lt;span class="nx">get&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">wechat&lt;/span> &lt;span class="nf">returns&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">wechatResp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">doc&lt;/span> &lt;span class="s">&amp;#34;è·å–è®¾å¤‡ä¿¡æ¯&amp;#34;&lt;/span>
&lt;span class="err">@&lt;/span>&lt;span class="nx">handler&lt;/span> &lt;span class="nx">deviceInfoHandler&lt;/span>
&lt;span class="nx">get&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">deviceInfo&lt;/span> &lt;span class="nf">returns&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">deviceInfoResp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="c1"># api&lt;/span>
goctl api go -api *.api -dir ./ --style&lt;span class="o">=&lt;/span>goZero
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="model-æ¡†æ¶æœ‰ä¸¤ç§ç”Ÿæˆæ–¹å¼">MODEL æ¡†æ¶æœ‰ä¸¤ç§ç”Ÿæˆæ–¹å¼&lt;/h4>
&lt;ul>
&lt;li>è¿æ¥æ•°æ®åº“ç”Ÿæˆ model&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="cp">#!/usr/bin/env zsh
&lt;/span>&lt;span class="cp">&lt;/span>&lt;span class="c1"># ä½¿ç”¨æ–¹æ³•ï¼š&lt;/span>
&lt;span class="c1"># ./genModel.sh usercenter user&lt;/span>
&lt;span class="c1"># ./genModel.sh usercenter user_auth&lt;/span>
&lt;span class="c1"># å†å°†./genModelä¸‹çš„æ–‡ä»¶å‰ªåˆ‡åˆ°å¯¹åº”æœåŠ¡çš„modelç›®å½•é‡Œé¢ï¼Œè®°å¾—æ”¹package&lt;/span>
&lt;span class="c1">#ç”Ÿæˆçš„è¡¨å&lt;/span>
&lt;span class="nv">tables&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$2&lt;/span>
&lt;span class="c1">#è¡¨ç”Ÿæˆçš„genmodelç›®å½•&lt;/span>
&lt;span class="nv">modeldir&lt;/span>&lt;span class="o">=&lt;/span>../model
&lt;span class="c1"># æ•°æ®åº“é…ç½®&lt;/span>
&lt;span class="nv">host&lt;/span>&lt;span class="o">=&lt;/span>127.0.0.1
&lt;span class="nv">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3306&lt;/span>
&lt;span class="nv">dbname&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$1&lt;/span>
&lt;span class="nv">username&lt;/span>&lt;span class="o">=&lt;/span>root
&lt;span class="nv">passwd&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">123456&lt;/span>
&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;å¼€å§‹åˆ›å»ºåº“ï¼š&lt;/span>&lt;span class="nv">$dbname&lt;/span>&lt;span class="s2"> çš„è¡¨ï¼š&lt;/span>&lt;span class="nv">$2&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
goctl model mysql datasource -url&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">username&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">:&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">passwd&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">@tcp(&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">host&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">:&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">port&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">)/&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">dbname&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> -table&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">tables&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> -dir&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">modeldir&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> --style&lt;span class="o">=&lt;/span>goZero
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>ç›´æ¥ç”¨ sql æ–‡ä»¶ (&lt;code>genModel/resource/*.sql&lt;/code>) ç”Ÿæˆ model&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="c1"># genModel/resources&lt;/span>
goctl model mysql ddl -src&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;./*.sql&amp;#34;&lt;/span> -dir&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;../model&amp;#34;&lt;/span> --style&lt;span class="o">=&lt;/span>goZero
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ç”Ÿæˆæ–‡æ¡£">ç”Ÿæˆæ–‡æ¡£&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="c1"># ./&lt;/span>
goctl api doc -dir .
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åä¸ºäº‘éƒ¨ç½²">åä¸ºäº‘éƒ¨ç½²&lt;/h2>
&lt;ol>
&lt;li>mysql å¯¼å…¥&lt;/li>
&lt;li>&lt;code>nohup go run *.go -f etc/*.yaml 2&amp;gt;&amp;amp;1 &amp;amp;&lt;/code>&lt;/li>
&lt;/ol></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/go-zero/" term="go-zero" label="go-zero"/></entry><entry><title type="text">åä¸ºäº‘å…¬ç½‘éƒ¨ç½²</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%85%AC%E7%BD%91%E9%83%A8%E7%BD%B2/"/><id>https://loomt.top/posts/%E5%8D%8E%E4%B8%BA%E4%BA%91%E5%85%AC%E7%BD%91%E9%83%A8%E7%BD%B2/</id><updated>2023-05-06T16:40:09+00:00</updated><published>2022-11-08T22:47:51+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">è®°ä¸€æ¬¡åä¸ºäº‘è€€äº‘æœåŠ¡å™¨å…¬ç½‘éƒ¨ç½²é—®é¢˜ å¼€äº†å®‰å…¨ç»„ï¼Œç”¨ caddy éƒ¨ç½²äº†ä¸€ä¸ªå°ç½‘é¡µæ¥æµ‹è¯•å…¬ç½‘è®¿é—® å¯ä»¥çœ‹åˆ°å†…ç½‘è®¿é—®æ˜¯æ­£å¸¸çš„ã€‚ä¹Ÿå¯ä»¥ ping é€š æ ¹æ®åä¸ºäº‘å®˜ç½‘ç»™å‡ºçš„æŒ‡å¼•æ’æŸ¥äº†å¾ˆä¹…ï¼Œç»‘å®šäº†å¼¹â€¦</summary><content type="html">&lt;h2 id="è®°ä¸€æ¬¡åä¸ºäº‘è€€äº‘æœåŠ¡å™¨å…¬ç½‘éƒ¨ç½²é—®é¢˜">è®°ä¸€æ¬¡åä¸ºäº‘è€€äº‘æœåŠ¡å™¨å…¬ç½‘éƒ¨ç½²é—®é¢˜&lt;/h2>
&lt;p>å¼€äº†å®‰å…¨ç»„ï¼Œç”¨ caddy éƒ¨ç½²äº†ä¸€ä¸ªå°ç½‘é¡µæ¥æµ‹è¯•å…¬ç½‘è®¿é—®
&lt;img src="https://loomt.top/img/sky.jpg" alt="sky">&lt;/p>
&lt;p>&lt;img src="https://loomt.top/img/run-caddy.png" alt="run-caddy">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°å†…ç½‘è®¿é—®æ˜¯æ­£å¸¸çš„ã€‚ä¹Ÿå¯ä»¥ ping é€š&lt;/p>
&lt;p>&lt;img src="https://loomt.top/img/ping-cloud.png" alt="ping-cloud">&lt;/p>
&lt;p>æ ¹æ®åä¸ºäº‘å®˜ç½‘ç»™å‡ºçš„æŒ‡å¼•æ’æŸ¥äº†å¾ˆä¹…ï¼Œç»‘å®šäº†å¼¹æ€§å…¬ç½‘ ipï¼Œè®¾ç½®äº†å®‰å…¨ç»„ Sys-FullAccessã€ACLï¼Œéƒ½æ— æ³•ç”¨æµè§ˆå™¨è®¿é—®ã€‚&lt;/p>
&lt;p>æœ€åå›åˆ°æœåŠ¡å™¨ &lt;em>æŸ¥è¯¢é˜²ç«å¢™çŠ¶æ€&lt;/em>&lt;/p>
&lt;p>å…³æ‰é˜²ç«å¢™å°±å¯ä»¥äº†
&lt;img src="https://loomt.top/img/disable-firewall.png" alt="disable-firewall">
å¯¹ç€åä¸ºäº‘çš„æ§åˆ¶å°æäº†å¾ˆä¹…å®‰å…¨ç»„ï¼Œè¿˜ä»¥ä¸ºå®‰å…¨ç»„å“ªé‡Œé…é”™äº†ï¼Œæœ€åå‘ç°æ˜¯æœåŠ¡å™¨é˜²ç«å¢™çš„é—®é¢˜ğŸ˜­&lt;/p></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" term="äº‘æœåŠ¡å™¨" label="äº‘æœåŠ¡å™¨"/></entry><entry><title type="text">å°ç±³ 4A åƒå…†ç‰ˆåˆ· OpenWrt</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/%E5%B0%8F%E7%B1%B34a%E5%8D%83%E5%85%86%E7%89%88%E5%88%B7openwrt/"/><id>https://loomt.top/posts/%E5%B0%8F%E7%B1%B34a%E5%8D%83%E5%85%86%E7%89%88%E5%88%B7openwrt/</id><updated>2023-05-06T16:40:09+00:00</updated><published>2022-08-12T15:58:38+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">æ‘†çƒ‚ï¼Œäºæ˜¯å°†ç›®å…‰çœ‹å‘äº†å®¶é‡Œçš„å°ç±³ 4a åƒå…†ç‰ˆè·¯ç”±å™¨ï¼Œå‡†å¤‡åˆ·ä¸ª Openwrt ç©ä¸€ä¸‹ã€‚ å»æ©å±±è®ºå›é€›äº†é€›ï¼Œæ„Ÿè§‰åˆ·è½¯è·¯ç”±å’Œåˆ·æ‰‹æœºå·®ä¸å¤ªå¤šã€‚ å®‰è£… Breedï¼ˆé—­æºå…è´¹çš„ BootLoaderâ€¦</summary><content type="html">&lt;blockquote>
&lt;p>æ‘†çƒ‚ï¼Œäºæ˜¯å°†ç›®å…‰çœ‹å‘äº†å®¶é‡Œçš„å°ç±³ 4a åƒå…†ç‰ˆè·¯ç”±å™¨ï¼Œå‡†å¤‡åˆ·ä¸ª Openwrt ç©ä¸€ä¸‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å»&lt;a href="https://www.right.com.cn/forum/forum.php">æ©å±±è®ºå›&lt;/a>é€›äº†é€›ï¼Œæ„Ÿè§‰åˆ·è½¯è·¯ç”±å’Œåˆ·æ‰‹æœºå·®ä¸å¤ªå¤šã€‚&lt;/p>
&lt;ol>
&lt;li>å®‰è£… Breedï¼ˆé—­æºå…è´¹çš„ BootLoaderï¼Œåˆç§°â€œä¸æ­»é¸Ÿâ€ï¼Œæœ‰äº†å®ƒå°±èƒ½è‚†æ— å¿Œæƒ®åœ°åˆ·å„ç§ç¬¬ä¸‰æ–¹åŒ…äº†&lt;/li>
&lt;/ol>
&lt;p>å¦‚æœä½ çš„è·¯ç”±å™¨æ˜¯å°ç±³ 4A åƒå…†ç‰ˆï¼Œå¯ä»¥ç›´æ¥ç”¨æ©å±±è®ºå›çš„&lt;a href="https://pan.loomt.top/Xiaomi4A/R4A.zip">æ— è„‘ç›´è£… Breed&lt;/a>ï¼›å¦‚æœä¸æ˜¯ï¼Œä¹Ÿå¯ä»¥å»&lt;a href="https://breed.hackpascal.net/">Breed å®˜ç½‘&lt;/a>ä¸‹è½½è·¯ç”±å™¨çš„é€‚é…åŒ…å¹¶è‡ªè¡Œæœç´¢å¦‚ä½•é€šè¿‡ Telnet è¿æ¥è·¯ç”±å™¨å¹¶åˆ·å…¥ Breedã€‚
&lt;img src="https://loomt.top/img/breed.png" alt="Breed">&lt;/p>
&lt;ol start="2">
&lt;li>ç”¨ Breed å®‰è£… OpenWrt&lt;/li>
&lt;/ol>
&lt;p>è¿™é‡Œæ”¾ä¸€ä¸ª&lt;a href="https://pan.loomt.top/Xiaomi4A/openwrt-ramips-mt7621-xiaomi_mi-router-4a-gigabit-squashfs-sysupgrade.bin">å°ç±³ 4A åƒå…†ç‰ˆ OpenWrt ç›´åˆ·åŒ…&lt;/a>ï¼Œå…¶ä»–è·¯ç”±å™¨çš„å›ºä»¶å¯ä»¥å»æ©å±±è®ºå›é€›é€›ã€‚
&lt;style type="text/css">.notice{--root-color:#444;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#c33;--warning-content:#fee;--info-title:#fb7;--info-content:#fec;--note-title:#6be;--note-content:#e7f2fa;--tip-title:#5a5;--tip-content:#efe}@media (prefers-color-scheme:dark){.notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}}body.dark .notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}&lt;/style>
&lt;div>&lt;svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg">&lt;symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/>&lt;/symbol>&lt;symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/>&lt;/symbol>&lt;symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/>&lt;/symbol>&lt;symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/>&lt;/symbol>&lt;/svg>&lt;/div>&lt;div class="notice warning" >
&lt;p class="first notice-title">&lt;span class="icon-notice baseline">&lt;svg>&lt;use href="https://loomt.top/posts/%E5%B0%8F%E7%B1%B34a%E5%8D%83%E5%85%86%E7%89%88%E5%88%B7openwrt/#warning-notice">&lt;/use>&lt;/svg>&lt;/span>è­¦å‘Š&lt;/p>&lt;p>åˆ· OpenWrt ä¹‹å‰å¿…é¡»ç”¨ Breed å¤‡ä»½ eepromï¼ˆæ²¡æœ‰å¤‡ä»½ eeprom å°†å¯¼è‡´ 5G ä¿¡å·å¥‡å·®ï¼‰&lt;/p>&lt;/div>
&lt;/p>
&lt;p>ç‚¹å‡»å›ºä»¶æ›´æ–°~&amp;gt;å¸¸è§„å›ºä»¶~&amp;gt;å‹¾ä¸Šâ€œå›ºä»¶â€å’Œâ€œEEPROMâ€ï¼Œé€‰æ‹©å¥½ä¸Šé¢çš„ç›´åˆ·åŒ…å’Œå¤‡ä»½çš„ eeprom.binï¼Œä¸Šä¼ å³å¯ã€‚&lt;/p>
&lt;ol start="3">
&lt;li>é…ç½® OpenWrt çš„å„é¡¹å‚æ•°ï¼ˆéšä¾¿é…ä¸€ä¸‹å³å¯&lt;/li>
&lt;/ol>
&lt;p>OpenWrt å¯è°“ç¥é€šå¹¿å¤§ï¼Œä½œä¸ºä¸€ä¸ªåœ¨è·¯ç”±å™¨ä¸Šè·‘çš„ Linuxï¼Œå®ƒå¯ä»¥è£…ä¸Šå„ç§æ’ä»¶ï¼šé…¸é…¸ä¹³ã€Dockerã€ç½‘æ˜“äº‘è§£é”ç°è‰²æ­Œæ›²â€¦â€¦&lt;/p>
&lt;p>ä½†æˆ‘æŠ˜è…¾äº†ä¸€é€šï¼Œè°ƒæ•™å¥½åŸºç¡€çš„ä¸Šç½‘åŠŸèƒ½åï¼Œæ„Ÿè§‰ç½‘ç»œçŠ¶å†µå¤§ä¸å¦‚å‰ã€‚ä½œä¸ºç™¾æ¥å—çš„è·¯ç”±å™¨ï¼Œæœ¬æ¥å°±æ²¡æœ‰å¤šå¤§çš„å†…å­˜ï¼Œæ„Ÿè§‰åŸå‚å›ºä»¶çš„è°ƒæ•™å·²ç»å°†æ€§èƒ½éƒ½ç”¨åœ¨åˆ€åˆƒä¸Šäº†ã€‚è£…äº† OpenWrt åè™½ç„¶ä¸Šä¸‹è¡Œæµé‡é€Ÿåº¦æ²¡æœ‰å¾ˆå¤§å˜åŒ–ï¼Œä½†ç¨³å®šæ€§å·®äº†å¾ˆå¤šï¼Œä¾¿æ‡’å¾—ç»§ç»­æŠ˜è…¾ï¼Œå¿ç—› remake äº†ã€‚&lt;/p>
&lt;ol start="4">
&lt;li>åˆ·å›å®˜æ–¹åŒ…ï¼ˆæ²¡å¤‡ä»½ eeprom çš„é—®é¢˜ &lt;strong>æˆ–è®¸&lt;/strong> ä¹Ÿå¯ä»¥é€šè¿‡åˆ·å›å®˜æ–¹åŒ…çš„æ–¹æ³•è§£å†³&lt;/li>
&lt;/ol>
&lt;p>ä¸‹è½½&lt;a href="https://pan.loomt.top/Xiaomi4A/all.bin">å°ç±³ 4A åƒå…†ç‰ˆå®˜æ–¹åŒ…&lt;/a>ï¼Œè¿›å…¥ Breed~&amp;gt;å›ºä»¶æ›´æ–°~&amp;gt;ç¼–ç¨‹å™¨å›ºä»¶ (ä»…å‹¾é€‰è‡ªåŠ¨é‡å¯)~&amp;gt;ä¸Šä¼  all.binã€‚&lt;/p></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/></entry><entry><title type="text">Auto7zip</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/auto7zip/"/><id>https://loomt.top/posts/auto7zip/</id><updated>2023-05-07T00:34:23+08:00</updated><published>2022-07-20T12:12:02+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">7-Zip åŒå‡»è‡ªåŠ¨è§£å‹å‹ç¼©æ–‡ä»¶ å› ä¸ºéš¾ä»¥å¿å— 7zip çš„å³é”®è§£å‹æ“ä½œï¼Œé€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨ä»¥è‡ªåŠ¨è§£å‹ã€‚ æ›¿æ¢ D:\\000000000000\\7-Zip ä¸º your\\path\\to\\7-Zip å°†ä»£ç å¡è¿›.reg æ–‡ä»¶ï¼ŒåŒå‡»å³å¯ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19â€¦</summary><content type="html">&lt;h1 id="7-zip-åŒå‡»è‡ªåŠ¨è§£å‹å‹ç¼©æ–‡ä»¶">7-Zip åŒå‡»è‡ªåŠ¨è§£å‹å‹ç¼©æ–‡ä»¶&lt;/h1>
&lt;blockquote>
&lt;p>å› ä¸ºéš¾ä»¥å¿å— 7zip çš„å³é”®è§£å‹æ“ä½œï¼Œé€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨ä»¥è‡ªåŠ¨è§£å‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>æ›¿æ¢ &lt;code>D:\\000000000000\\7-Zip&lt;/code> ä¸º &lt;code>your\\path\\to\\7-Zip&lt;/code>&lt;/li>
&lt;li>å°†ä»£ç å¡è¿›.reg æ–‡ä»¶ï¼ŒåŒå‡»å³å¯ã€‚&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;span class="lnt">202
&lt;/span>&lt;span class="lnt">203
&lt;/span>&lt;span class="lnt">204
&lt;/span>&lt;span class="lnt">205
&lt;/span>&lt;span class="lnt">206
&lt;/span>&lt;span class="lnt">207
&lt;/span>&lt;span class="lnt">208
&lt;/span>&lt;span class="lnt">209
&lt;/span>&lt;span class="lnt">210
&lt;/span>&lt;span class="lnt">211
&lt;/span>&lt;span class="lnt">212
&lt;/span>&lt;span class="lnt">213
&lt;/span>&lt;span class="lnt">214
&lt;/span>&lt;span class="lnt">215
&lt;/span>&lt;span class="lnt">216
&lt;/span>&lt;span class="lnt">217
&lt;/span>&lt;span class="lnt">218
&lt;/span>&lt;span class="lnt">219
&lt;/span>&lt;span class="lnt">220
&lt;/span>&lt;span class="lnt">221
&lt;/span>&lt;span class="lnt">222
&lt;/span>&lt;span class="lnt">223
&lt;/span>&lt;span class="lnt">224
&lt;/span>&lt;span class="lnt">225
&lt;/span>&lt;span class="lnt">226
&lt;/span>&lt;span class="lnt">227
&lt;/span>&lt;span class="lnt">228
&lt;/span>&lt;span class="lnt">229
&lt;/span>&lt;span class="lnt">230
&lt;/span>&lt;span class="lnt">231
&lt;/span>&lt;span class="lnt">232
&lt;/span>&lt;span class="lnt">233
&lt;/span>&lt;span class="lnt">234
&lt;/span>&lt;span class="lnt">235
&lt;/span>&lt;span class="lnt">236
&lt;/span>&lt;span class="lnt">237
&lt;/span>&lt;span class="lnt">238
&lt;/span>&lt;span class="lnt">239
&lt;/span>&lt;span class="lnt">240
&lt;/span>&lt;span class="lnt">241
&lt;/span>&lt;span class="lnt">242
&lt;/span>&lt;span class="lnt">243
&lt;/span>&lt;span class="lnt">244
&lt;/span>&lt;span class="lnt">245
&lt;/span>&lt;span class="lnt">246
&lt;/span>&lt;span class="lnt">247
&lt;/span>&lt;span class="lnt">248
&lt;/span>&lt;span class="lnt">249
&lt;/span>&lt;span class="lnt">250
&lt;/span>&lt;span class="lnt">251
&lt;/span>&lt;span class="lnt">252
&lt;/span>&lt;span class="lnt">253
&lt;/span>&lt;span class="lnt">254
&lt;/span>&lt;span class="lnt">255
&lt;/span>&lt;span class="lnt">256
&lt;/span>&lt;span class="lnt">257
&lt;/span>&lt;span class="lnt">258
&lt;/span>&lt;span class="lnt">259
&lt;/span>&lt;span class="lnt">260
&lt;/span>&lt;span class="lnt">261
&lt;/span>&lt;span class="lnt">262
&lt;/span>&lt;span class="lnt">263
&lt;/span>&lt;span class="lnt">264
&lt;/span>&lt;span class="lnt">265
&lt;/span>&lt;span class="lnt">266
&lt;/span>&lt;span class="lnt">267
&lt;/span>&lt;span class="lnt">268
&lt;/span>&lt;span class="lnt">269
&lt;/span>&lt;span class="lnt">270
&lt;/span>&lt;span class="lnt">271
&lt;/span>&lt;span class="lnt">272
&lt;/span>&lt;span class="lnt">273
&lt;/span>&lt;span class="lnt">274
&lt;/span>&lt;span class="lnt">275
&lt;/span>&lt;span class="lnt">276
&lt;/span>&lt;span class="lnt">277
&lt;/span>&lt;span class="lnt">278
&lt;/span>&lt;span class="lnt">279
&lt;/span>&lt;span class="lnt">280
&lt;/span>&lt;span class="lnt">281
&lt;/span>&lt;span class="lnt">282
&lt;/span>&lt;span class="lnt">283
&lt;/span>&lt;span class="lnt">284
&lt;/span>&lt;span class="lnt">285
&lt;/span>&lt;span class="lnt">286
&lt;/span>&lt;span class="lnt">287
&lt;/span>&lt;span class="lnt">288
&lt;/span>&lt;span class="lnt">289
&lt;/span>&lt;span class="lnt">290
&lt;/span>&lt;span class="lnt">291
&lt;/span>&lt;span class="lnt">292
&lt;/span>&lt;span class="lnt">293
&lt;/span>&lt;span class="lnt">294
&lt;/span>&lt;span class="lnt">295
&lt;/span>&lt;span class="lnt">296
&lt;/span>&lt;span class="lnt">297
&lt;/span>&lt;span class="lnt">298
&lt;/span>&lt;span class="lnt">299
&lt;/span>&lt;span class="lnt">300
&lt;/span>&lt;span class="lnt">301
&lt;/span>&lt;span class="lnt">302
&lt;/span>&lt;span class="lnt">303
&lt;/span>&lt;span class="lnt">304
&lt;/span>&lt;span class="lnt">305
&lt;/span>&lt;span class="lnt">306
&lt;/span>&lt;span class="lnt">307
&lt;/span>&lt;span class="lnt">308
&lt;/span>&lt;span class="lnt">309
&lt;/span>&lt;span class="lnt">310
&lt;/span>&lt;span class="lnt">311
&lt;/span>&lt;span class="lnt">312
&lt;/span>&lt;span class="lnt">313
&lt;/span>&lt;span class="lnt">314
&lt;/span>&lt;span class="lnt">315
&lt;/span>&lt;span class="lnt">316
&lt;/span>&lt;span class="lnt">317
&lt;/span>&lt;span class="lnt">318
&lt;/span>&lt;span class="lnt">319
&lt;/span>&lt;span class="lnt">320
&lt;/span>&lt;span class="lnt">321
&lt;/span>&lt;span class="lnt">322
&lt;/span>&lt;span class="lnt">323
&lt;/span>&lt;span class="lnt">324
&lt;/span>&lt;span class="lnt">325
&lt;/span>&lt;span class="lnt">326
&lt;/span>&lt;span class="lnt">327
&lt;/span>&lt;span class="lnt">328
&lt;/span>&lt;span class="lnt">329
&lt;/span>&lt;span class="lnt">330
&lt;/span>&lt;span class="lnt">331
&lt;/span>&lt;span class="lnt">332
&lt;/span>&lt;span class="lnt">333
&lt;/span>&lt;span class="lnt">334
&lt;/span>&lt;span class="lnt">335
&lt;/span>&lt;span class="lnt">336
&lt;/span>&lt;span class="lnt">337
&lt;/span>&lt;span class="lnt">338
&lt;/span>&lt;span class="lnt">339
&lt;/span>&lt;span class="lnt">340
&lt;/span>&lt;span class="lnt">341
&lt;/span>&lt;span class="lnt">342
&lt;/span>&lt;span class="lnt">343
&lt;/span>&lt;span class="lnt">344
&lt;/span>&lt;span class="lnt">345
&lt;/span>&lt;span class="lnt">346
&lt;/span>&lt;span class="lnt">347
&lt;/span>&lt;span class="lnt">348
&lt;/span>&lt;span class="lnt">349
&lt;/span>&lt;span class="lnt">350
&lt;/span>&lt;span class="lnt">351
&lt;/span>&lt;span class="lnt">352
&lt;/span>&lt;span class="lnt">353
&lt;/span>&lt;span class="lnt">354
&lt;/span>&lt;span class="lnt">355
&lt;/span>&lt;span class="lnt">356
&lt;/span>&lt;span class="lnt">357
&lt;/span>&lt;span class="lnt">358
&lt;/span>&lt;span class="lnt">359
&lt;/span>&lt;span class="lnt">360
&lt;/span>&lt;span class="lnt">361
&lt;/span>&lt;span class="lnt">362
&lt;/span>&lt;span class="lnt">363
&lt;/span>&lt;span class="lnt">364
&lt;/span>&lt;span class="lnt">365
&lt;/span>&lt;span class="lnt">366
&lt;/span>&lt;span class="lnt">367
&lt;/span>&lt;span class="lnt">368
&lt;/span>&lt;span class="lnt">369
&lt;/span>&lt;span class="lnt">370
&lt;/span>&lt;span class="lnt">371
&lt;/span>&lt;span class="lnt">372
&lt;/span>&lt;span class="lnt">373
&lt;/span>&lt;span class="lnt">374
&lt;/span>&lt;span class="lnt">375
&lt;/span>&lt;span class="lnt">376
&lt;/span>&lt;span class="lnt">377
&lt;/span>&lt;span class="lnt">378
&lt;/span>&lt;span class="lnt">379
&lt;/span>&lt;span class="lnt">380
&lt;/span>&lt;span class="lnt">381
&lt;/span>&lt;span class="lnt">382
&lt;/span>&lt;span class="lnt">383
&lt;/span>&lt;span class="lnt">384
&lt;/span>&lt;span class="lnt">385
&lt;/span>&lt;span class="lnt">386
&lt;/span>&lt;span class="lnt">387
&lt;/span>&lt;span class="lnt">388
&lt;/span>&lt;span class="lnt">389
&lt;/span>&lt;span class="lnt">390
&lt;/span>&lt;span class="lnt">391
&lt;/span>&lt;span class="lnt">392
&lt;/span>&lt;span class="lnt">393
&lt;/span>&lt;span class="lnt">394
&lt;/span>&lt;span class="lnt">395
&lt;/span>&lt;span class="lnt">396
&lt;/span>&lt;span class="lnt">397
&lt;/span>&lt;span class="lnt">398
&lt;/span>&lt;span class="lnt">399
&lt;/span>&lt;span class="lnt">400
&lt;/span>&lt;span class="lnt">401
&lt;/span>&lt;span class="lnt">402
&lt;/span>&lt;span class="lnt">403
&lt;/span>&lt;span class="lnt">404
&lt;/span>&lt;span class="lnt">405
&lt;/span>&lt;span class="lnt">406
&lt;/span>&lt;span class="lnt">407
&lt;/span>&lt;span class="lnt">408
&lt;/span>&lt;span class="lnt">409
&lt;/span>&lt;span class="lnt">410
&lt;/span>&lt;span class="lnt">411
&lt;/span>&lt;span class="lnt">412
&lt;/span>&lt;span class="lnt">413
&lt;/span>&lt;span class="lnt">414
&lt;/span>&lt;span class="lnt">415
&lt;/span>&lt;span class="lnt">416
&lt;/span>&lt;span class="lnt">417
&lt;/span>&lt;span class="lnt">418
&lt;/span>&lt;span class="lnt">419
&lt;/span>&lt;span class="lnt">420
&lt;/span>&lt;span class="lnt">421
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-reg" data-lang="reg">Windows Registry Editor Version 5.00
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.001\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.001\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.001\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.7z\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.7z\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.7z\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.arj\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.arj\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.arj\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.bz2\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.bz2\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.bz2\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.bzip2\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.bzip2\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.bzip2\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.cab\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.cab\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.cab\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.cpio\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.cpio\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.cpio\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.deb\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.deb\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.deb\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.dmg\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.dmg\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.dmg\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.fat\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.fat\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.fat\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.gz\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.gz\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.gz\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.gzip\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.gzip\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.gzip\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.hfs\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.hfs\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.hfs\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.iso\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.iso\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.iso\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.lha\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.lha\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.lha\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.lzh\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.lzh\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.lzh\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.lzma\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.lzma\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.lzma\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.ntfs\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.ntfs\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.ntfs\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.rar\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.rar\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.rar\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.rpm\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.rpm\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.rpm\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.squashfs\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.squashfs\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.squashfs\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.swm\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.swm\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.swm\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tar\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tar\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tar\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.taz\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.taz\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.taz\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tbz\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tbz\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tbz\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tbz2\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tbz2\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tbz2\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tgz\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tgz\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tgz\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tpz\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tpz\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.tpz\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.txz\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.txz\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.txz\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.vhd\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.vhd\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.vhd\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.wim\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.wim\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.wim\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.xar\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.xar\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.xar\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.xz\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.xz\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.xz\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.z\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.z\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.z\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.zip\shell]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;extract&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.zip\shell\extract]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Extract to Folder&amp;#34;&lt;/span>
&lt;span class="k">[&lt;/span>&lt;span class="nb">HKEY_CLASSES_ROOT&lt;/span>&lt;span class="k">\7-Zip.zip\shell\extract\command]&lt;/span>
&lt;span class="na">@&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;\&amp;#34;D:\\000000000000\\7-Zip\\7zG.exe\&amp;#34; x \&amp;#34;%1\&amp;#34; -o*&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;em>reference&lt;/em>&lt;/p>
&lt;p>&lt;a href="https://gist.github.com/zabbarob/5891200">https://gist.github.com/zabbarob/5891200&lt;/a>&lt;/p></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/></entry><entry><title type="text">å»ºç«™</title><link rel="alternate" type="text/html" href="https://loomt.top/posts/%E5%BB%BA%E7%AB%99/"/><id>https://loomt.top/posts/%E5%BB%BA%E7%AB%99/</id><updated>2023-05-06T16:40:09+00:00</updated><published>2022-07-15T12:01:10+08:00</published><author><name>loomt</name><uri>https://loomt.top</uri><email>loomt_@outlook.com</email></author><rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)</rights><summary type="html">å‰æ®µæ—¶é—´ç™½å«–äº†ä¸€ä¸ª åŸŸå ï¼Œæš‘å‡æœ‰æ—¶é—´äº†èµ¶ç´§ç‰©å°½å…¶ç”¨ï¼Œäºæ˜¯èŠ±äº†ä¸€å¤©çš„æ—¶é—´é‡æ–°å»ºäº†ä¸ªç«™ï¼ˆå…¶å®æˆ‘å¾ˆä¹…ä¹‹å‰å°±ç”¨è¿‡ hexo æ— è„‘å»ºç«™ï¼Œä½†æœ€è¿‘å‘ç°äº†ä¸€ä¸ªç‰¹åˆ«å–œæ¬¢çš„Hugoä¸»é¢˜ MemE ï¼‰ ç®€ç•¥â€¦</summary><content type="html">&lt;p>&lt;img src="https://loomt.top/img/sky.jpg" alt="sky">&lt;/p>
&lt;blockquote>
&lt;p>å‰æ®µæ—¶é—´ç™½å«–äº†ä¸€ä¸ª &lt;a href="https://loomt.eu.org">åŸŸå&lt;/a> ï¼Œæš‘å‡æœ‰æ—¶é—´äº†èµ¶ç´§ç‰©å°½å…¶ç”¨ï¼Œäºæ˜¯èŠ±äº†ä¸€å¤©çš„æ—¶é—´é‡æ–°å»ºäº†ä¸ªç«™ï¼ˆå…¶å®æˆ‘å¾ˆä¹…ä¹‹å‰å°±ç”¨è¿‡ hexo æ— è„‘å»ºç«™ï¼Œä½†æœ€è¿‘å‘ç°äº†ä¸€ä¸ªç‰¹åˆ«å–œæ¬¢çš„&lt;a href="https://gohugo.io/">Hugo&lt;/a>ä¸»é¢˜ &lt;a href="https://github.com/reuixiy/hugo-theme-meme">MemE&lt;/a> ï¼‰&lt;/p>
&lt;/blockquote>
&lt;h1 id="ç®€ç•¥æ­¥éª¤">ç®€ç•¥æ­¥éª¤&lt;/h1>
&lt;h2 id="hugo-quick-start">Hugo Quick Start&lt;/h2>
&lt;ol>
&lt;li>åœ¨ wsl ä¸‹è£… Hugo&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo apt install hugo
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>TL;DR ä¸€ä¸‹ Hugo çš„åŸºç¡€å‘½ä»¤&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ tldr hugo
hugo
Template-based static site generator. Uses modules, components, and themes.More information: https://gohugo.io.
- Create a new Hugo site:
hugo new site &lt;span class="o">{{&lt;/span>path/to/site&lt;span class="o">}}&lt;/span>
- Create a new Hugo theme &lt;span class="o">(&lt;/span>themes may also be downloaded from https://themes.gohugo.io/&lt;span class="o">)&lt;/span>:
hugo new theme &lt;span class="o">{{&lt;/span>theme_name&lt;span class="o">}}&lt;/span>
- Create a new page:
hugo new &lt;span class="o">{{&lt;/span>section_name&lt;span class="o">}}&lt;/span>/&lt;span class="o">{{&lt;/span>filename&lt;span class="o">}}&lt;/span>
- Build a site to the ./public/ directory:
hugo
- Build a site including pages that are marked as a &lt;span class="s2">&amp;#34;draft&amp;#34;&lt;/span>:
hugo --buildDrafts
- Build a site to a given directory:
hugo --destination &lt;span class="o">{{&lt;/span>path/to/destination&lt;span class="o">}}&lt;/span>
- Build a site, start up a webserver to serve it, and automatically reload when pages are edited:
hugo server
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>æ–°å»ºç«™ç‚¹&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ hugo new site loomt
Congratulations! Your new Hugo site is created in /home/loomt/temp/loomt.
Just a few more steps and you are ready to go:
1. Download a theme into the same-named folder.
Â Choose a theme from https://themes.gohugo.io/ or
Â create your own with the &lt;span class="s2">&amp;#34;hugo new theme &amp;lt;THEMENAME&amp;gt;&amp;#34;&lt;/span> command.
2. Perhaps you want to add some content. You can add single files
Â with &lt;span class="s2">&amp;#34;hugo new &amp;lt;SECTIONNAME&amp;gt;/&amp;lt;FILENAME&amp;gt;.&amp;lt;FORMAT&amp;gt;&amp;#34;&lt;/span>.
3. Start the built-in live server via &lt;span class="s2">&amp;#34;hugo server&amp;#34;&lt;/span>.
Visit https://gohugo.io/ &lt;span class="k">for&lt;/span> quickstart guide and full documentation.
$ &lt;span class="nb">cd&lt;/span> loomt
$ tree
.
â”œâ”€â”€ archetypes
â”‚ Â  â””â”€â”€ default.md
â”œâ”€â”€ config.toml
â”œâ”€â”€ content
â”œâ”€â”€ data
â”œâ”€â”€ layouts
â”œâ”€â”€ static
â””â”€â”€ themes
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>é…ç½®ä¸»é¢˜&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>$ git init
# å°†çš®è‚¤ä½œä¸ºsubmoduleæ·»åŠ ï¼Œä»¥ä¾¿æ›´æ–°
$ git submodule add https://github.com/reuixiy/hugo-theme-meme.git themes/meme # MeMEï¼Œå¾ˆå–œæ¬¢çš„ä¸€ä¸ªä¸»é¢˜
$ git submodule add https://github.com/martignoni/hugo-notice.git themes/hugo-notice # hugo-noticeï¼Œæ’ä»¶ä¸»é¢˜ï¼ˆå¾ˆè½»ï¼Œå¼€ç®±å³ç”¨ï¼‰
$ rm config.toml &amp;amp;&amp;amp; cp themes/meme/config-examples/zh-cn/config.toml config.toml #è¦†ç›–é…ç½®æ–‡ä»¶
&lt;/code>&lt;/pre>&lt;ol start="5">
&lt;li>å‘å¸ƒæ–‡ç« &lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ hugo new posts/HelloWorld.md &lt;span class="c1">#ä¼šåœ¨cententä¸‹é¢åˆ›å»ºmarkdownæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥å»ç¼–è¾‘&lt;/span>
Content &lt;span class="s2">&amp;#34;/home/loomt/temp/loomt/content/posts/HelloWorld.md&amp;#34;&lt;/span> created
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="6">
&lt;li>è¿è¡Œæœ¬åœ°æœåŠ¡&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ hugo server -D --verbose &lt;span class="c1"># åœ¨æœ¬åœ°è¿è¡Œ -Dæ˜¯æ¸²æŸ“è‰ç¨¿ --verboseæ˜¾ç¤ºè¯¦ç»†è¾“å‡º&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç›®å‰å·²ç»å®ŒæˆåŸºæœ¬é…ç½®ï¼Œå¯ä»¥è®¿é—®è¿è¡Œåœ¨æœ¬æœºçš„ç«™ç‚¹äº† ğŸ¥³&lt;/p>
&lt;p>æ¥ä¸‹æ¥è¿˜å¯ä»¥å°†ç½‘ç«™éƒ¨ç½²åˆ° Github Pageï¼ŒVercel æˆ–è€… Netlify ç­‰å…è´¹çš„é™æ€èµ„æºæ‰˜ç®¡å•†ã€‚&lt;/p>
&lt;h2 id="hugo-éƒ¨ç½²åˆ°-github-page">Hugo éƒ¨ç½²åˆ° Github Page&lt;/h2>
&lt;p>Hugo æ˜¯ä¸€ä¸ªç½‘ç«™æ„å»ºå·¥å…·ï¼Œ&lt;code>hugo&lt;/code>å‘½ä»¤ç”Ÿæˆçš„ public æ–‡ä»¶å¤¹å­˜æ”¾çš„æ˜¯é™æ€çš„éƒ¨ç½²é¡µé¢ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å…¶æ”¾åœ¨ Github Page ä¸­å³å¯ã€‚å»ºè®®å¼€ä¸¤ä¸ªä»“åº“ï¼Œä¸€ä¸ªä»“åº“ç”¨äºå­˜æ”¾æ ¹ç›®å½•ï¼Œå¦ä¸€ä¸ªç”¨äºå­˜æ”¾./public æ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œä»¥ä¾¿è¢« Github Page éƒ¨ç½²ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å› ä¸ºæ ¹ç›®å½•å¯èƒ½æœ‰æ•æ„Ÿä¿¡æ¯å’Œæš‚æ—¶ä¸å¸Œæœ›å…¬å¼€çš„è‰ç¨¿ï¼Œåˆä¸ºäº†è®©å…¶å¾—åˆ°æœ‰æ•ˆçš„ç‰ˆæœ¬æ§åˆ¶ï¼Œå¯ä»¥å¼€ä¸€ä¸ªç§æœ‰ä»“åº“å­˜æ”¾æ ¹ç›®å½•ï¼Œ&lt;/p>
&lt;p>è€Œ publishDir(./pubic) ä½œä¸ºè¾“å‡ºçš„é™æ€é¡µé¢ï¼Œåˆ™é€‚åˆæ”¾åœ¨å…¬å¼€çš„ä»“åº“ &lt;del>è€Œä¸” Github Page ä¸å…¬å¼€æ²¡æ³•ç™½å«–&lt;/del>&lt;/p>
&lt;/blockquote>
&lt;p>é»˜è®¤çœ‹åˆ°è¿™é‡Œçš„åŒå­¦å·²ç»å»ºå¥½äº†ä»“åº“ï¼Œå¹¶å®Œæˆäº†ä»“åº“çš„åˆå§‹åŒ–å’Œé…ç½® ğŸ¤—&lt;/p>
&lt;p>ä¸‹é¢å‡è®¾æ›´æ–°äº†æ–‡ç« ï¼Œéœ€è¦åŒæ­¥åˆ°ä¸¤ä¸ªä»“åº“ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ hugo --gc --cleanDestinationDir &lt;span class="c1"># ç”Ÿæˆé™æ€ç«™ç‚¹åˆ°./publicçš„åŒæ—¶ æ¸…é™¤ç¼“å­˜å’Œé™æ€ç«™ç‚¹ç”¨ä¸ç€çš„æ–‡ä»¶&lt;/span>
$ git add .
$ git commit -m &lt;span class="s2">&amp;#34;update source code&amp;#34;&lt;/span>
$ git push
$ &lt;span class="nb">cd&lt;/span> public
$ git add .
$ git commit -m &lt;span class="s2">&amp;#34;update Github Page&amp;#34;&lt;/span>
$ git push
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ˜¯ä¸æ˜¯æ„Ÿè§‰è¦ push ä¸¤æ¬¡éå¸¸éº»çƒ¦ï¼Œå¯ä»¥å†™ä¸€ä¸ª push.sh æ¥ç®€åŒ–æ“ä½œï¼Œè¿˜å¯ä»¥åŠ ä¸ª Github Actionsï¼Œç®€åŒ–æ¯æ¬¡æ›´æ–°ç«™ç‚¹çš„æ­¥éª¤ï¼Œå…·ä½“å¯é˜…è¯» &lt;a href="https://docs.github.com/cn/actions/learn-github-actions/understanding-github-actions">GitHub Actions å®˜æ–¹æ–‡æ¡£&lt;/a>ï¼Œ&lt;a href="https://github.com/peaceiris/actions-gh-pages">actions-gh-pages&lt;/a> ä»¥åŠ &lt;a href="https://io-oi.me/tech/deploy-hugo-to-github-pages-via-github-actions/">reuixiy çš„åšå®¢&lt;/a> ã€‚&lt;/p>
&lt;h3 id="è‡ªåŠ¨åŒ–éƒ¨ç½²">è‡ªåŠ¨åŒ–éƒ¨ç½²&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>å¦‚æœæºç ä»“åº“å’Œ Github Page ä»“åº“éƒ½æ˜¯å…¬æœ‰çš„è¯å¯ä»¥é˜…è¯» &lt;a href="https://github.com/peaceiris/actions-gh-pages">actions-gh-pages&lt;/a> è¿›è¡Œç®€å•çš„é…ç½®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœæºç ä»“åº“æ˜¯ç§æœ‰çš„ï¼ŒGithub Page ä»“åº“æ˜¯å…¬å¼€çš„è¯ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹é…ç½®æ–¹æ¡ˆã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>é…ç½®å…¬é’¥å’Œç§é’¥åˆ°ä»“åº“&lt;/li>
&lt;/ol>
&lt;p>éœ€è¦ç”Ÿæˆ SSH key pair ä»¥è·å–æºç ä»“åº“å¯¹ Github Page ä»“åº“ä¿®æ”¹çš„æƒé™ã€‚&lt;/p>
&lt;pre tabindex="0">&lt;code>$ mkdir -p ~/.ssh/blog
$ cd ~/.ssh/blog
$ ssh-keygen -t rsa -b 4096 -C &amp;quot;yourname@users.noreply.github.com&amp;quot;
# æ³¨æ„ï¼šä¸è¦æ— è„‘å›è½¦ï¼Œæœ€å¥½å¼€ä¸€ä¸ªæ–‡ä»¶å¤¹å­˜å…¬é’¥ç§é’¥ï¼Œä¸ç„¶ä¼šè¦†ç›–æ‰ä»¥å‰çš„
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>id_rsaï¼ˆç§é’¥ï¼‰&lt;/li>
&lt;/ul>
&lt;p>å‰å¾€ Github Page ä»“åº“ï¼ŒSettings &amp;gt; Deploy Keys &amp;gt; Add deploy keyã€‚&lt;/p>
&lt;p>éœ€è¦å‹¾é€‰ Allow write accessã€‚&lt;/p>
&lt;ul>
&lt;li>id_rsa.pubï¼ˆå…¬é’¥ï¼‰&lt;/li>
&lt;/ul>
&lt;p>å‰å¾€æºç ä»“åº“ï¼ŒSettings &amp;gt; Secrets &amp;gt; Actions &amp;gt; New repository secretã€‚&lt;/p>
&lt;p>Name éœ€è¦è®¾ä¸º ACTIONS_DEPLOY_KEY&lt;/p>
&lt;ol start="2">
&lt;li>æ–°å»º Workflow é…ç½®æ–‡ä»¶&lt;/li>
&lt;/ol>
&lt;p>ä¸‹é¢ç²˜ä¸€ä¸‹æˆ‘çš„é…ç½®æ–¹æ¡ˆ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="c"># .github/workflows/build.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Hugo automated deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">push&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  &lt;/span>&lt;span class="nt">branches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>- &lt;span class="l">main Â # Set a branch name to trigger deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">deploy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  &lt;/span>&lt;span class="nt">permissions&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="nt">contents&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">write&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  &lt;/span>&lt;span class="nt">concurrency&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="nt">group&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ github.workflow }}-${{ github.ref }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  Â  &lt;/span>&lt;span class="nt">submodules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> Â &lt;/span>&lt;span class="c"># Fetch Hugo themes (true OR recursive)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  Â  &lt;/span>&lt;span class="nt">fetch-depth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w"> Â  Â &lt;/span>&lt;span class="c"># Fetch all history for .GitInfo and .Lastmod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup Hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-hugo@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  Â  &lt;/span>&lt;span class="nt">hugo-version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0.92.2&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  Â  &lt;/span>&lt;span class="nt">extended&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hugo --gc --minify&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="c"># - name: Deploy&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="c"># Â  uses: peaceiris/actions-gh-pages@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="c"># Â  # If you&amp;#39;re changing the branch from main,&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="c"># Â  # also change the `main` in `refs/heads/main`&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="c"># Â  # below accordingly.&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="c"># Â  if: ${{ github.ref == &amp;#39;refs/heads/main&amp;#39; }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="c"># Â  with:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="c"># Â  Â  github_token: ${{ secrets.GITHUB_TOKEN }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>&lt;span class="c"># Â  Â  publish_dir: ./public&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy Â # æ­¤å¤„éœ€è¦æŒ‰ç…§è‡ªå·±å®é™…ä¿®æ”¹&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-gh-pages@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  Â  &lt;/span>&lt;span class="nt">deploy_key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.ACTIONS_DEPLOY_KEY }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  Â  &lt;/span>&lt;span class="nt">external_repository&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">loomts/loomts.github.io&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  Â  &lt;/span>&lt;span class="nt">publish_branch: main Â # default&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">gh-pages&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  Â  Â  Â  &lt;/span>&lt;span class="nt">publish_dir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">./public&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>æ¨é€åˆ° Github&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ git add .
$ git commit -m &lt;span class="s2">&amp;#34;setup auto deploy&amp;#34;&lt;/span>
$ git push
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‰“å¼€ä½ çš„æºç ä»“åº“é¡µé¢ï¼Œç‚¹å‡» Actions æŸ¥çœ‹æ—¥å¿—ï¼Œé¡ºåˆ©çš„è¯å·²ç»æå®šäº†ï¼Œä»¥åæ¯æ¬¡ &lt;code>git push&lt;/code> Github Workflow éƒ½ä¼šè‡ªåŠ¨å¸®ä½ æ›´æ–°ç½‘ç«™äº†ã€‚&lt;/p>
&lt;h2 id="github-page-ç»‘å®šè‡ªå®šä¹‰åŸŸå">Github Page ç»‘å®šè‡ªå®šä¹‰åŸŸå&lt;/h2>
&lt;p>å‡è®¾å·²ç»æœ‰äº†åŸŸåï¼Œè¿˜éœ€è¦åœ¨åŸŸåçš„ DNS æœåŠ¡å•†é‚£é‡ŒåŠ ä¸€ä¸ª CNAMEï¼ˆç”¨äº dns è·³è½¬ï¼‰ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>name&lt;/th>
&lt;th>type&lt;/th>
&lt;th>value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>www&lt;/td>
&lt;td>CNAME&lt;/td>
&lt;td>loomts.github.io&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä¸€æ®µæ—¶é—´åï¼Œå›åˆ° Github Page ä»“åº“ï¼Œåœ¨ Settings &amp;gt; Pages &amp;gt; Custom domain å¤„å¡«ä¸Šè‡ªå·±çš„åŸŸåï¼Œç­‰å¾…å‡ å°æ—¶ç”Ÿæˆè¯ä¹¦ï¼Œç„¶åå‹¾é€‰ Â &lt;code>Enforce HTTPS&lt;/code>ã€‚&lt;/p>
&lt;p>è¿˜è¦è®°å¾—æ·»åŠ  &lt;code>your domain&lt;/code>åˆ° static/CNAMEï¼Œä»¥ç”Ÿæˆåˆ°é™æ€æ–‡ä»¶ã€‚ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;your domain&amp;#34;&lt;/span> &amp;gt; static/CNAME
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Custom domains are stored in aÂ &lt;em>CNAME&lt;/em>Â file in the root of your publishing source. You can add or update this file through your repository settings or manually. For more information, see &amp;quot; &lt;a href="https://docs.github.com/en/articles/managing-a-custom-domain-for-your-github-pages-site">Managing a custom domain for your GitHub Pages site&lt;/a> .&amp;quot; â€”â€”Github Docs&lt;/p>
&lt;/blockquote>
&lt;h2 id="hugo-éƒ¨ç½²åˆ°-vercel">Hugo éƒ¨ç½²åˆ° Vercel&lt;/h2>
&lt;p>&lt;a href="https://vercel.com">Vercel&lt;/a> å¯ä»¥çœ‹ä½œæ˜¯ç»“åˆäº† Github Page è¿˜æœ‰ Github Actions çš„ç”¨äºå‰ç«¯æ¡†æ¶å’Œé™æ€ç«™ç‚¹ç®¡çš„å¹³å°ï¼Œç›´æ¥å¯¼å…¥ Github ä»“åº“å³å¯éƒ¨ç½²ï¼Œæ„Ÿè§‰é…ç½®èµ·æ¥æ¯” Github Action æ— è„‘å¾ˆå¤šï¼Œå¾ˆé€‚åˆæˆ‘ï¼Œæ‰€ä»¥æˆ‘å·²ç»æ”¾å¼ƒ Github Actionï¼Œå…¨é¢è½¬ä¸º Vercel äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ³¨å†ŒåŸŸåçš„æ—¶å€™è¦å»åŸŸåæ³¨å†Œå•†æ”¹ä¸€ä¸‹ DNS æœåŠ¡å™¨ï¼Œæˆ–è€…æ¯ä¸ªç«™ç‚¹éƒ½æ·»åŠ ä¸€æ¬¡ A è®°å½•ã€‚&lt;/p>
&lt;h2 id="hugo-ä¸ªæ€§åŒ–é…ç½®">Hugo ä¸ªæ€§åŒ–é…ç½®&lt;/h2>
&lt;h3 id="çš®è‚¤é…ç½®">çš®è‚¤é…ç½®&lt;/h3>
&lt;p>å¯ä»¥æ ¹æ®çš®è‚¤ä½œè€…çš„æ–‡æ¡£æ”¹å˜çš®è‚¤çš„å„ç§ featureï¼Œå¦‚ MeME çš„ config.toml &lt;a href="https://github.com/reuixiy/hugo-theme-meme/blob/master/config-examples/zh-cn/config.toml">example&lt;/a>&lt;/p>
&lt;style type="text/css">.notice{--root-color:#444;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#c33;--warning-content:#fee;--info-title:#fb7;--info-content:#fec;--note-title:#6be;--note-content:#e7f2fa;--tip-title:#5a5;--tip-content:#efe}@media (prefers-color-scheme:dark){.notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}}body.dark .notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}&lt;/style>
&lt;div>&lt;svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg">&lt;symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/>&lt;/symbol>&lt;symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/>&lt;/symbol>&lt;symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/>&lt;/symbol>&lt;symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">&lt;path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/>&lt;/symbol>&lt;/svg>&lt;/div>&lt;div class="notice tip" >
&lt;p class="first notice-title">&lt;span class="icon-notice baseline">&lt;svg>&lt;use href="https://loomt.top/posts/%E5%BB%BA%E7%AB%99/#tip-notice">&lt;/use>&lt;/svg>&lt;/span>æç¤º&lt;/p>&lt;p>config.toml çš„ baseURL è¦åŠ  &lt;code>https://&lt;/code> ï¼Œå¦åˆ™ç”Ÿæˆçš„é™æ€é¡µé¢ css å’Œ js åŠ è½½ä¼šå‡ºé—®é¢˜ã€‚&lt;/p>&lt;/div>
&lt;h3 id="è‡ªå®šä¹‰-css-å’Œ-js">è‡ªå®šä¹‰ CSS å’Œ JS&lt;/h3>
&lt;ol>
&lt;li>åˆ©ç”¨ hugo çš„&lt;a href="https://gohugo.io/templates/lookup-order/#hugo-layouts-lookup-rules-with-theme">æ›¿æ¢è§„åˆ™&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>å½“ä½ éœ€è¦æ›´æ”¹æŸä¸ªé¡µé¢çš„ç”Ÿæˆè§„åˆ™ï¼ˆåŒ…æ‹¬ CSS å’Œ JSï¼‰ï¼Œä½ å¯ä»¥å°† themes/your-theme é‡Œé¢çš„ä¸œè¥¿å¤åˆ¶ä¸€ä»½åˆ°ä½ çš„æ ¹ç›®å½•ï¼Œç„¶åçˆ½æ”¹é€»è¾‘ï¼Œhugo ç”Ÿæˆé™æ€é¡µé¢æ—¶åœ¨åŒç­‰æƒ…å†µä¸‹ä¼šä¼˜å…ˆç”¨ä½ æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;ol start="2">
&lt;li>å¦‚æœä½ æƒ³è¦è‡ªå·±æ–°å»ºä¸€ä¸ª js æˆ–è€… css æ–‡ä»¶ï¼Œå¯ä»¥çœ‹&lt;a href="https://gohugo.io/hugo-pipes">hugo-pipes&lt;/a>ï¼Œä½†å¦‚æœä½ ä¸æ‰“ç®—åšä¸€ä¸ªå¼€æºä¸»é¢˜ï¼Œæ— è„‘åœ¨ html æ–‡ä»¶é‡Œé¢å † style å’Œ script æ˜¯èƒ½è·‘çš„é€‰æ‹©ï¼&lt;/li>
&lt;/ol>
&lt;p>æ¯”å¦‚ï¼Œæˆ‘æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼šåœ¨ Wiki é¡µé¢åˆ†å±‚æ¬¡æ˜¾ç¤ºæˆ‘çš„ç¬”è®°ï¼Œä½†åˆä¸è®©ç¬”è®°å†…å®¹åœ¨ä¸»é¡µé¢æ˜¾ç¤ºï¼Œå¹¶ä¸” Wiki é¡µéœ€è¦æŒ‰ç…§æ–‡ä»¶å¤¹çš„å†…éƒ¨ç»“æ„å±•ç¤ºï¼Œé‚£å°±ç”¨&lt;a href="https://gohugo.io/content-management/taxonomies/#default-taxonomies">categories&lt;/a>çš„æ–¹å¼ç»„ç»‡ content/wiki çš„å†…å®¹ï¼Œä»…éœ€è¦æ”¹ä¸€ä¸‹ MeME ä¸»é¢˜ tree-sections çš„å†…å®¹ï¼Œå¹¶é…ç½®ä¸€ä¸‹ config.toml å³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">main&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;main list&amp;#34;&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;main&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;main-inner&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;content categories&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ if .Site.Params.displayListTitle }}
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h1&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;list-title&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ &amp;#34;Wiki&amp;#34;}}
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
å­˜ç‚¹ç¬”è®°ï¼Œä»…ä½œå‚è€ƒğŸ˜¶â€ğŸŒ«ï¸
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ end }}
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;tree&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">ul&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;list-categories&amp;#34;&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;display: block;&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ partial &amp;#34;utils/tree-sections.html&amp;#34; . }}
{{ $sections := .Scratch.Get &amp;#34;sections&amp;#34; }}
{{ $pages := .Scratch.Get &amp;#34;pages&amp;#34; }}
{{ range $index, $page := $pages }}
{{ $depth := (len (split (strings.TrimPrefix &amp;#34;/&amp;#34; $page) &amp;#34;/&amp;#34;)) }}
{{ with $.Site.GetPage $page }}
{{ $linkTarget := .}}
{{ $depthPrev := 0 }}
{{ if ge $index 1 }}
{{ $pagePrev := index $pages (sub $index 1) }}
{{ $depthPrev = len (split (strings.TrimPrefix &amp;#34;/&amp;#34; $pagePrev) &amp;#34;/&amp;#34;) }}
{{ end }}
{{ $depthNext := 0 }}
{{ if lt $index (sub (len $pages) 1) }}
{{ $pageNext := index $pages (add $index 1) }}
{{ $depthNext = len (split (strings.TrimPrefix &amp;#34;/&amp;#34; $pageNext) &amp;#34;/&amp;#34;) }}
{{ end }}
{{ if or (le $depth $depthPrev) (eq $index 0) }}
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">li&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ end }}
{{ if and (gt $depth $depthPrev) (ne $index 0) }}
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">ul&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;list-categories&amp;#34;&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;display: block;&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">li&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ end }} {{ $name := index $sections $index }}
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;category-item&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ .LinkTitle | default $name}}
{{ if $.Site.Params.displayPostsCount }}
{{ $sectionPage := .CurrentSection }}
{{$.Scratch.Delete &amp;#34;pages&amp;#34; }}
{{ range $.Site.RegularPages }}
{{ if (.IsDescendant $sectionPage)}}
{{ $.Scratch.Add &amp;#34;pages&amp;#34; (slice .) }}
{{ end}} {{ end }}
{{ $pages := $.Scratch.Get &amp;#34;pages&amp;#34;}}
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">span&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;category-count&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{printf &amp;#34;(%d)&amp;#34; (len $pages)}}
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">span&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ end }}
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ if $.Site.Params.displayPosts }}
{{ $sectionPage := .CurrentSection }}
{{ $.Scratch.Delete &amp;#34;pages&amp;#34;}}
{{ range $.Site.RegularPages }}
{{ if (.InSection $sectionPage)}}
{{ $.Scratch.Add &amp;#34;pages&amp;#34; (slice .) }}
{{ end }} {{ end }}
{{ $pages := $.Scratch.Get &amp;#34;pages&amp;#34; }}
{{ partial &amp;#34;utils/limit-tree-posts.html&amp;#34; (dict &amp;#34;$&amp;#34; $ &amp;#34;pages&amp;#34; $pages
&amp;#34;linkTarget&amp;#34; $linkTarget) }}
{{ end }}
{{ if and (gt $depth $depthNext) (ne $index (sub (len $pages) 1)) }}
{{ range seq (sub $depth $depthNext) }}
{{ if le . (sub $depth $depthNext) }}
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">li&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">ul&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ end }} {{ end }} {{ end }} {{ if ge $depth $depthNext
}}
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">li&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
{{ end }} {{ end }} {{ end }}
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">ul&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">main&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="kd">let&lt;/span> &lt;span class="nx">lis&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelectorAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ul.list-categories &amp;gt; li&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">lis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">forEach&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">li&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">li&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;.category-item&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">addEventListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;click&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">event&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stopPropagation&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">// é˜»æ­¢äº‹ä»¶å†’æ³¡
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="kd">let&lt;/span> &lt;span class="nx">sonul&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">li&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">querySelector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ul&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;span class="nx">sonul&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">style&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">display&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">sonul&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">style&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">display&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s2">&amp;#34;block&amp;#34;&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s2">&amp;#34;none&amp;#34;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;block&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">sonul&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextElementSibling&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">sonul&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextElementSibling&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">style&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">display&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">sonul&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">nextElementSibling&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">style&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">display&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s2">&amp;#34;block&amp;#34;&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s2">&amp;#34;none&amp;#34;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;block&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">});&lt;/span>
&lt;span class="p">})&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">
&lt;span class="p">[&lt;/span>&lt;span class="nx">menu&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="c">## èœå•æ &lt;/span>
&lt;span class="p">[[&lt;/span>&lt;span class="nx">menu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">main&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;span class="nx">pageref&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;/posts/&amp;#34;&lt;/span>
&lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;Posts&amp;#34;&lt;/span>
&lt;span class="nx">weight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;span class="nx">pre&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;internal&amp;#34;&lt;/span>
&lt;span class="nx">post&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;archive&amp;#34;&lt;/span>
&lt;span class="p">[[&lt;/span>&lt;span class="nx">menu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">main&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;span class="nx">pageref&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;/tags/&amp;#34;&lt;/span>
&lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;Tags&amp;#34;&lt;/span>
&lt;span class="nx">weight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">4&lt;/span>
&lt;span class="nx">pre&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;internal&amp;#34;&lt;/span>
&lt;span class="nx">post&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;tags&amp;#34;&lt;/span>
&lt;span class="p">[[&lt;/span>&lt;span class="nx">menu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">main&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;span class="nx">pageref&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;/about/&amp;#34;&lt;/span>
&lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;About&amp;#34;&lt;/span>
&lt;span class="nx">weight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;span class="nx">pre&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;internal&amp;#34;&lt;/span>
&lt;span class="nx">post&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;user-circle&amp;#34;&lt;/span>
&lt;span class="p">[[&lt;/span>&lt;span class="nx">menu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">main&lt;/span>&lt;span class="p">]]&lt;/span> &lt;span class="c"># add wiki page&lt;/span>
&lt;span class="nx">pageref&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;/wiki/&amp;#34;&lt;/span>
&lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;Wiki&amp;#34;&lt;/span>
&lt;span class="nx">weight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">6&lt;/span>
&lt;span class="nx">pre&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;internal&amp;#34;&lt;/span>
&lt;span class="nx">post&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;wiki&amp;#34;&lt;/span>
&lt;span class="p">[[&lt;/span>&lt;span class="nx">menu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">main&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;span class="nx">weight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">7&lt;/span>
&lt;span class="nx">identifier&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;theme-switcher&amp;#34;&lt;/span>
&lt;span class="p">[[&lt;/span>&lt;span class="nx">menu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">main&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;span class="nx">weight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">8&lt;/span>
&lt;span class="nx">identifier&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;lang-switcher&amp;#34;&lt;/span>
&lt;span class="p">[[&lt;/span>&lt;span class="nx">menu&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">main&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;span class="nx">weight&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">9&lt;/span>
&lt;span class="nx">identifier&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;search&amp;#34;&lt;/span>
&lt;span class="nx">post&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;search&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="hugo--algolia-search">Hugo + Algolia search&lt;/h3>
&lt;p>Algolia å¯ä»¥æä¾› AI æœç´¢æœåŠ¡ï¼Œä½†éœ€è¦åœ¨æ›´æ–°ç«™ç‚¹æ—¶ç”¨ POST è¯·æ±‚ä¸Šä¼  algolia.json(ç«™ç‚¹ä¿¡æ¯) ç»™ Algoliaï¼Œä»¥å¸®åŠ© Algolia å®ç°æœç´¢æœåŠ¡ã€‚æŒ‰ç…§è¦æ±‚æ–°å»ºç«™ç‚¹ä»¥åŠé…ç½® api å³å¯ï¼Œä¸Šä¼  algolia.json å¯ä»¥ä½¿ç”¨&lt;a href="https://github.com/replicatedhq/hugo-algolia">hugo-algolia&lt;/a>ã€‚å› ä¸º MeME ä¸»é¢˜æœ‰ä¸€å®šçš„ algolia search æ”¯æŒï¼Œä¸‹é¢ä»…ç»™å‡ºä¸Šä¼  algolia.json æ–¹é¢çš„é…ç½®ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ npm install hugo-algolia
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½† hugo-algolia çš„ toml è§£æåœ¨æˆ‘è¿™é‡Œå¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œå¯èƒ½æ˜¯ config.toml çš„é…ç½®å·²ç»å¤ªä¹±äº†ï¼Œæ— æ³•ä¼˜é›…åœ°è§£å†³&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ hugo-algolia -s -t --config config.toml
JSON index file was created in public/algolia.json
/usr/local/lib/node_modules/hugo-algolia/node_modules/algoliasearch/src/AlgoliaSearchCore.js:50
throw new errors.AlgoliaSearchError&lt;span class="o">(&lt;/span>&lt;span class="s1">&amp;#39;Please provide an application ID. &amp;#39;&lt;/span> + usage&lt;span class="o">)&lt;/span>&lt;span class="p">;&lt;/span>
^
AlgoliaSearchError: Please provide an application ID. Usage: algoliasearch&lt;span class="o">(&lt;/span>applicationID, apiKey, opts&lt;span class="o">)&lt;/span>
at AlgoliaSearchNodeJS.AlgoliaSearchCore &lt;span class="o">(&lt;/span>/usr/local/lib/node_modules/hugo-algolia/node_modules/algoliasearch/src/AlgoliaSearchCore.js:50:11&lt;span class="o">)&lt;/span>
at AlgoliaSearchNodeJS.AlgoliaSearch &lt;span class="o">(&lt;/span>/usr/local/lib/node_modules/hugo-algolia/node_modules/algoliasearch/src/AlgoliaSearch.js:11:21&lt;span class="o">)&lt;/span>
at AlgoliaSearchNodeJS.AlgoliaSearchServer &lt;span class="o">(&lt;/span>/usr/local/lib/node_modules/hugo-algolia/node_modules/algoliasearch/src/server/builds/AlgoliaSearchServer.js:17:17&lt;span class="o">)&lt;/span>
at new AlgoliaSearchNodeJS &lt;span class="o">(&lt;/span>/usr/local/lib/node_modules/hugo-algolia/node_modules/algoliasearch/src/server/builds/node.js:83:23&lt;span class="o">)&lt;/span>
at algoliasearch &lt;span class="o">(&lt;/span>/usr/local/lib/node_modules/hugo-algolia/node_modules/algoliasearch/src/server/builds/node.js:68:10&lt;span class="o">)&lt;/span>
at HugoAlgolia.HugoAlgolia.sendIndex &lt;span class="o">(&lt;/span>/usr/local/lib/node_modules/hugo-algolia/lib/index.js:184:20&lt;span class="o">)&lt;/span>
at HugoAlgolia.HugoAlgolia.index &lt;span class="o">(&lt;/span>/usr/local/lib/node_modules/hugo-algolia/lib/index.js:122:12&lt;span class="o">)&lt;/span>
at Object.&amp;lt;anonymous&amp;gt; &lt;span class="o">(&lt;/span>/usr/local/lib/node_modules/hugo-algolia/bin/index.js:23:26&lt;span class="o">)&lt;/span>
at Module._compile &lt;span class="o">(&lt;/span>internal/modules/cjs/loader.js:999:30&lt;span class="o">)&lt;/span>
at Object.Module._extensions..js &lt;span class="o">(&lt;/span>internal/modules/cjs/loader.js:1027:10&lt;span class="o">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ— å¥ˆä¹‹ä¸‹æ–°å»ºäº†ä¸€ä¸ª config.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">baseurl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">DefaultContentLanguage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;zh-cn&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">hasCJKLanguage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">languageCode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;zh-cn&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;loomt&amp;#39;s Blog&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">theme&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;MeME&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">metaDataFormat&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;yaml&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">algolia&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  &lt;/span>&lt;span class="nt">index&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;your index&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  &lt;/span>&lt;span class="nt">key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;your admin key&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">Â  &lt;/span>&lt;span class="nt">appID&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;your appID&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ hugo-algolia -s
JSON index file was created in public/algolia.json
&lt;span class="o">{&lt;/span> updatedAt: &lt;span class="s1">&amp;#39;2023-01-12T14:40:31.454Z&amp;#39;&lt;/span>, taskID: &lt;span class="m">173970040001&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ç”¨ Vercel è¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯ç™½å«–å›½å¤–çš„æœåŠ¡å™¨ä¸ç”¨å¤‡æ¡ˆğŸ˜­&lt;/p>
&lt;/blockquote>
&lt;p>&lt;em>reference&lt;/em>&lt;/p>
&lt;p>&lt;a href="https://gohugo.io/getting-started">https://gohugo.io/getting-started&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://blog.aozaki.cc/blog/hugo-deployment-debugging">https://blog.aozaki.cc/blog/hugo-deployment-debugging&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://io-oi.me/tech/hugo-vs-hexo">https://io-oi.me/tech/hugo-vs-hexo&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/MunifTanjim/minimo/issues/189">https://github.com/MunifTanjim/minimo/issues/189&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://zenlian.github.io/posts/tools/github-actions-hugo">https://zenlian.github.io/posts/tools/github-actions-hugo&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/peaceiris/actions-gh-pages">https://github.com/peaceiris/actions-gh-pages&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://gohugo.io/content-management/sections">https://gohugo.io/content-management/sections&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://gohugo.io/templates">https://gohugo.io/templates&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://gohugo.io/hugo-pipes">https://gohugo.io/hugo-pipes&lt;/a>&lt;/p></content><category scheme="https://loomt.top/posts/" term="posts" label="posts"/><category scheme="https://loomt.top/tags/github-page/" term="Github Page" label="Github Page"/><category scheme="https://loomt.top/tags/%E5%BB%BA%E7%AB%99/" term="å»ºç«™" label="å»ºç«™"/></entry></feed>